{"componentChunkName":"component---src-templates-blog-post-js","path":"/fr/why-isnt-x-a-hook/","result":{"data":{"site":{"siteMetadata":{"title":"Overreacted","author":"Dan Abramov"}},"markdownRemark":{"id":"a6f73542-e2d8-50f2-8bf4-ec448f9529c5","html":"<p>Depuis la sortie de la premiÃ¨re version alpha des <a href=\"https://reactjs.org/hooks\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Hooks React</a>, une question revient souvent dans les discussionsÂ : Â«Â Pourqoi est-ce que <em>&#x3C;telle ou telle API></em> nâ€™est pas un HookÂ ?Â Â»</p>\n<p>Ã€ titre de rappel, voici quelques trucs qui <em>sont</em> des HooksÂ :</p>\n<ul>\n<li><a href=\"https://reactjs.org/docs/hooks-reference.html#usestate\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">useState()</code></a> permet de dÃ©clarer une variable dâ€™Ã©tat.</li>\n<li><a href=\"https://reactjs.org/docs/hooks-reference.html#useeffect\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">useEffect()</code></a> permet de dÃ©clarer un effet de bord.</li>\n<li><a href=\"https://reactjs.org/docs/hooks-reference.html#usecontext\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">useContext()</code></a> permet de lire des donnÃ©es issues du Contexte.</li>\n</ul>\n<p>Mais il y a dâ€™autres APIs, telles que <code class=\"language-text\">React.memo()</code> et <code class=\"language-text\">&lt;Context.Provider&gt;</code>, qui ne sont <em>pas</em> des Hooks. Les propositions les plus courantes pour en faire des Hooks sâ€™avÃ¨rent toujours <em>impossibles Ã  composer</em> ou <em>anti-modulaires</em>. Cet article devrait vous aider Ã  comprendre pourquoi.</p>\n<p><strong>NoteÂ : cet article est une exploration en profondeur pour les gens qui aiment discuter dâ€™APIs.  Vous nâ€™avez pas besoin de penser Ã  tout Ã§a pour Ãªtre efficace avec ReactÂ !</strong></p>\n<hr>\n<p>Nous voulons que les APIs React prÃ©servent deux propriÃ©tÃ©s importantesÂ :</p>\n<ol>\n<li><strong>CompositionÂ :</strong> <a href=\"https://reactjs.org/docs/hooks-custom.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">les Hooks personnalisÃ©s</a> sont la principale raison de notre enthousiasme pour lâ€™API des Hooks.  Nous nous attendons Ã  ce que les gens crÃ©ent frÃ©quemment leurs propres Hooks, et nous voulons nous assurer que les Hooks Ã©crits par diffÃ©rentes personnes <a href=\"/why-do-hooks-rely-on-call-order/#flaw-4-the-diamond-problem\">ne rentrent pas en conflit</a>. (Vous trouvez pas quâ€™on est pourris gÃ¢tÃ©s par la faÃ§on dont les composants se composent proprement et ne se cassent pas lâ€™un lâ€™autreÂ ?)</li>\n<li><strong>DÃ©bogageÂ :</strong> Nous voulons que les bugs soients <a href=\"/the-bug-o-notation/\">faciles Ã  repÃ©rer</a> alors que lâ€™application grandit.  Un des meilleurs aspects de React, câ€™est que lorsquâ€™on remarque un problÃ¨me dans le rendu, il suffit de remonter lâ€™arborescence des composants jusquâ€™Ã  trouver dans quel composant une <em>prop</em> ou lâ€™Ã©tat local a causÃ© lâ€™erreur.</li>\n</ol>\n<p>Prises ensemble, ces deux contraintes nous disent ce qui peut et <em>ne peut pas</em> Ãªtre un Hook.  Essayons Ã§a sur quelques exemples.</p>\n<hr>\n<h2 id=\"un-vÃ©ritable-hook--usestate\"><a href=\"#un-v%C3%A9ritable-hook--usestate\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Un vÃ©ritable HookÂ : <code class=\"language-text\">useState()</code></h2>\n<h3 id=\"composition\"><a href=\"#composition\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Composition</h3>\n<p>Si plusieurs Hooks personnalisÃ©s appellent chacun <code class=\"language-text\">useState()</code>, Ã§a ne crÃ©e pas de conflitÂ :</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">useMyCustomHook1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>value<span class=\"token punctuation\">,</span> setValue<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// Ce qui se passe ici, Ã§a reste ici.</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">useMyCustomHook2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>value<span class=\"token punctuation\">,</span> setValue<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// Ce qui se passe ici, Ã§a reste ici.</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">MyComponent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">useMyCustomHook1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">useMyCustomHook2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Ajouter un nouvel appel inconditionnel Ã  <code class=\"language-text\">useState()</code> est toujours sans risque.  Pas besoin de savoir quoi que ce soit sur les autres Hooks quâ€™utiliserait un composant quand on dÃ©clare une nouvelle variable dâ€™Ã©tat.  Il est juste impossible de casser les autres variables dâ€™Ã©tat lorsquâ€™on en met une Ã  jour.</p>\n<p><strong>VerdictÂ :</strong> âœ… <code class=\"language-text\">useState()</code> ne fragilise pas les Hooks personnalisÃ©s.</p>\n<h3 id=\"dÃ©bogage\"><a href=\"#d%C3%A9bogage\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DÃ©bogage</h3>\n<p>Un des gros avantages des Hooks, câ€™est quâ€™ils peuvent se refiler des valeurs <em>entre eux</em>Â :</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">useWindowWidth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>width<span class=\"token punctuation\">,</span> setWidth<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>innerWidth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">return</span> width<span class=\"token punctuation\">;</span></span><span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">useTheme</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">isMobile</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">Comment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> width <span class=\"token operator\">=</span> <span class=\"token function\">useWindowWidth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>  <span class=\"token keyword\">const</span> isMobile <span class=\"token operator\">=</span> width <span class=\"token operator\">&lt;</span> <span class=\"token constant\">MOBILE_VIEWPORT</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> theme <span class=\"token operator\">=</span> <span class=\"token function\">useTheme</span><span class=\"token punctuation\">(</span>isMobile<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>section</span> <span class=\"token attr-name\">className</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>theme<span class=\"token punctuation\">.</span>comment<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">      </span><span class=\"token punctuation\">{</span><span class=\"token comment\">/* ... */</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>section</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Mais que se passe-t-il si on commet une erreurÂ ? Ã€ quoi ressemble le dÃ©bogageÂ ?</p>\n<p>Imaginons que la classe CSS quâ€™on rÃ©cupÃ¨re dans <code class=\"language-text\">theme.comment</code> soit erronÃ©e.  Comment dÃ©boguerait-on Ã§aÂ ?  On peut poser un point dâ€™arrÃªt ou ajouter quelques appels de log dans le corps de notre composant.</p>\n<p>Peut-Ãªtre que nous verrions que <code class=\"language-text\">theme</code> nâ€™est pas le bon mais que <code class=\"language-text\">width</code> et <code class=\"language-text\">isMobile</code> sont corrects.  Ã‡a nous dirait que le problÃ¨me vient de <code class=\"language-text\">useTheme()</code>.  Ou peut-Ãªtre verrions-nous que <code class=\"language-text\">width</code> lui-mÃªme est faussÃ©, ce qui nous orienterait vers <code class=\"language-text\">useWindowWidth()</code>.</p>\n<p><strong>Un simple coup dâ€™Å“il aux valeurs intermÃ©diaires nous dirait lequel de nos Hooks, dÃ©finis au niveau racine, est Ã  lâ€™origine du bug.</strong>  On nâ€™a pas besoin dâ€™aller fouiller dans <em>toutes</em> les implÃ©mentations.</p>\n<p>Alors seulement on pourra Â«Â zoomerÂ Â» sur le code du hook qui a un bug, et reprendre notre dÃ©bogage.</p>\n<p>Ce point devient critique si la profondeur dâ€™imbrication de nos Hooks personnalisÃ©s augmente.  Imaginez que nous ayons 3 niveaux dâ€™imbrication de nos Hooks personnalisÃ©s, chacun utilisant 3 Hooks personnalisÃ©s distincts.  La <a href=\"/the-bug-o-notation/\">diffÃ©rence</a> entre chercher un bug Ã  <strong>3 endroits</strong> au lieu de potentiellement vÃ©rifier <strong>3 + 3Ã—3 + 3Ã—3Ã—3 = 39 endroits</strong> est Ã©norme. Heureusement, <code class=\"language-text\">useState()</code> ne peut pas Â«Â influencerÂ Â» par magie les autres Hooks ou composants.  Sâ€™il renvoie une valeur dÃ©fectueuse, Ã§a laisse une piste quâ€™on peut remonter, comme pour nâ€™importe quelle variable. ğŸ›</p>\n<p><strong>VerdictÂ :</strong> âœ… <code class=\"language-text\">useState()</code> ne masque pas la relation de cause Ã  effet dans notre code.  On peut remonter la piste directement jusquâ€™Ã  lâ€™origine du bug.</p>\n<hr>\n<h2 id=\"pas-un-hook--usebailout\"><a href=\"#pas-un-hook--usebailout\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Pas un HookÂ : <code class=\"language-text\">useBailout()</code></h2>\n<p>Pour des raisons dâ€™optimisation, les composants utilisant des Hooks peuvent choisir de sauter un nouveau rendu.</p>\n<p>Une des maniÃ¨res dâ€™y parvenir consiste Ã  enrober le composant complet par un <a href=\"https://reactjs.org/blog/2018/10/23/react-v-16-6.html#reactmemo\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">React.memo()</code></a>.  Ã‡a fait automatiquement lâ€™impasse sur le rendu si les <em>props</em> sont identiques en surface avec celles du rendu prÃ©cÃ©dent.  Câ€™est similaire au recours Ã  <code class=\"language-text\">PureComponent</code> pour les classes.</p>\n<p><code class=\"language-text\">React.memo()</code> prend un composant et renvoie un composantÂ :</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Button</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">memo</span><span class=\"token punctuation\">(</span>Button<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span></code></pre></div>\n<p><strong>Mais pourquoi ne pas en faire plutÃ´t un HookÂ ?</strong></p>\n<p>Les proposition dans ce sens, quâ€™elles lâ€™appellent <code class=\"language-text\">useShouldComponentUpdate()</code>, <code class=\"language-text\">usePure()</code>, <code class=\"language-text\">useSkipRender()</code>, ou <code class=\"language-text\">useBailout()</code>, ont tendance Ã  ressembler Ã  ceciÂ :</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Button</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> color <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// âš ï¸ Cette API nâ€™existe pas</span>\n  <span class=\"token function\">useBailout</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">prevColor</span> <span class=\"token operator\">=></span> prevColor <span class=\"token operator\">!==</span> color<span class=\"token punctuation\">,</span> color<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">className</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token string\">'button-'</span> <span class=\"token operator\">+</span> color<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      OK\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>On trouve quelques variations supplÃ©mentaires (par ex. un simple marqueur <code class=\"language-text\">usePure()</code>), mais dans les grandes lignes toutes partagent les mÃªmes failles.</p>\n<h3 id=\"composition-1\"><a href=\"#composition-1\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Composition</h3>\n<p>Imaginons que nous essayions dâ€™utiliser <code class=\"language-text\">useBailout()</code> dans deux Hooks personnalisÃ©sÂ :</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">useFriendStatus</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">friendID</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>isOnline<span class=\"token punctuation\">,</span> setIsOnline<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token comment\">// âš ï¸ Cette API nâ€™existe pas</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token function\">useBailout</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">prevIsOnline</span> <span class=\"token operator\">=></span> prevIsOnline <span class=\"token operator\">!==</span> isOnline<span class=\"token punctuation\">,</span> isOnline<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleStatusChange</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">status</span> <span class=\"token operator\">=></span> <span class=\"token function\">setIsOnline</span><span class=\"token punctuation\">(</span>status<span class=\"token punctuation\">.</span>isOnline<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ChatAPI<span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span>friendID<span class=\"token punctuation\">,</span> handleStatusChange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> ChatAPI<span class=\"token punctuation\">.</span><span class=\"token function\">unsubscribe</span><span class=\"token punctuation\">(</span>friendID<span class=\"token punctuation\">,</span> handleStatusChange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> isOnline<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">useWindowWidth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>width<span class=\"token punctuation\">,</span> setWidth<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>innerWidth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token comment\">// âš ï¸ Cette API nâ€™existe pas</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token function\">useBailout</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">prevWidth</span> <span class=\"token operator\">=></span> prevWidth <span class=\"token operator\">!==</span> width<span class=\"token punctuation\">,</span> width<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleResize</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setWidth</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>innerWidth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'resize'</span><span class=\"token punctuation\">,</span> handleResize<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> window<span class=\"token punctuation\">.</span><span class=\"token function\">removeEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'resize'</span><span class=\"token punctuation\">,</span> handleResize<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> width<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Voyons maintenant ce qui se passe si on utilise les deux dans le mÃªme composantÂ :</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">ChatThread</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> friendID<span class=\"token punctuation\">,</span> isTyping <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> width <span class=\"token operator\">=</span> <span class=\"token function\">useWindowWidth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> isOnline <span class=\"token operator\">=</span> <span class=\"token function\">useFriendStatus</span><span class=\"token punctuation\">(</span>friendID<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ChatLayout</span></span> <span class=\"token attr-name\">width</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>width<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">FriendStatus</span></span> <span class=\"token attr-name\">isOnline</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>isOnline<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">      </span><span class=\"token punctuation\">{</span>isTyping <span class=\"token operator\">&amp;&amp;</span> <span class=\"token string\">'En train dâ€™Ã©crireâ€¦'</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">ChatLayout</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Quand est-ce que Ã§a refait un renduÂ ?</p>\n<p>Si chaque appel Ã  <code class=\"language-text\">useBailout()</code> a le pouvoir de sauter la mise Ã  jour, alors les mises Ã  jour de <code class=\"language-text\">useWindowWidth()</code> seraient bloquÃ©es par <code class=\"language-text\">useFriendStatus()</code>, et rÃ©ciproquement. <strong>Ces Hooks se casseraient lâ€™un lâ€™autre.</strong></p>\n<p>Inversement, si <code class=\"language-text\">useBailout()</code> nâ€™Ã©tait pris en compte que lorsque <em>tous</em> ses appels au sein de ce composant Â«Â sont dâ€™accordÂ Â» pour bloquer une mise Ã  jour, notre <code class=\"language-text\">ChatThread</code> ne se mettrait pas Ã  jour lorsque la <em>prop</em> <code class=\"language-text\">isTyping</code> change.</p>\n<p>Pire encoreÂ : avec cette sÃ©mantique <strong>nâ€™importe quel Hook ajoutÃ© Ã  <code class=\"language-text\">ChatThread</code> pourrait casser sâ€™il nâ€™appelle pas <em>aussi</em> <code class=\"language-text\">useBailout()</code></strong>.  Parce que dans le cas contraire, il ne pourrait pas Â«Â voter contreÂ Â» la dÃ©cision de sauter le rendu faite par <code class=\"language-text\">useWindowWidth()</code> et <code class=\"language-text\">useFriendStatus()</code>.</p>\n<p><strong>VerdictÂ :</strong> ğŸ”´ <code class=\"language-text\">useBailout()</code> enfreint la composition.  Lâ€™ajouter dans un Hook casse les mises Ã  jour dâ€™Ã©tat dans les autres Hooks.  Nous voulons des APIs qui sont <a href=\"/optimized-for-change/\">anti-fragiles</a>, et ce comportement en est pratiquement lâ€™opposÃ©.</p>\n<h3 id=\"dÃ©bogage-1\"><a href=\"#d%C3%A9bogage-1\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DÃ©bogage</h3>\n<p>Comment un Hook comme <code class=\"language-text\">useBailout()</code> impacterait-il le dÃ©bogageÂ ?</p>\n<p>Voyons Ã§a sur le mÃªme exempleÂ :</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">ChatThread</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> friendID<span class=\"token punctuation\">,</span> isTyping <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> width <span class=\"token operator\">=</span> <span class=\"token function\">useWindowWidth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> isOnline <span class=\"token operator\">=</span> <span class=\"token function\">useFriendStatus</span><span class=\"token punctuation\">(</span>friendID<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ChatLayout</span></span> <span class=\"token attr-name\">width</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>width<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">FriendStatus</span></span> <span class=\"token attr-name\">isOnline</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>isOnline<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n      </span><span class=\"token punctuation\">{</span>isTyping <span class=\"token operator\">&amp;&amp;</span> <span class=\"token string\">'En train dâ€™Ã©crireâ€¦'</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">ChatLayout</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Imaginons que le libellÃ© <code class=\"language-text\">En train dâ€™Ã©crireâ€¦</code> nâ€™apparaisse pas quand on sâ€™y attend, alors mÃªme que, quelque part plus haut dans lâ€™arbre, la <em>prop</em> a changÃ©.  Comment dÃ©boguer Ã§aÂ ?</p>\n<p><strong>Normalement, avec React on peut rÃ©pondre en confiance Ã  cette question en regardant <em>plus haut</em>.</strong>  Si <code class=\"language-text\">ChatThread</code> nâ€™a pas reÃ§u une nouvelle valeur pour <code class=\"language-text\">isTyping</code>, on peut ouvrir le composant qui fait le rendu de <code class=\"language-text\">&lt;ChatThread isTyping={myVar} /&gt;</code> et vÃ©rifier <code class=\"language-text\">myVar</code>, et ainsi de suite.  Dans lâ€™un de ces niveaux, nous trouverons soit un bug dâ€™optimisation dans <code class=\"language-text\">shouldComponentUpdate()</code>, soit une valeur incorrecte de <code class=\"language-text\">isTyping</code> qui se retrouve transmise plus bas.  Jeter un Å“il Ã  chaque composant de la chaÃ®ne suffit gÃ©nÃ©ralement Ã  repÃ©rer lâ€™origine du problÃ¨me.</p>\n<p>En revanche, si le Hook <code class=\"language-text\">useBailout()</code> existait, on ne pourrait jamais connaÃ®tre la raison du saut dâ€™un rendu tant quâ€™on nâ€™aurait pas examinÃ© <em>la totalitÃ© des Hooks personnalisÃ©s</em> (en profondeur qui plus est) utilisÃ©s par notre <code class=\"language-text\">ChatThread</code> et les composants de sa propre chaÃ®ne de parents.  Dans la mesure oÃ¹ chaque composant parent peut <em>aussi</em> avoir ses propres Hooks personnalisÃ©s, Ã§a <a href=\"/the-bug-o-notation/\">monte trÃ¨s mal en complexitÃ©</a>.</p>\n<p>Ã‡a revient Ã  chercher un tournevis dans une armoire Ã  tiroirs, oÃ¹ chaque tiroir contiendrait un tas dâ€™autres petites armoires Ã  tiroirs, et on nâ€™a aucune idÃ©e de jusquâ€™Ã  quel niveau de profondeur on va devoir aller.</p>\n<p><strong>VerdictÂ :</strong> ğŸ”´ Non seulement <code class=\"language-text\">useBailout()</code> enfreint la composition, mais il augmente aussi de beaucoup le nombre dâ€™Ã©tapes de dÃ©bogage et la charge mentale nÃ©cessaires pour trouver la cause dâ€™un saut incorrect de renduâ€”une augmentation parfois exponentielle.</p>\n<hr>\n<p>Nous venons dâ€™examiner un Hook existant, <code class=\"language-text\">useState()</code>, et un Hook frÃ©quemment suggÃ©rÃ© mais volontairement indisponible, <code class=\"language-text\">useBailout()</code>.  Nous les avons comparÃ©s au regard de la Composition et du DÃ©bogage, et discutÃ© des raisons qui font que lâ€™un fonctionne et lâ€™autre non.</p>\n<p>MÃªme sâ€™il nâ€™y a pas de Â«Â version HookÂ Â» de <code class=\"language-text\">memo()</code> et <code class=\"language-text\">shouldComponentUpdate()</code>, React <em>fournit bien</em> un Hook appelÃ© <a href=\"https://reactjs.org/docs/hooks-reference.html#usememo\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">useMemo()</code></a>.  Son objectif a bien un rapport, mais la sÃ©mantique des deux est suffisamment diffÃ©rente pour quâ€™on ne tombe pas dans les piÃ¨ges dÃ©taillÃ©s plus haut.</p>\n<p><code class=\"language-text\">useBailout()</code> nâ€™est quâ€™un exemple dâ€™un service qui ne pourrait pas bien fonctionner en tant que Hook. Mais il y en a dâ€™autresâ€”par exemple <code class=\"language-text\">useProvider()</code>, <code class=\"language-text\">useCatch()</code>, ou <code class=\"language-text\">useSuspense()</code>.</p>\n<p>Pouvez-vous deviner pourquoiÂ ?</p>\n<p><em>(ChuchotementÂ : Compositionâ€¦ DÃ©bogageâ€¦)</em></p>","timeToRead":9,"frontmatter":{"title":"Pourquoi X nâ€™est-il pas un hookÂ ?","date":"January 26, 2019","spoiler":"Câ€™est pas parce quâ€™on peut quâ€™on devrait.","cta":null},"fields":{"slug":"/fr/why-isnt-x-a-hook/","langKey":"fr"}}},"pageContext":{"slug":"/fr/why-isnt-x-a-hook/","translations":["de","es","fr","it","ko","pt-br","zh-hans"],"translatedLinks":[]}}}