{"componentChunkName":"component---src-templates-blog-post-js","path":"/fr/how-does-react-tell-a-class-from-a-function/","result":{"data":{"site":{"siteMetadata":{"title":"Overreacted","author":"Dan Abramov"}},"markdownRemark":{"id":"1a8e7e0a-75e1-5550-8f45-b9d81186f7ea","html":"<p>Observez ce composant <code class=\"language-text\">Greeting</code> dÃ©fini par une fonctionÂ :</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Greeting</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Bonjour</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>React permet aussi de le dÃ©finir par une classeÂ :</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Greeting</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Bonjour</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>(Jusquâ€™Ã  <a href=\"https://reactjs.org/docs/hooks-intro.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">rÃ©cemment</a>, câ€™Ã©tait la seule maniÃ¨re dâ€™utiliser certaines fonctionnalitÃ©s telles que la gestion dâ€™Ã©tat.)</p>\n<p>Quand vous voulez afficher un <code class=\"language-text\">&lt;Greeting /&gt;</code>, vous ne vous prÃ©occupez pas de la faÃ§on dont il a Ã©tÃ© dÃ©finiÂ :</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// Classe ou fonction â€” peu importe.</span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Greeting</span></span> <span class=\"token punctuation\">/></span></span></code></pre></div>\n<p>Mais pour <em>React lui-mÃªme</em>, Ã§a fait une diffÃ©renceÂ !</p>\n<p>Si <code class=\"language-text\">Greeting</code> est une fonction, React a besoin de lâ€™appelerÂ :</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// Votre code</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">Greeting</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Bonjour</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Dans React</span>\n<span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token function\">Greeting</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// &lt;p>Bonjour&lt;/p></span></code></pre></div>\n<p>Mais si <code class=\"language-text\">Greeting</code> est une classe, React doit lâ€™instancier Ã  lâ€™aide de lâ€™opÃ©rateur <code class=\"language-text\">new</code> et <em>ensuite</em> appeler la mÃ©thode <code class=\"language-text\">render</code> sur lâ€™instance nouvellement crÃ©Ã©eÂ :</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// Votre code</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Greeting</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Bonjour</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Dans React</span>\n<span class=\"token keyword\">const</span> instance <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Greeting</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Greeting {}</span>\n<span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> instance<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// &lt;p>Bonjour&lt;/p></span></code></pre></div>\n<p>Dans les deux cas, lâ€™objectif de React est dâ€™obtenir le nÅ“ud rendu (dans cette exemple, <code class=\"language-text\">&lt;p&gt;Bonjour&lt;/p&gt;</code>).  Mais les Ã©tapes exactes dÃ©pendent de la faÃ§on dont <code class=\"language-text\">Greeting</code> est dÃ©fini.</p>\n<p><strong>Alors comment React sait-il si quelque chose est une classe ou une fonctionÂ ?</strong></p>\n<p>Tout comme dans mon <a href=\"/why-do-we-write-super-props/\">prÃ©cÃ©dent article</a>, <strong>vous nâ€™avez pas <em>besoin</em> de savoir Ã§a pour Ãªtre efficace avec React.</strong>  Je ne le savais pas moi-mÃªme pendant des annÃ©es.  Ne faites pas de cet article une question dâ€™entretien technique.  En fait, cet article est plus Ã  propos de JavaScript que de React.</p>\n<p>Ce blog est pour les personnes curieuses qui veulent savoir <em>pourquoi</em> React fonctionne dâ€™une certaine maniÃ¨re.  ÃŠtes-vous une telle personneÂ ?  Alors creusons ensemble.</p>\n<p><strong>Ce sera un long voyage.  Attachez votre ceinture.  Cet article nâ€™a pas beaucoup dâ€™informations sur React lui-mÃªme, mais nous explorerons des aspects de <code class=\"language-text\">new</code>, <code class=\"language-text\">this</code>, <code class=\"language-text\">class</code>, des fonctions flÃ©chÃ©es, de <code class=\"language-text\">prototype</code>, <code class=\"language-text\">__proto__</code>, <code class=\"language-text\">instanceof</code>, et de la faÃ§on dont toutes ces choses fonctionnent ensemble en JavaScript.  Heureusement, vous nâ€™avez pas tellement besoin de penser Ã  tout Ã§a quand vous <em>utilisez</em> React.  Mais si vous implÃ©mentez Reactâ€¦</strong></p>\n<p>(Si tout ce qui vous intÃ©resse câ€™est de connaÃ®tre la rÃ©ponse, dÃ©roulez jusquâ€™Ã  la toute fin.)</p>\n<hr>\n<p>Pour commencer, nous devons comprendre pourquoi il est important de traiter les fonctions et les classes diffÃ©remment.  Remarquez comment nous utilisons lâ€™opÃ©rateur <code class=\"language-text\">new</code> pour appeler une classeÂ :</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// Si Greeting est une fonction</span>\n<span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token function\">Greeting</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// &lt;p>Bonjour&lt;/p></span>\n\n<span class=\"token comment\">// Si Greeting est une classe</span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">const</span> instance <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Greeting</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Greeting {}</span></span><span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> instance<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// &lt;p>Bonjour&lt;/p></span></code></pre></div>\n<p>Essayons de comprendre Ã  peu prÃ¨s ce que fait lâ€™opÃ©rateur <code class=\"language-text\">new</code> en JavaScript.</p>\n<hr>\n<p>Autrefois, JavaScript nâ€™avait pas de classes.  Cependant, vous pouviez exprimer une approche similaire aux classes avec de simples fonctions.  <strong>ConcrÃ¨tement, vous pouvez utiliser <em>nâ€™importe quelle</em> fonction dans une optique similaire Ã  un constructeur en ajoutant <code class=\"language-text\">new</code> avant son appelÂ :</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// Juste une function</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">Person</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">var</span> fred <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Person</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Fred'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// âœ… Person {name: 'Fred'}</span>\n<span class=\"token keyword\">var</span> george <span class=\"token operator\">=</span> <span class=\"token function\">Person</span><span class=\"token punctuation\">(</span><span class=\"token string\">'George'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ğŸ”´ Ne marchera pas</span></code></pre></div>\n<p>On peut toujours Ã©crire du code de ce genre de nos joursÂ ! Essayez donc dans les DevTools.</p>\n<p>Si vous appeliez <code class=\"language-text\">Person(&#39;Fred&#39;)</code> <strong>sans</strong> <code class=\"language-text\">new</code>, <code class=\"language-text\">this</code> Ã  lâ€™intÃ©rieur rÃ©fÃ©rencerait un objet global et inutile (par exemple, <code class=\"language-text\">window</code> ou <code class=\"language-text\">undefined</code>).  De sorte que notre code planterait, ou ferait un truc idiot comme dÃ©finir <code class=\"language-text\">window.name</code>.</p>\n<p>En ajoutant <code class=\"language-text\">new</code> avant lâ€™appel, nous disonsÂ : Â«Â HÃ©, JavaScript, je sais bien que <code class=\"language-text\">Person</code> est juste une fonction mais faisons comme si câ€™Ã©tait un genre de constructeur de classe. <strong>CrÃ©e un objet <code class=\"language-text\">{}</code> et fais-le rÃ©fÃ©rencer par <code class=\"language-text\">this</code> au sein de la fonction <code class=\"language-text\">Person</code>, pour que je puisse y affecter des trucs genre <code class=\"language-text\">this.name</code>.  Puis renvoie-moi cet objet.</strong>Â Â»</p>\n<p>Câ€™est en rÃ©sumÃ© ce que fait lâ€™opÃ©rateur <code class=\"language-text\">new</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">var</span> fred <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Person</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Fred'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// MÃªme objet que `this` dans `Person`</span></code></pre></div>\n<p>Lâ€™opÃ©rateur <code class=\"language-text\">new</code> rend Ã©galement accessible via lâ€™objet <code class=\"language-text\">fred</code> tout ce que nous mettons dans <code class=\"language-text\">Person.prototype</code>Â :</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Person</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token class-name\">Person</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">sayHi</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Bonjour, je mâ€™appelle '</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\"><span class=\"token punctuation\">}</span></span>\n<span class=\"token keyword\">var</span> fred <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Person</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Fred'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">fred<span class=\"token punctuation\">.</span><span class=\"token function\">sayHi</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span></code></pre></div>\n<p>Et câ€™est comme Ã§a quâ€™on simulait des classes avant que JavaScript ne fournisse une syntaxe dÃ©diÃ©e.</p>\n<hr>\n<p>Donc <code class=\"language-text\">new</code> existe en JavaScript depuis des lustres.  En revanche, les classes sont plus rÃ©centes.  Elles nous permettent de rÃ©Ã©crire le code ci-dessus pour mieux coller Ã  notre intentionÂ :</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Person</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token function\">sayHi</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Bonjour, je mâ€™appelle '</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">let</span> fred <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Person</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Fred'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nfred<span class=\"token punctuation\">.</span><span class=\"token function\">sayHi</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><em>Saisir lâ€™intention du dÃ©veloppeur</em> est une part importante de la conception de langage et dâ€™API.</p>\n<p>Si vous Ã©crivez une fonction, JavaScript ne peut pas deviner si vous souhaitez lâ€™utiliser comme <code class=\"language-text\">alert()</code> ou si ce sera un constructeur comme <code class=\"language-text\">new Person()</code>.  Oublier de prÃ©ciser <code class=\"language-text\">new</code> pour une fonction comme <code class=\"language-text\">Person</code> donnerait des rÃ©sultats inattendus.</p>\n<p><strong>La syntaxe de classes nous permet de direÂ : Â«Â ce nâ€™est pas juste une fonctionâ€”câ€˜est une classe et elle a un constructeur.Â Â»</strong>  Si vous oubliez le <code class=\"language-text\">new</code> en lâ€™appelant, JavaScript lÃ¨vera une erreurÂ :</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">let</span> fred <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Person</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Fred'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// âœ…  Si Person est une fonction, Ã§a marche</span>\n<span class=\"token comment\">// âœ…  Si Person est une classe, Ã§a marche aussi</span>\n\n<span class=\"token keyword\">let</span> george <span class=\"token operator\">=</span> <span class=\"token function\">Person</span><span class=\"token punctuation\">(</span><span class=\"token string\">'George'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// On a oubliÃ© `new`</span>\n<span class=\"token comment\">// ğŸ˜³ Si Person est une fonction de type constructeur : comportement foireux</span>\n<span class=\"token comment\">// ğŸ”´ Si Person est une classe : Ã©chec immÃ©diat</span></code></pre></div>\n<p>Ã‡a nous aide a attraper les erreurs tÃ´t au lieu de devoir attendre un bug obscur du style <code class=\"language-text\">this.name</code> devenant <code class=\"language-text\">window.name</code> au lieu de <code class=\"language-text\">george.name</code>.</p>\n<p>Ceci dit, Ã§a signifie que React a besoin de mettre un <code class=\"language-text\">new</code> avant dâ€™appeler une classe.  Il ne peut pas juste lâ€™appeler comme une fonction classique, ou JavaScript traitera Ã§a comme une erreurÂ !</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Counter</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Bonjour</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// ğŸ”´ React ne peut pas se contenter de faire Ã§a :</span>\n<span class=\"token keyword\">const</span> instance <span class=\"token operator\">=</span> <span class=\"token function\">Counter</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Ã‡a ne sent pas bon.</p>\n<hr>\n<p>Avant de voir comment React rÃ©sout ce problÃ¨me, il faut bien se souvenir que la plupart des gens utilisent React avec des transpileurs comme Babel pour permettre aux anciens navigateurs de tirer parti de fonctionnalitÃ©s modernes, comme les classes.  Donc nous devons garder les transpileurs Ã  lâ€™esprit dans notre approche.</p>\n<p>Dans les premiÃ¨res versions de Babel, les classes pouvaient Ãªtre appelÃ©es sans <code class=\"language-text\">new</code>.  Ã‡a a toutefois Ã©tÃ© corrigÃ©â€”en gÃ©nÃ©rant un peu de code en plusÂ :</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Person</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// LÃ©gÃ¨rement simplifiÃ© par rapport au code pondu par Babel</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span> <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">Person</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TypeError</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Cannot call a class as a function\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// Notre code :</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">new</span> <span class=\"token class-name\">Person</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Fred'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// âœ… Okay</span>\n<span class=\"token function\">Person</span><span class=\"token punctuation\">(</span><span class=\"token string\">'George'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// ğŸ”´ Cannot call a class as a function</span></code></pre></div>\n<p>Vous avez peut-Ãªtre dÃ©jÃ  vu ce genre de code dans votre <em>bundle</em>. Câ€™est la raison dâ€˜Ãªtre de tous ces appels Ã  <code class=\"language-text\">_classCallCheck</code>. (On peut rÃ©duire la taille du <em>bundle</em> en optant pour le mode Â«Â laxisteÂ Â», sans vÃ©rifications, mais Ã§a peut compliquer la transition ultÃ©rieure aux classes natives.)</p>\n<hr>\n<p>Ã€ ce stade, vous devriez avoir une comprÃ©hension suffisante de la diffÃ©rence entre appeler une fonction avec <code class=\"language-text\">new</code> ou sans <code class=\"language-text\">new</code>Â :</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th><code class=\"language-text\">new Person()</code></th>\n<th><code class=\"language-text\">Person()</code></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code class=\"language-text\">class</code></td>\n<td>âœ… <code class=\"language-text\">this</code> est une instance de <code class=\"language-text\">Person</code></td>\n<td>ğŸ”´ <code class=\"language-text\">TypeError</code></td>\n</tr>\n<tr>\n<td><code class=\"language-text\">function</code></td>\n<td>âœ… <code class=\"language-text\">this</code> est une instance de <code class=\"language-text\">Person</code></td>\n<td>ğŸ˜³ <code class=\"language-text\">this</code> est <code class=\"language-text\">window</code> ou <code class=\"language-text\">undefined</code></td>\n</tr>\n</tbody>\n</table>\n<p>Câ€™est pourquoi il est important pour React dâ€™appeler votre composant correctement. <strong>Si votre composant est dÃ©fini comme une classe, React doit utiliser <code class=\"language-text\">new</code> pour lâ€™appeler.</strong></p>\n<p>Alors React peut-il juste vÃ©rifier si quelque chose est une classe ou nonÂ ?</p>\n<p>Pas si simpleÂ ! MÃªme si on pourrait <a href=\"https://stackoverflow.com/questions/29093396/how-do-you-check-the-difference-between-an-ecmascript-6-class-and-function\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">distinguer une classe dâ€™une fonction en JavaScript</a>, Ã§a ne nous aiderait pas pour les classes transformÃ©es par des outils tels que Babel.  Pour le navigateur, il sâ€™agirait de fonctions classiques.  Pas de bol pour React.</p>\n<hr>\n<p>OK, alors peut-Ãªtre React peut-il juste utiliser <code class=\"language-text\">new</code> pour tous les appelsÂ ?  Malheureusement, Ã§a ne marcherait pas non plus.</p>\n<p>Avec les fonctions classiques, les appeler avec <code class=\"language-text\">new</code> leur donnerait une instance comme <code class=\"language-text\">this</code>.  Câ€™est souhaitable pour les fonctions Ã©crites en tant que constructeurs (comme notre <code class=\"language-text\">Person</code> plus haut), mais Ã§a serait problÃ©matique pour les fonctions de composantsÂ :</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Greeting</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// On ne sâ€™attend pas Ã  ce que `this` soit ici une instance quelconque</span>\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Bonjour</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Ã‡a serait toutefois acceptable.  Il y a deux <em>autres</em> raisons pour lesquelles on laissera tomber cette idÃ©e.</p>\n<hr>\n<p>La premiÃ¨re raison qui empÃªche <code class=\"language-text\">new</code> de marcher dans ce cas de figure concerne les fonctions flÃ©chÃ©es natives (pas celles transpilÃ©es par Babel), car les appeler avec <code class=\"language-text\">new</code> lÃ¨ve une erreurÂ :</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Greeting</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Bonjour</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">new</span> <span class=\"token class-name\">Greeting</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ğŸ”´ Greeting is not a constructor</span></code></pre></div>\n<p>Câ€™est un comportement volontaire qui procÃ¨de de la conception des fonctions flÃ©chÃ©es.  Un des principaux avantages des fonctions flÃ©chÃ©es, câ€™est quâ€™elles <em>nâ€™ont pas</em> leur propre valeur de <code class=\"language-text\">this</code>â€”Ã  la place, <code class=\"language-text\">this</code> est rÃ©solu lexicalement, depuis la plus proche portÃ©e de fonction classiqueÂ :</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Friends</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span>    <span class=\"token keyword\">const</span> friends <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>friends<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> friends<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">friend</span> <span class=\"token operator\">=></span>\n      <span class=\"token operator\">&lt;</span>Friend\n<span class=\"gatsby-highlight-code-line\">        <span class=\"token comment\">// `this` est rÃ©solu depuis la mÃ©thode `render`</span></span><span class=\"gatsby-highlight-code-line\">        size<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">}</span></span>        name<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>friend<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">}</span>\n        key<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>friend<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">}</span>\n      <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>OK, donc <strong>les fonctions flÃ©chÃ©es nâ€™ont pas leur propre <code class=\"language-text\">this</code>.</strong>  Mais Ã§a veut dire quâ€™elles ne peuvent pas Ãªtre des constructeursÂ !</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Person</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ğŸ”´ Ã‡a nâ€™aurait aucun sens !</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Câ€™est pourquoi <strong>JavaScript interdit lâ€™appel dâ€™une fonction flÃ©chÃ©e avec <code class=\"language-text\">new</code>.</strong>  Si vous le faites, câ€™est probablement une erreur de toutes faÃ§ons, et il vaut mieux vous le dire tÃ´t.  Câ€™est comme lorsque JavaScript ne vous laisse pas appeler une classe <em>sans</em> <code class=\"language-text\">new</code>.</p>\n<p>Tout Ã§a est bien joli mais Ã§a fait Ã©chouer notre plan.  React ne peut pas juste appeler <code class=\"language-text\">new</code> sur tout parce que Ã§a casserait les fonctions flÃ©chÃ©esÂ !  On pourrait essayer de dÃ©tecter les fonctions flÃ©chÃ©es spÃ©cifiquement grÃ¢ce Ã  leur manque de <code class=\"language-text\">prototype</code>, et ne pas appeler <code class=\"language-text\">new</code> sur ellesÂ :</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>prototype <span class=\"token comment\">// undefined</span>\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>prototype <span class=\"token comment\">// {constructor: f}</span></code></pre></div>\n<p>Mais Ã§a <a href=\"https://github.com/facebook/react/issues/4599#issuecomment-136562930\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ne marcherait pas</a> pour les fonctions transpilÃ©es par Babel. Ã‡a nâ€™est peut-Ãªtre pas un gros sujet, mais câ€™est une raison de plus qui fait que cette approche est une impasse.</p>\n<hr>\n<p>Une autre raison qui nous empÃªche dâ€™utiliser systÃ©matiquement <code class=\"language-text\">new</code>Â : Ã§a empÃªcherait React de permettre aux composants de renvoyer des chaÃ®nes de caractÃ¨res ou dâ€™autres types de primitives.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Greeting</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token string\">'Bonjour'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">Greeting</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// âœ… 'Bonjour'</span>\n<span class=\"token keyword\">new</span> <span class=\"token class-name\">Greeting</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ğŸ˜³ Greeting {}</span></code></pre></div>\n<p>Câ€™est lÃ  aussi dÃ» aux particularitÃ©s de conception de lâ€™<a href=\"https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Op%C3%A9rateurs/L_op%C3%A9rateur_new\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">opÃ©rateur <code class=\"language-text\">new</code></a>. Comme nous lâ€™avons vu plus tÃ´t, <code class=\"language-text\">new</code> dit au moteur JavaScript de crÃ©er un objet, en faire le <code class=\"language-text\">this</code> au sein de la fonction, et au final nous le renvoyer comme rÃ©sultat de <code class=\"language-text\">new</code>.</p>\n<p>Seulement voilÃ , JavaScript permet aussi Ã  une fonction appelÃ©e avec <code class=\"language-text\">new</code> de <em>remplacer</em> la valeur de retour de <code class=\"language-text\">new</code> en renvoyant un autre objet.  Câ€™Ã©tait apparemment considÃ©rÃ© utile pour des besoins comme le recyclage dâ€™instance (<em>pooling</em>)Â :</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"gatsby-highlight-code-line\"><span class=\"token comment\">// CrÃ©Ã© Ã  la demande (â€œlazilyâ€)</span></span><span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">var</span> zeroVector <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">Vector</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">x<span class=\"token punctuation\">,</span> y</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">===</span> <span class=\"token number\">0</span> <span class=\"token operator\">&amp;&amp;</span> y <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>zeroVector <span class=\"token operator\">!==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">      <span class=\"token comment\">// RÃ©utilise la mÃªme instance</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token keyword\">return</span> zeroVector<span class=\"token punctuation\">;</span></span>    <span class=\"token punctuation\">}</span>\n    zeroVector <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>x <span class=\"token operator\">=</span> x<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>y <span class=\"token operator\">=</span> y<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Vector</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">var</span> b <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Vector</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">var</span> c <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Vector</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ğŸ˜² b === c</span></span></code></pre></div>\n<p>Le hic, câ€™est que <code class=\"language-text\">new</code> va aussi <em>complÃ¨tement ignorer</em> la valeur de retour de la fonction si ce nâ€™est <em>pas</em> un objet.  Si vous renvoyez un littÃ©ral texte ou numÃ©rique, câ€™est comme si vous nâ€™aviez Ã©crit aucun <code class=\"language-text\">return</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Answer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token number\">42</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">Answer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// âœ… 42</span>\n<span class=\"token keyword\">new</span> <span class=\"token class-name\">Answer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ğŸ˜³ Answer {}</span></code></pre></div>\n<p>Il est tout simplement impossible de rÃ©cupÃ©rer la valeur primitive de retour (telle quâ€™un nombre ou une chaÃ®ne) depuis une fonction appelÃ©e avec <code class=\"language-text\">new</code>.  Donc si React utilisait toujours <code class=\"language-text\">new</code>, il ne pourrait pas autoriser les composants Ã  renvoyer des chaÃ®nes de caractÃ¨resÂ !</p>\n<p>Câ€™est inacceptable, donc on a besoin de trouver un compromis.</p>\n<hr>\n<p>Bon, quâ€™a-t-on appris jusquâ€™iciÂ ?  React a besoin dâ€™appeler les classes (y compris celles transpilÃ©es par Babel) <em>avec</em> <code class=\"language-text\">new</code>, mais il doit aussi appeler les fonctions classiques ou flÃ©chÃ©es (y compris celles transpilÃ©es par Babel) <em>sans</em> <code class=\"language-text\">new</code>.  Et il nâ€™y a aucun moyen fiable de distinguer entre les deux.</p>\n<p><strong>Si on ne peut pas rÃ©soudre un problÃ¨me gÃ©nÃ©ral, peut-on en rÃ©soudre un plus spÃ©cifiqueÂ ?</strong></p>\n<p>Quand vous dÃ©finissez un composant comme classe, vous allez probablement Ã©tendre <code class=\"language-text\">React.Component</code>, afin de tirer parti des mÃ©thodes prÃ©dÃ©finies comme <code class=\"language-text\">this.setState()</code>.  <strong>PlutÃ´t que dâ€™essayer de dÃ©tecter toutes les classes, peut-on seulement dÃ©tecter les descendantes de <code class=\"language-text\">React.Component</code>Â ?</strong></p>\n<p><em>Spoiler</em>Â : câ€™est exactement ce que fait React.</p>\n<hr>\n<p>La maniÃ¨re idiomatique de vÃ©rifier si <code class=\"language-text\">Greeting</code> est une classe de composant React serait sans doute de tester si <code class=\"language-text\">Greeting.prototype instanceof React.Component</code>Â :</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">A</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">B</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">A</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">B</span><span class=\"token punctuation\">.</span>prototype <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">A</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span></code></pre></div>\n<p>Je sais ce que vous vous dites.  Câ€™est quoi ce trucÂ ?!  Pour rÃ©pondre Ã  Ã§a, il nous faut comprendre le fonctionnement des prototypes en JavaScript.</p>\n<p>Vous avez peut-Ãªtre entendu parler de la Â«Â chaÃ®ne de prototypesÂ Â».  Chaque objet en JavaScript est susceptible dâ€™avoir un Â«Â prototypeÂ Â».  Quand vous Ã©crivez <code class=\"language-text\">fred.sayHi()</code> mais que <code class=\"language-text\">fred</code> est un objet qui nâ€™a pas de propriÃ©tÃ© <code class=\"language-text\">sayHi</code>, on cherche cette propriÃ©tÃ© <code class=\"language-text\">sayHi</code> sur le prototype de <code class=\"language-text\">fred</code>.  Si on ne lâ€™y trouve toujours pas, on cherche sur le prototype suivant dans la chaÃ®neâ€”le prototype du prototype de <code class=\"language-text\">fred</code>. Et ainsi de suite.</p>\n<p><strong>Histoire de rajouter Ã  la confusion, la propriÃ©tÃ© <code class=\"language-text\">prototype</code> dâ€™une classe ou dâ€™une fonction <em>ne rÃ©fÃ©rence pas</em> le prototype de cette valeur.</strong> SÃ©rieux.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Person</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Person</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ğŸ¤ª Pas le prototype de Person</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>Person<span class=\"token punctuation\">.</span>__proto__<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ğŸ˜³ Le prototype de Person</span></code></pre></div>\n<p>Donc la Â«Â chaÃ®ne de prototypesÂ Â» est en fait plutÃ´t <code class=\"language-text\">__proto__.__proto__.__proto__</code> que <code class=\"language-text\">prototype.prototype.prototype</code>. Ã‡a mâ€™a pris des annÃ©es pour comprendre Ã§a.</p>\n<p>Que fait la propriÃ©tÃ© <code class=\"language-text\">prototype</code> dâ€™une fonction ou classe, alorsÂ ? <strong>Câ€™est le <code class=\"language-text\">__proto__</code> fourni Ã  tous les objets instanciÃ©s avec <code class=\"language-text\">new</code> sur cette classe ou fonctionÂ !</strong></p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Person</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token class-name\">Person</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">sayHi</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Bonjour, je mâ€™appelle '</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">var</span> fred <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Person</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Fred'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Cale `fred.__proto__` sur `Person.prototype`</span></span></code></pre></div>\n<p>Et câ€™est le long de cette chaÃ®ne de <code class=\"language-text\">__proto__</code> que JavaScript recherche les propriÃ©tÃ©sÂ :</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">fred<span class=\"token punctuation\">.</span><span class=\"token function\">sayHi</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 1. fred a-t-il une propriÃ©tÃ© sayHi ? Non.</span>\n<span class=\"token comment\">// 2. fred.__proto__ a-t-il une propriÃ©tÃ© sayHi ? Oui. Appelle-la !</span>\n\nfred<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 1. fred a-t-il une propriÃ©tÃ© toString ? Non.</span>\n<span class=\"token comment\">// 2. fred.__proto__ a-t-il un propriÃ©tÃ© toString ? Non.</span>\n<span class=\"token comment\">// 3. fred.__proto__.__proto__ a-t-il une propriÃ©tÃ© toString ? Oui. Appelle-la !</span></code></pre></div>\n<p>En pratique, vous ne devriez pratiquement jamais manipuler <code class=\"language-text\">__proto__</code> directement dans votre code, sauf si vous Ãªtes en train de dÃ©boguer un truc liÃ© Ã  la chaÃ®ne de prototypes.  Si vous souhaitez mettre un truc Ã  disposition dans <code class=\"language-text\">fred.__proto__</code>, vous Ãªtes censÃ©s le placer dans <code class=\"language-text\">Person.prototype</code>.  En tout cas, câ€™Ã©tait lâ€™idÃ©e de base.</p>\n<p>La propriÃ©tÃ© <code class=\"language-text\">__proto__</code> nâ€™Ã©tait mÃªme pas censÃ©e au dÃ©part Ãªtre exposÃ©e  publiquement par les navigateurs, parce que la chaÃ®ne de prototypes Ã©tait considÃ©rÃ©e comme un dÃ©tail dâ€™implÃ©mentation.  Mais certains navigateurs lâ€™ont rendue publique et au final elle a fait lâ€™objet dâ€™une standardisation rÃ©ticente (mais a ensuite Ã©tÃ© dÃ©prÃ©ciÃ©e au profit de <code class=\"language-text\">Object.getPrototypeOf()</code>).</p>\n<p><strong>Et pourtant je trouve toujours hallucinant quâ€™une propriÃ©tÃ© appelÃ©e <code class=\"language-text\">prototype</code> ne vous fournisse pas le prototype dâ€™une valeur</strong> (par exemple, <code class=\"language-text\">fred.prototype</code> est indÃ©fini parce que <code class=\"language-text\">fred</code> nâ€™est pas une fonction).  Personnellement, je trouve que câ€™est la raison majeure pour laquelle mÃªme des dÃ©veloppeurs expÃ©rimentÃ©s ont tendance Ã  comprendre les prototypes JavaScript de travers.</p>\n<hr>\n<p>Il est long cet article, heinÂ ? Je dirais quâ€™on est Ã  80% lÃ .  Tenez le coup.</p>\n<!-- RESUME -->\n<p>On sait que lorsquâ€™on dit <code class=\"language-text\">obj.foo</code>, JavaScript examine en fait <code class=\"language-text\">obj.__proto__</code>, <code class=\"language-text\">obj.__proto__.__proto__</code>, et ainsi de suite.</p>\n<p>Avec les classes, on ne perÃ§oit pas directement ce mÃ©canisme, mais <code class=\"language-text\">extends</code> fonctionne aussi grÃ¢ce Ã  cette bonne vieille chaÃ®ne de prototypes.  Câ€™est ainsi quâ€™une instance de classe React peut accÃ©der Ã  des mÃ©thodes comme <code class=\"language-text\">setState</code>Â :</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Greeting</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span></span>  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Bonjour</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">let</span> c <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Greeting</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">.</span>__proto__<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Greeting.prototype</span>\n<span class=\"gatsby-highlight-code-line\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">.</span>__proto__<span class=\"token punctuation\">.</span>__proto__<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// React.Component.prototype</span></span>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">.</span>__proto__<span class=\"token punctuation\">.</span>__proto__<span class=\"token punctuation\">.</span>__proto__<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Object.prototype</span>\n\nc<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// TrouvÃ© dans c.__proto__ (Greeting.prototype)</span>\n<span class=\"gatsby-highlight-code-line\">c<span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// TrouvÃ© dans c.__proto__.__proto__ (React.Component.prototype)</span></span>c<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// TrouvÃ© dans c.__proto__.__proto__.__proto__ (Object.prototype)</span></code></pre></div>\n<p>En dâ€™autres termes, <strong>quand vous utilisez des classes, la chaÃ®ne des <code class=\"language-text\">__proto__</code> dâ€™une instance reflÃ¨te la hiÃ©rarchie des classesÂ :</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// chaÃ®ne des `extends`</span>\nGreeting\n  â†’ React<span class=\"token punctuation\">.</span>Component\n    â†’ <span class=\"token function\">Object</span> <span class=\"token punctuation\">(</span>implicitement<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// chaÃ®ne des `__proto__`</span>\n<span class=\"token keyword\">new</span> <span class=\"token class-name\">Greeting</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  â†’ <span class=\"token class-name\">Greeting</span><span class=\"token punctuation\">.</span>prototype\n    â†’ React<span class=\"token punctuation\">.</span><span class=\"token class-name\">Component</span><span class=\"token punctuation\">.</span>prototype\n      â†’ <span class=\"token class-name\">Object</span><span class=\"token punctuation\">.</span>prototype</code></pre></div>\n<p>2 Chainz.</p>\n<hr>\n<p>Puisque la chaÃ®ne des <code class=\"language-text\">__proto__</code> reflÃ¨te la hiÃ©rarchie des classes, nous pouvons vÃ©rifier si <code class=\"language-text\">Greeting</code> Ã©tend <code class=\"language-text\">React.Component</code> en commenÃ§ant avec <code class=\"language-text\">Greeting.prototype</code>, puis en remontant le long de la chaÃ®ne des <code class=\"language-text\">__proto__</code>Â :</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// chaÃ®ne des `__proto__`</span>\n<span class=\"token keyword\">new</span> <span class=\"token class-name\">Greeting</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"gatsby-highlight-code-line\">  â†’ <span class=\"token class-name\">Greeting</span><span class=\"token punctuation\">.</span>prototype <span class=\"token comment\">// ğŸ•µï¸ On commence ici</span></span><span class=\"gatsby-highlight-code-line\">    â†’ React<span class=\"token punctuation\">.</span><span class=\"token class-name\">Component</span><span class=\"token punctuation\">.</span>prototype <span class=\"token comment\">// âœ… TrouvÃ© !</span></span>      â†’ <span class=\"token class-name\">Object</span><span class=\"token punctuation\">.</span>prototype</code></pre></div>\n<p>Et devinez quoi, <code class=\"language-text\">x instanceof Y</code> fait exactement ce type de recherche.  Il suit la chaÃ®ne dÃ©marrant avec <code class=\"language-text\">x.__proto__</code> Ã  la recherche de <code class=\"language-text\">Y.prototype</code>.</p>\n<p>Dâ€™habitude, on utilise Ã§a pour dÃ©terminer si un objet est une instance dâ€™une classe donnÃ©e :</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">let</span> greeting <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Greeting</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>greeting <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">Greeting</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n<span class=\"token comment\">// greeting (ğŸ•µï¸â€ On commence ici)</span>\n<span class=\"token comment\">//   .__proto__ â†’ Greeting.prototype (âœ… TrouvÃ© !)</span>\n<span class=\"token comment\">//     .__proto__ â†’ React.Component.prototype</span>\n<span class=\"token comment\">//       .__proto__ â†’ Object.prototype</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>greeting <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n<span class=\"token comment\">// greeting (ğŸ•µï¸â€ On commence ici)</span>\n<span class=\"token comment\">//   .__proto__ â†’ Greeting.prototype</span>\n<span class=\"token comment\">//     .__proto__ â†’ React.Component.prototype (âœ… TrouvÃ© !)</span>\n<span class=\"token comment\">//       .__proto__ â†’ Object.prototype</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>greeting <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n<span class=\"token comment\">// greeting (ğŸ•µï¸â€ On commence ici)</span>\n<span class=\"token comment\">//   .__proto__ â†’ Greeting.prototype</span>\n<span class=\"token comment\">//     .__proto__ â†’ React.Component.prototype</span>\n<span class=\"token comment\">//       .__proto__ â†’ Object.prototype (âœ… TrouvÃ© !)</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>greeting <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">Banana</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// false</span>\n<span class=\"token comment\">// greeting (ğŸ•µï¸â€ On commence ici)</span>\n<span class=\"token comment\">//   .__proto__ â†’ Greeting.prototype</span>\n<span class=\"token comment\">//     .__proto__ â†’ React.Component.prototype</span>\n<span class=\"token comment\">//       .__proto__ â†’ Object.prototype (ğŸ™…â€ Pas trouvÃ© !)</span></code></pre></div>\n<p>Mais Ã§a marcherait tout aussi bien pour dÃ©terminer si une classe en Ã©tend une autreÂ :</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Greeting</span><span class=\"token punctuation\">.</span>prototype <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// greeting</span>\n<span class=\"token comment\">//   .__proto__ â†’ Greeting.prototype (ğŸ•µï¸â€ On commence ici)</span>\n<span class=\"token comment\">//     .__proto__ â†’ React.Component.prototype (âœ… TrouvÃ© !)</span>\n<span class=\"token comment\">//       .__proto__ â†’ Object.prototype</span></code></pre></div>\n<p>Et voilÃ  comment on pourrait dÃ©terminer si quelque chose est une classe de composant React ou une fonction classique.</p>\n<hr>\n<p>Mais ce nâ€™est pas ce que fait React. ğŸ˜³</p>\n<p>Un des piÃ¨ges de la solution Ã  base dâ€™<code class=\"language-text\">instanceof</code>, câ€™est quâ€™elle ne marche pas lorsquâ€™on a de multiples copies de React dans la page, et que le composant quâ€™on examine hÃ©rite du <code class=\"language-text\">React.Component</code> provenant dâ€™une <em>autre</em> copie de React.  Avoir plusieurs copies de React dans un mÃªme projet est une mauvaise idÃ©e pour plusieurs raisons, mais historiquement nous avons essayÃ© dâ€™Ã©viter, autant que possible, que Ã§a pose problÃ¨me. (Ceci dit, avec les Hooks, on <a href=\"https://github.com/facebook/react/issues/13991\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">devra peut-Ãªtre</a> exiger lâ€™unicitÃ©.)</p>\n<p>Une autre heuristique possible serait de vÃ©rifier si une mÃ©thode <code class=\"language-text\">render</code> est prÃ©sente sur le prototype.  Toutefois, Ã  lâ€™Ã©poque on <a href=\"https://github.com/facebook/react/issues/4599#issuecomment-129714112\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">nâ€™Ã©tait pas sÃ»rs</a> de la faÃ§on dont lâ€™API Ã©voluerait.  Chaque vÃ©rification entraÃ®ne un coÃ»t, on ne voulait pas avoir Ã  en faire plusieurs.  Par ailleurs, Ã§a ne marcherait pas non plus si <code class=\"language-text\">render</code> Ã©tait dÃ©finie comme mÃ©thode sur lâ€™instance, avec la syntaxe des initialiseurs de champs par exemple.</p>\n<p>De sorte quâ€™Ã  la place, React <a href=\"https://github.com/facebook/react/pull/4663\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">a ajoutÃ©</a> un drapeau spÃ©cial sur le composant de base.  React vÃ©rifie la prÃ©sence de ce drapeau, et câ€™est comme Ã§a quâ€™il sait si il a affaire Ã  une classe de composant React ou non.</p>\n<p>Au dÃ©but le drapeau Ã©tait dÃ©fini sur la classe de base <code class=\"language-text\">React.Component</code> elle-mÃªmeÂ :</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// Dans React</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Component</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\nComponent<span class=\"token punctuation\">.</span>isReactClass <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// On peut le vÃ©rifier comme ceci</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Greeting</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Component</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>Greeting<span class=\"token punctuation\">.</span>isReactClass<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// âœ… Oui</span></code></pre></div>\n<p>Seulement voilÃ , certaines implÃ©mentations de classes que nous voulions permettre <a href=\"https://github.com/scala-js/scala-js/issues/1900\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ne copiaient pas</a> les propriÃ©tÃ©s statiques (ou ne dÃ©finissaient pas la propriÃ©tÃ© non standard <code class=\"language-text\">__proto__</code>), de sorte que le drapeau disparaissait.</p>\n<p>Câ€™est pourquoi React <a href=\"https://github.com/facebook/react/pull/5021\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">a dÃ©placÃ©</a> ce drapeau vers <code class=\"language-text\">React.Component.prototype</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// Dans React</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Component</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token class-name\">Component</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span>isReactComponent <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// On peut le vÃ©rifier comme ceci</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Greeting</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Component</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Greeting</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span>isReactComponent<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// âœ… Oui</span></code></pre></div>\n<p><strong>Et câ€™est littÃ©ralement tout ce quâ€™on a besoin de faire.</strong></p>\n<p>Vous vous demandez peut-Ãªtre pourquoi câ€™est un objet, et pas juste un boolÃ©en.  En pratique Ã§a nâ€™a pas beaucoup dâ€™importance, mais les premiÃ¨res versions de Jest (avant que Jest soit Bienâ„¢) avait lâ€™<em>automocking</em> activÃ© par dÃ©faut.  Les mocks gÃ©nÃ©rÃ©s laissaient de cÃ´tÃ© les propriÃ©tÃ©s primitives, <a href=\"https://github.com/facebook/react/pull/4663#issuecomment-136533373\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ce qui pÃ©tait notre vÃ©rification</a>. Merci Jest.</p>\n<p>La vÃ©rification de <code class=\"language-text\">isReactComponent</code> reste <a href=\"https://github.com/facebook/react/blob/769b1f270e1251d9dbdce0fcbd9e92e502d059b8/packages/react-reconciler/src/ReactFiber.js#L297-L300\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">utilisÃ©e par React</a> jusquâ€™Ã  ce jour.</p>\n<p>Si vous nâ€™Ã©tendez pas <code class=\"language-text\">React.Component</code>, React ne trouvera pas <code class=\"language-text\">isReactComponent</code> sur le prototype et ne traitera pas le composant comme une classe.  Maintenant vous savez pourquoi <a href=\"https://stackoverflow.com/a/42680526/458193\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">la rÃ©ponse la plus populaire</a> Ã  lâ€™erreur <code class=\"language-text\">Cannot call a class as a function</code> consiste Ã  ajouter <code class=\"language-text\">extends React.Component</code>. Pour finir, un <a href=\"https://github.com/facebook/react/pull/11168\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">avertissement a Ã©tÃ© ajoutÃ©</a> si <code class=\"language-text\">prototype.render</code> existe mais que <code class=\"language-text\">prototype.isReactComponent</code> est manquant.</p>\n<hr>\n<p>Vous trouvez peut-Ãªtre que le titre de cet article Ã©tait un leurre grossier. <strong>La solution rÃ©elle est super simple, mais je suis parti sur une tangente de fou pour vous expliquer <em>pourquoi</em> React a fini par opter pour cette solution, et quelles Ã©taient les alternatives.</strong></p>\n<p>Dâ€™aprÃ¨s ma propre expÃ©rience, câ€™est souvent le cas avec les APIs de bibliothÃ¨ques.  Pour quâ€™une API soit facile Ã  utiliser, on doit souvent considÃ©rer la sÃ©mantique du langage (voire, pour plusieurs langages, leurs Ã©volutions Ã  venir), la performance dâ€™exÃ©cution, lâ€™ergonomie avec ou sans Ã©tapes de transpilation, lâ€™Ã©tat de lâ€™Ã©cosystÃ¨me et des solutions de <em>packaging</em>, la capacitÃ© Ã  produire des avertissements le plus en amont possible, et bien dâ€™autres facteurs.  Le rÃ©sultat final nâ€™est pas toujours le plus Ã©lÃ©gant, mais doit Ãªtre le plus pratique.</p>\n<p><strong>Si lâ€™API finale a du succÃ¨s, <em>ses utilisateurs</em> nâ€™auront jamais Ã  penser Ã  ce processus.</strong>  Ils peuvent ainsi se concentrer plutÃ´t sur la crÃ©ation de leurs applications.</p>\n<p>Mais si vous Ãªtes par ailleurs curieuxÂ·seâ€¦ câ€™est sympa de savoir comment Ã§a marche sous le capot.</p>","timeToRead":18,"frontmatter":{"title":"Comment React distingue-t-il entre Classes et FonctionsÂ ?","date":"December 02, 2018","spoiler":"OÃ¹ nous parlons de classes, new, instanceof, des chaÃ®nes de prototypes et de la conception dâ€™API.","cta":null},"fields":{"slug":"/fr/how-does-react-tell-a-class-from-a-function/","langKey":"fr"}}},"pageContext":{"slug":"/fr/how-does-react-tell-a-class-from-a-function/","translations":["es","fr","hu","ja","nl","pt-br","sk","zh-hans","zh-hant"],"translatedLinks":["/why-do-we-write-super-props/"]}}}