{"componentChunkName":"component---src-templates-blog-post-js","path":"/fr/react-as-a-ui-runtime/","result":{"data":{"site":{"siteMetadata":{"title":"Overreacted","author":"Dan Abramov"}},"markdownRemark":{"id":"70fba248-9b87-59e5-8f7a-29c2bfc0a050","html":"<p>La plupart des tutos présentent React comme une bibliothèque UI.  C’est logique puisque React <em>est</em> une bibliothèque UI.  C’est littéralement dans son slogan !</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0429fcb4a2f2022852afc698ff8968f1/0b533/react.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 500px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 29.054054054054056%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABEElEQVQY011Qy07DMBD0v1CniRM7dt4Pp01VWgmQOKEeekKCA0hIFUcOSIgfH9amDaWH0c4+ZrxeFiY5zjGPswlBqMCvIvCZ8Ajm8t/MpcZxdmkYyoKECubmAcv3b1S7J8Iz6v0L8vs95pH2c9I0MKWFLnqorJ2MWSBoE2H+QEVOm8jxDv3rB+zbJ4bDF5rHA8ztDjxMEcnSmzitM4nTyhsnugaTpoai19K8hc47z11T0pAQGkrliGMDlZKJrrw4qyxh8BqHhOpClcQ7MFP2aPoV+sV6QjesMYwb1N2IjnLXt8trLFZbtNbxDey49bmrO41QhT8DO32V0218PPIpP4v8OOu2dBvN6Ps8+u2dbvoDB8/AqO9EOdcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Capture d’écran de la page d’accueil de React : « Une bibliothèque JavaScript pour construire des interfaces utilisateurs »\"\n        title=\"\"\n        src=\"/static/0429fcb4a2f2022852afc698ff8968f1/0b533/react.png\"\n        srcset=\"/static/0429fcb4a2f2022852afc698ff8968f1/12f09/react.png 148w,\n/static/0429fcb4a2f2022852afc698ff8968f1/e4a3f/react.png 295w,\n/static/0429fcb4a2f2022852afc698ff8968f1/0b533/react.png 500w\"\n        sizes=\"(max-width: 500px) 100vw, 500px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>J’ai déjà parlé des défis de la création d’<a href=\"/the-elements-of-ui-engineering/\">interfaces utilisateurs</a>.   Mais cet article parle de React sous un autre angle—plutôt en tant qu’<a href=\"https://en.wikipedia.org/wiki/Runtime_system\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">environnement d’exécution</a>. <em>(Dans la suite de cet article, pour des raisons de concision, nous emploierons le terme générique anglais <strong>runtime</strong>, NdT)</em></p>\n<p><strong>Cet article ne vous apprendera rien sur la création d’interfaces utilisateurs.</strong>  Mais il vous aidera peut-être à comprendre plus en profondeur le modèle de programmation de React.</p>\n<hr>\n<p><strong>Note : si vous <em>apprenez</em> React, jetez plutôt un œil aux <a href=\"https://reactjs.org/docs/getting-started.html#learn-react\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">docs</a>.</strong></p>\n<p><font size=\"60\">⚠️</font></p>\n<p><strong>On part pour une exploration en profondeur—cet article N’EST PAS destiné aux personnes qui débutent en React.</strong>  Dans cet article, je décris la majeure partie du modèle de programmation de React en partant de principes premiers.  Je n’explique pas comment on s’en sert—plutôt comment il fonctionne.</p>\n<p>Je vise ici un lectorat de développeur·se·s chevronné·e·s et de personnes qui bossent sur d’autres bibliothèques UI et se demandent quels compromis React a retenus.  J’espère que vous trouverez ce texte utile !</p>\n<p><strong>Beaucoup de monde utilise React avec succès pendant des années sans avoir à réfléchir à la plupart de ces questions.</strong>  On adopte ici clairement un regard sur React orienté développeurs, par opposition à, par exemple, une <a href=\"http://mrmrs.cc/writing/developing-ui/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">vision de designer</a>.  Mais je trouve qu’il n’est pas inutile de proposer des ressources pour ces deux mondes.</p>\n<p>Cet avertissement derrière nous, allons-y !</p>\n<hr>\n<h2 id=\"arbre-hôte\"><a href=\"#arbre-h%C3%B4te\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Arbre hôte</h2>\n<p>Certains programmes produisent des nombres.  D’autres produisent des poèmes.  Les différents langages et leurs runtimes sont souvent optimisés pour un ensemble particulier de tâches, et React ne fait pas exception.</p>\n<p>Les programmes utilisant React produisent en général <strong>un arbre qui peut changer avec le temps</strong>.  Ce peut être un <a href=\"https://www.npmjs.com/package/react-dom\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">arbre DOM</a>, ou une <a href=\"https://developer.apple.com/library/archive/documentation/General/Conceptual/Devpedia-CocoaApp/View%20Hierarchy.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">hiérarchie iOS</a>, un arbre de <a href=\"https://react-pdf.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">primitives PDF</a>, ou même <a href=\"https://reactjs.org/docs/test-renderer.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">des objets JSON</a>. Dans tous les cas, on cherche en général à représenter une forme d’UI grâce à lui.  Nous l’appellerons l’arbre <em>hôte</em> parce qu’il fait partie de <em>l’environnement hôte</em> hors de React—tel que le DOM ou iOS.  L’arbre hôte a généralement une <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Node/appendChild\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">API</a> impérative qui lui est <a href=\"https://developer.apple.com/documentation/uikit/uiview/1622616-addsubview\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">propre</a>.  React est une couche au-dessus de ça.</p>\n<p>Alors en quoi React est-il utile ?  En termes abstraits, il vous aide à écrire un programme qui manipule de façon prévisible un arbre hôte complexe en réponse à des événements extérieurs tels que des interactions, une réponse réseau, des timers, etc.</p>\n<p>Un outil spécialisé marche en général mieux qu’un outil générique parce qu’il peut imposer des contraintes particulières qui lui procurent un avantage.  React se base sur deux suppositions principales :</p>\n<ul>\n<li><strong>La stabilité.</strong>  L’arbre hôte est relativement stable et la plupart des mises à jour n’en changent pas radicalement la structure générale.  Si une appli redisposait tous ses éléments interactifs dans une configuration totalement différente à chaque seconde, elle serait bien difficile à utiliser.  Où est passé ce bouton ? Pourquoi mon écran danse-t-il ?</li>\n<li><strong>La régularité.</strong>  L’arbre hôte peut être décomposé en motifs d’UI qui gardent un aspect et un comportement cohérents (tels que des boutons, des listes, des avatars) plutôt que des formes aléatoires.</li>\n</ul>\n<p><strong>Ces suppositions s’avèrent justes dans la plupart des UIs.</strong>  Le côté face, c’est que React n’est pas l’outil adapté lorsqu’on manque de « motifs » stables dans la sortie produite.  Par exemple, React pourrait vous aider à écrire un client Twitter mais ne serait guère utile pour un <a href=\"https://www.youtube.com/watch?v=Uzx9ArZ7MUU\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">économiseur d’écran de tuyaux en 3D</a>.</p>\n<h2 id=\"instances-hôtes\"><a href=\"#instances-h%C3%B4tes\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Instances hôtes</h2>\n<p>L’arbre hôte est constitué de nœuds.  Nous les appellerons des « instances hôtes ».</p>\n<p>Dans un environnement DOM, les instances hôtes sont des nœuds DOM normaux—comme ces objets que vous obtenez en appelant <code class=\"language-text\">document.createElement(&#39;div&#39;)</code>.  Sur iOS, les instances hôtes pourraient être des valeurs JavaScript identifiant de façon unique des vues natives.</p>\n<p>Les instances hôtes ont leurs propriétés propres (ex. <code class=\"language-text\">domNode.className</code> ou <code class=\"language-text\">view.tintColor</code>).  Elles peuvent aussi avoir d’autres instances hôtes comme éléments enfants.</p>\n<p>(Ceci n’a rien à voir avec React—je décris ici les environnements hôtes.)</p>\n<p>Une API est généralement disponible pour manipuler les instances hôtes. Par exemple, le DOM fournit des APIs telles que <code class=\"language-text\">appendChild</code>, <code class=\"language-text\">removeChild</code>, <code class=\"language-text\">setAttribute</code> et ainsi de suite.  Dans des applis React, nous n’appelons généralement pas ces APIs. C’est le boulot de React.</p>\n<h2 id=\"renderers\"><a href=\"#renderers\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Renderers</h2>\n<p>Un <em>renderer (moteur de rendu, mais nous utiliserons sans italiques le terme anglais établi <strong>renderer</strong>, NdT)</em> apprend à React à parler à un environnement hôte spécifique et gère ses instances hôtes.  React DOM, React Native, et même <a href=\"https://mobile.twitter.com/vadimdemedes/status/1089344289102942211\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Ink</a> sont des renderers React. Vous pouvez aussi <a href=\"https://github.com/facebook/react/tree/master/packages/react-reconciler\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">créer votre propre renderer React</a>.</p>\n<p>Les renderers React peuvent fonctionner dans l’un de deux modes.</p>\n<p>La vaste majorité des renderers sont écrits sur le mode « mutatif ». C’est le mode de fonctionnement du DOM : on peut créer un nœud, définir ses propriétés, et plus tard lui ajouter ou retirer des enfants. Les instances hôtes sont complètement modifiables.</p>\n<p>React peut également fonctionner en mode « persistant ». Ce mode est là pour les environnements qui ne fournissent pas de méthodes du type <code class=\"language-text\">appendChild()</code>, mais au contraire clonent l’arbre parent et remplacent systématiquement l’enfant de plus haut niveau.  L’immutabilité au niveau de l’arbre hôte facilite le recours au multi-thread. <a href=\"https://facebook.github.io/react-native/blog/2018/06/14/state-of-react-native-2018\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">React Fabric</a> en tire parti.</p>\n<p>En tant qu’utilisateurs de React, nous n’avons jamais besoin de penser à ces nœuds.  Je veux juste insister sur le fait que React n’est pas juste un adaptateur entre deux modes.  Son utilité est indépendante du paradigme d’API des vues de bas niveau qu’il cible.</p>\n<h2 id=\"éléments-react\"><a href=\"#%C3%A9l%C3%A9ments-react\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Éléments React</h2>\n<p>Dans l’environnement hôte, une instance hôte (telle qu’un nœud DOM) constitue le plus petit bloc de construction.  Dans React, ce plus petit bloc est un <em>élément React</em>.</p>\n<p>Un élément React est un objet JavaScript nu.  Il <em>décrit</em> une instance hôte.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// JSX est un sucre syntaxique pour ces objets.</span>\n<span class=\"token comment\">// &lt;button className=\"blue\" /></span>\n<span class=\"token punctuation\">{</span>\n  type<span class=\"token operator\">:</span> <span class=\"token string\">'button'</span><span class=\"token punctuation\">,</span>\n  props<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> className<span class=\"token operator\">:</span> <span class=\"token string\">'blue'</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Un élément React est léger et n’est pas associé à une instance hôte. Encore une fois, il se contente de <em>décrire</em> ce que vous voulez voir à l’écran.</p>\n<p>Tout comme les instances hôtes, les éléments React peuvent former un arbre :</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// JSX est un sucre syntaxique pour ces objets.</span>\n<span class=\"token comment\">// &lt;dialog></span>\n<span class=\"token comment\">//   &lt;button className=\"blue\" /></span>\n<span class=\"token comment\">//   &lt;button className=\"red\" /></span>\n<span class=\"token comment\">// &lt;/dialog></span>\n<span class=\"token punctuation\">{</span>\n  type<span class=\"token operator\">:</span> <span class=\"token string\">'dialog'</span><span class=\"token punctuation\">,</span>\n  props<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    children<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n      type<span class=\"token operator\">:</span> <span class=\"token string\">'button'</span><span class=\"token punctuation\">,</span>\n      props<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> className<span class=\"token operator\">:</span> <span class=\"token string\">'blue'</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      type<span class=\"token operator\">:</span> <span class=\"token string\">'button'</span><span class=\"token punctuation\">,</span>\n      props<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> className<span class=\"token operator\">:</span> <span class=\"token string\">'red'</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><em>(Remarque : j’ai laissé de côté <a href=\"/why-do-react-elements-have-typeof-property/\">certaines propriétés</a> qui n’ont pas d’intérêt pour cette explication.)</em></p>\n<p>Rappelez-vous cependant que <strong>les éléments React n’ont pas leur propre identité persistante.</strong>  Ils sont censés être re-créés et jetés à tout bout de champ.</p>\n<p>Les éléments React sont immuables.  Par exemple, vous ne pouvez pas changer les enfants ni une propriété d’un élément React.  Si vous voulez afficher quelque chose de différent par la suite, vous devrez le <em>décrire</em> à l’aide d’un nouvel arbre d’éléments React créé à partir de zéro.</p>\n<p>J’aime considérer les éléments React comme les images distinctes d’un film.  Ils représentent ce à quoi l’UI devrait ressembler à un point précis dans le temps.  Ils ne changent pas.</p>\n<h2 id=\"point-dentrée\"><a href=\"#point-dentr%C3%A9e\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Point d’entrée</h2>\n<p>Chaque renderer React a un « point d’entrée ».  C’est l’API qui nous permet de dire à React d’afficher un arbre d’éléments React donné au sein d’une instance hôte conteneur.</p>\n<p>Par exemple, le point d’entrée de React DOM est <code class=\"language-text\">ReactDOM.render</code> :</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">ReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>\n  <span class=\"token comment\">// { type: 'button', props: { className: 'blue' } }</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>blue<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">,</span>\n  document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'container'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Quand nous écrivons <code class=\"language-text\">ReactDOM.render(reactElement, domContainer)</code>, nous disons en fait : <strong>« Cher React, fais que l’arbre hôte dans <code class=\"language-text\">domContainer</code> reflète celui de mon <code class=\"language-text\">reactElement</code>. »</strong></p>\n<p>React va regarder <code class=\"language-text\">reactElement.type</code> (dans notre exemple, <code class=\"language-text\">&#39;button&#39;</code>) et demander au renderer de React DOM de créer une instance hôte adaptée et d’en définir les propriétés :</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// Quelque part dans le renderer ReactDOM (simplifié)</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">createHostInstance</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">reactElement</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">let</span> domNode <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span>reactElement<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">  domNode<span class=\"token punctuation\">.</span>className <span class=\"token operator\">=</span> reactElement<span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>className<span class=\"token punctuation\">;</span></span>  <span class=\"token keyword\">return</span> domNode<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Dans cet exemple, en pratique React fera ceci :</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">let</span> domNode <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'button'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">domNode<span class=\"token punctuation\">.</span>className <span class=\"token operator\">=</span> <span class=\"token string\">'blue'</span><span class=\"token punctuation\">;</span></span>\ndomContainer<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>domNode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Si l’élément React a des éléments enfants dans <code class=\"language-text\">reactElement.props.children</code>, React va récursivement créer des instances hôtes pour eux aussi lors du premier rendu.</p>\n<h2 id=\"réconciliation\"><a href=\"#r%C3%A9conciliation\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Réconciliation</h2>\n<p>Que se passe-t-il si nous appelons <code class=\"language-text\">ReactDOM.render()</code> deux fois avec le même conteneur ?</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">ReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>blue<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">,</span></span>  document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'container'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// ... plus tard ...</span>\n\n<span class=\"token comment\">// Ce code doit-il *remplacer* l’instance hôte du</span>\n<span class=\"token comment\">// bouton, ou simplement mettre à jour une propriété</span>\n<span class=\"token comment\">// sur l’instance existante ?</span>\n<span class=\"gatsby-highlight-code-line\">ReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span></span>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>red<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">,</span>\n  document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'container'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Encore une fois, le boulot de React consiste à <em>faire que l’arbre hôte corresponde à l’arbre d’éléments React fourni</em>. Le processus qui détermine <em>quoi</em> faire dans l’arbre d’instances hôtes en réponse à de nouvelles informations est parfois appelé <a href=\"https://reactjs.org/docs/reconciliation.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">réconciliation</a>.</p>\n<p>Il y a deux façons de s’y prendre.  Une version simplifiée de React pourrait juste dégager l‘arbre existant et le recréer à partir de zéro :</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">let</span> domContainer <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'container'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Effacer l’arbre</span>\ndomContainer<span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">=</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Créer le nouvel arbre d’instances hôtes</span>\n<span class=\"token keyword\">let</span> domNode <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'button'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ndomNode<span class=\"token punctuation\">.</span>className <span class=\"token operator\">=</span> <span class=\"token string\">'red'</span><span class=\"token punctuation\">;</span>\ndomContainer<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>domNode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Mais dans le DOM, cette approche est lente et perd des informations importantes telles que le focus, la sélection, l’état du défilement, et ainsi de suite.  Au lieu de ça, nous voulons que React fasse quelque chose comme ceci :</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">let</span> domNode <span class=\"token operator\">=</span> domContainer<span class=\"token punctuation\">.</span>firstChild<span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Mettre à jour l’instance hôte existante</span>\ndomNode<span class=\"token punctuation\">.</span>className <span class=\"token operator\">=</span> <span class=\"token string\">'red'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>En d’autres termes, React a besoin de décider quand <em>mettre à jour</em> une instance hôte existante pour correspondre à un nouvel élément React, et quand en créer une <em>nouvelle</em>.</p>\n<p>Ce qui pose la question de <em>l’identité</em>.  L’élément React peut être différent à chaque fois, mais quand se rapporte-t-il à la même instance hôte, conceptuellement ?</p>\n<p>Dans notre exemple, la réponse est simple.  Nous affichions un <code class=\"language-text\">&lt;button&gt;</code> comme premier (et seul) enfant, et nous voulons afficher un <code class=\"language-text\">&lt;button&gt;</code> à nouveau, à la même position.  Nous avons déjà une instance hôte <code class=\"language-text\">&lt;button&gt;</code> alors pourquoi en re-créer une ?  Contentons-nous de la réutiliser.</p>\n<p>Voilà qui est assez proche de la façon dont React aborde ce problème.</p>\n<p><strong>Si un type d’élément à la même position dans l’arbre « correspond » entre les rendus précédent et suivant, React réutilise l’instance hôte existante.</strong></p>\n<p>Voici un exemple commenté qui montre <em>grosso modo</em> ce que fait React :</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// let domNode = document.createElement('button');</span>\n<span class=\"token comment\">// domNode.className = 'blue';</span>\n<span class=\"token comment\">// domContainer.appendChild(domNode);</span>\nReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>blue<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">,</span>\n  document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'container'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"gatsby-highlight-code-line\"><span class=\"token comment\">// Instance hôte réutilisable ? Oui ! (button → button)</span></span><span class=\"gatsby-highlight-code-line\"><span class=\"token comment\">// domNode.className = 'red';</span></span>ReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>red<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">,</span>\n  document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'container'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"gatsby-highlight-code-line\"><span class=\"token comment\">// Instance hôte réutilisable ? Non ! (button → p)</span></span><span class=\"token comment\">// domContainer.removeChild(domNode);</span>\n<span class=\"token comment\">// domNode = document.createElement('p');</span>\n<span class=\"token comment\">// domNode.textContent = 'Hello';</span>\n<span class=\"token comment\">// domContainer.appendChild(domNode);</span>\nReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Hello</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">,</span>\n  document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'container'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"gatsby-highlight-code-line\"><span class=\"token comment\">// Instance hôte réutilisable ? Oui ! (p → p)</span></span><span class=\"gatsby-highlight-code-line\"><span class=\"token comment\">// domNode.textContent = 'Goodbye';</span></span>ReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Goodbye</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">,</span>\n  document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'container'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>La même heuristique est utilisée pour les arbres enfants.  Par exemple, quand nous mettons à jour un <code class=\"language-text\">&lt;dialog&gt;</code> avec deux <code class=\"language-text\">&lt;button&gt;s</code> à l’intérieur, React décide d’abord s’il peut réutiliser le <code class=\"language-text\">&lt;dialog&gt;</code>, puis répète cette procédure de décision pour chaque enfant.</p>\n<h2 id=\"conditions\"><a href=\"#conditions\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conditions</h2>\n<p>Si React réutilise les instances hôtes seulement quand les types d’éléments « correspondent » d’une mise à jour à l’autre, comment produire du contenu conditionnel ?</p>\n<p>Imaginons que nous voulions commencer par afficher seulement un champ, pour ensuite produire un message avant lui :</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// Premier rendu</span>\nReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dialog</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dialog</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">,</span>\n  domContainer\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Rendu suivant</span>\nReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dialog</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token plain-text\">    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Je viens d’être ajouté ici !</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span></span><span class=\"token plain-text\">    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dialog</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">,</span>\n  domContainer\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Dans cet exemple, l’instance hôte <code class=\"language-text\">&lt;input&gt;</code> serait re-créée.  React parcourerait l’arbre des éléments, le comparant à la version précédente :</p>\n<ul>\n<li>\n<p><code class=\"language-text\">dialog → dialog</code> : Instance hôte réutilisable ? <strong>Oui—le type correspond.</strong></p>\n<ul>\n<li><code class=\"language-text\">input → p</code> : Instance hôte réutilisable ? <strong>Non, le type a changé !</strong> Il faut retirer le <code class=\"language-text\">input</code> existant et crée une nouvelle instance hôte <code class=\"language-text\">p</code>.</li>\n<li><code class=\"language-text\">(rien) → input</code> : Il faut créer une nouvelle instance hôte <code class=\"language-text\">input</code>.</li>\n</ul>\n</li>\n</ul>\n<p>Ainsi, le code de mise à jour exécuté par React ressemblerait à ceci :</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">let</span> oldInputNode <span class=\"token operator\">=</span> dialogNode<span class=\"token punctuation\">.</span>firstChild<span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">dialogNode<span class=\"token punctuation\">.</span><span class=\"token function\">removeChild</span><span class=\"token punctuation\">(</span>oldInputNode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n<span class=\"token keyword\">let</span> pNode <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'p'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\npNode<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> <span class=\"token string\">'Je viens d’être ajouté ici !'</span><span class=\"token punctuation\">;</span>\ndialogNode<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>pNode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">let</span> newInputNode <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'input'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">dialogNode<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>newInputNode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span></code></pre></div>\n<p>Ce n’est pas idéal parce que <em>conceptuellement</em> le <code class=\"language-text\">&lt;input&gt;</code> n’a pas été <em>remplacé</em> par le <code class=\"language-text\">&lt;p&gt;</code>—il a juste bougé.  On ne veut pas perdre sa sélection, son état de focus, et son contenu en re-créant son DOM.</p>\n<p>Même si ce problème a une solution simple (que nous allons voir dans un instant), il ne survient que rarement dans les applications React.  Il est intéressant de voir pourquoi.</p>\n<p>En pratique, vous appeleriez rarement <code class=\"language-text\">ReactDOM.render</code>.  Les applis React ont plutôt tendance à être décomposées en fonctions du genre de celle-ci :</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Form</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> showMessage <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> message <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>showMessage<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    message <span class=\"token operator\">=</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Je viens d’être ajouté ici !</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dialog</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token punctuation\">{</span>message<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dialog</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Cet exemple ne souffre pas du problème que nous venons de décrire.  Il est peut-être plus facile de comprendre pourquoi en examinant la notation objet plutôt que son JSX.  Regardez donc l’arbre des éléments enfants de <code class=\"language-text\">dialog</code> :</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Form</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> showMessage <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> message <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>showMessage<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    message <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      type<span class=\"token operator\">:</span> <span class=\"token string\">'p'</span><span class=\"token punctuation\">,</span>\n      props<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> children<span class=\"token operator\">:</span> <span class=\"token string\">'Je viens d’être ajouté ici !'</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    type<span class=\"token operator\">:</span> <span class=\"token string\">'dialog'</span><span class=\"token punctuation\">,</span>\n    props<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">      children<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></span><span class=\"gatsby-highlight-code-line\">        message<span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token punctuation\">{</span> type<span class=\"token operator\">:</span> <span class=\"token string\">'input'</span><span class=\"token punctuation\">,</span> props<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token punctuation\">]</span></span>    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>Peu importe que <code class=\"language-text\">showMessage</code> soit <code class=\"language-text\">true</code> ou <code class=\"language-text\">false</code>, le <code class=\"language-text\">&lt;input&gt;</code> est le second enfant et sa position dans l’arbre ne change pas d’un rendu à l’autre.</strong></p>\n<p>Si <code class=\"language-text\">showMessage</code> passait de <code class=\"language-text\">false</code> à <code class=\"language-text\">true</code>, React parcourerait l’arbre d’éléments, en le comparant à la version précédente :</p>\n<ul>\n<li>\n<p><code class=\"language-text\">dialog → dialog</code> : Instance hôte réutilisable ? <strong>Oui—le type correspond.</strong></p>\n<ul>\n<li><code class=\"language-text\">(null) → p</code> : Il faut créer une nouvelle instance hôte <code class=\"language-text\">p</code>.</li>\n<li><code class=\"language-text\">input → input</code> : Instance hôte réutilisable ? <strong>Oui—le type correspond.</strong></li>\n</ul>\n</li>\n</ul>\n<p>Et le code exécuté par React ressemblerait à ceci :</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">let</span> inputNode <span class=\"token operator\">=</span> dialogNode<span class=\"token punctuation\">.</span>firstChild<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> pNode <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'p'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\npNode<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> <span class=\"token string\">'Je viens d’être ajouté ici !'</span><span class=\"token punctuation\">;</span>\ndialogNode<span class=\"token punctuation\">.</span><span class=\"token function\">insertBefore</span><span class=\"token punctuation\">(</span>pNode<span class=\"token punctuation\">,</span> inputNode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Pas de perte de l‘état du champ désormais.</p>\n<h2 id=\"listes\"><a href=\"#listes\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Listes</h2>\n<p>Il suffit généralement de comparer les types d’éléments pour une position donnée dans l’arbre afin de décider si on réutilise ou re-crée l’instance hôte correspondante.</p>\n<p>Mais ça ne marche bien que si les positions des enfants sont stables, sans réordonnancement.  Dans notre exemple précédent, même si on pourrait qualifier <code class=\"language-text\">message</code> de « trou », nous savions quand même que le champ apparaît après le message, et qu’il n’y avait pas d’autre enfant.</p>\n<p>Avec des listes dynamiques, on ne peut jamais être sûrs que l’ordre est stable :</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">ShoppingList</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> list <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token punctuation\">{</span>list<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n          Vous avez acheté </span><span class=\"token punctuation\">{</span>item<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n          Combien en voulez-vous : </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Si jamais la <code class=\"language-text\">list</code> de notre panier de courses est réordonnée, React verra que tous les éléments <code class=\"language-text\">p</code> et <code class=\"language-text\">input</code> à l’intérieur ont le même type, et ne saura pas qu’il doit les déplacer. (Du point de vue de React, les <em>éléments eux-mêmes</em> ont changé, et non leur ordre.)</p>\n<p>Le code exécuté par React pour réordonner 10 éléments ressemblerait à ceci :</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> pNode <span class=\"token operator\">=</span> formNode<span class=\"token punctuation\">.</span>childNodes<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> textNode <span class=\"token operator\">=</span> pNode<span class=\"token punctuation\">.</span>firstChild<span class=\"token punctuation\">;</span>\n  textNode<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> <span class=\"token string\">'Vous avez acheté '</span> <span class=\"token operator\">+</span> items<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Ainsi, au lieu de les <em>réordonner</em>, React opterait plutôt pour <em>mettre à jour</em> chacun d’eux.  Ça peut engendrer des problèmes de performance, voire des bugs.  Par exemple, le contenu du premier champ resterait reflété dans le premier champ <em>après</em> le tri—même si conceptuellement ils pouvaient utiliser des produits distincts dans le panier !</p>\n<p><strong>C’est pourquoi React vous asticote pour que vous fournissiez une propriété spéciale appelée <code class=\"language-text\">key</code> chaque fois que vous utilisez un tableau d’éléments dans votre rendu :</strong></p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">ShoppingList</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> list <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">      </span><span class=\"token punctuation\">{</span>list<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n<span class=\"gatsby-highlight-code-line\">        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span> <span class=\"token attr-name\">key</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>item<span class=\"token punctuation\">.</span>productId<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span></span><span class=\"token plain-text\">          Vous avez acheté </span><span class=\"token punctuation\">{</span>item<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">}</span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">          Combien en voulez-vous : </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Une <code class=\"language-text\">key</code> indique à React qu’il devrait considérer un élément comme étant <em>conceptuellement</em> le même, quand bien même sa <em>position</em> au sein de son élément parent évolue d’un rendu à l’autre.</p>\n<p>Quand React verra <code class=\"language-text\">&lt;p key=&quot;42&quot;&gt;</code> au sein d’un <code class=\"language-text\">&lt;form&gt;</code>, il vérifiera que le rendu précédent contenait également un <code class=\"language-text\">&lt;p key=&quot;42&quot;&gt;</code> au sein du même <code class=\"language-text\">&lt;form&gt;</code>.  Ça marche même si les enfants du <code class=\"language-text\">&lt;form&gt;</code> ont changé d’ordre.  React réutilisera l’instance hôte précédente avec la même clé si elle existe, et réordonnera les autres éléments de même niveau en fonction de ça.</p>\n<p>Remarquez bien que <code class=\"language-text\">key</code> n’a d’importance qu’au sein d’un élément parent React précis, tel que <code class=\"language-text\">&lt;form&gt;</code>.  React n’essaiera pas de faire correspondre des éléments de clé identique situés dans des parents différents. (React n’a pas de méthode idiomatique pour déplacer une instance hôte d’un parent à l’autre sans la re-créer).</p>\n<p>Comment choisir une bonne valeur pour <code class=\"language-text\">key</code> ?  Une manière simple de répondre à cette question consiste à se demander : <strong>quand est-ce que <em>vous</em> diriez qu’un élément est le « même », indépendamment de l’ordre ?</strong>  Par exemple, dans notre panier d’achats, l’ID du produit identifie chaque élément de façon unique parmi ceux de même niveau.</p>\n<h2 id=\"composants\"><a href=\"#composants\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Composants</h2>\n<p>Nous avons déjà vu des fonctions qui renvoient des éléments React :</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Form</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> showMessage <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> message <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>showMessage<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    message <span class=\"token operator\">=</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Je viens d’être ajouté ici !</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dialog</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token punctuation\">{</span>message<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dialog</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Nous appelons ces fonctions des <em>composants</em>.  Elles nous permettent de créer notre propre « boîte à outils » de boutons, avatars, commentaires, etc.  Les composants sont la raison d’être de React.</p>\n<p>Les composants prennent un argument—un objet. Il contient des « props » (le raccourci de « propriétés »).  Ici, <code class=\"language-text\">showMessage</code> est une prop.  Elles jouent un rôle similaire à des arguments nommés.</p>\n<h2 id=\"pureté\"><a href=\"#puret%C3%A9\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Pureté</h2>\n<p>Les composants React sont supposés purs vis-à-vis de leurs props.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Button</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 🔴 Ça ne marche pas</span>\n  props<span class=\"token punctuation\">.</span>isActive <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>De façon générale, le code mutatif n’est pas du React idiomatique. (Nous explorerons plus tard la manière idiomatique de mettre à jour l’UI en réponse à des événements.)</p>\n<p>En revanche, les <em>mutations locales</em> ne posent aucun souci :</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">FriendList</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> friends <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">let</span> items <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></span>  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> friends<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> friend <span class=\"token operator\">=</span> friends<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">    items<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span></span>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Friend</span></span> <span class=\"token attr-name\">key</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>friend<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">friend</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>friend<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>section</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span>items<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>section</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Nous avons créé <code class=\"language-text\">items</code> <em>pendant le rendu</em> et aucun autre composant ne l’a « vu », de sorte que nous pouvons le modifier autant qu’on le souhaite avant de l’intégrer au résultat du rendu.  Pas besoin de faire des contorsions de code pour éviter ce genre de mutations locales.</p>\n<p>Dans le même esprit, l’initialisation tardive est acceptable même si elle n’est pas totalement « pure » :</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">ExpenseForm</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Acceptable si ça n’affecte pas d’autres composants :</span>\n  SuperCalculator<span class=\"token punctuation\">.</span><span class=\"token function\">initializeIfNotReady</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Suite du rendu...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Tant qu’il reste possible d’appeler le composant plusieurs fois de façon fiable, et que ça n’affecte pas le rendu d’autres composants, React ne se soucie pas de savoir si votre composant est 100% pur au sens strict de la programmation fonctionnelle. L’<a href=\"https://stackoverflow.com/questions/1077412/what-is-an-idempotent-operation\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">idempotence</a> est plus importante pour React que la pureté.</p>\n<p>Ceci étant dit, les effets de bord qui sont directement visibles pour l’utilisateur ne sont pas autorisés dans les composants React.  En d’autres termes, simplement <em>appeler</em> une fonction composant ne devrait pas en soi produire de changement à l’écran.</p>\n<h2 id=\"récursivité\"><a href=\"#r%C3%A9cursivit%C3%A9\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Récursivité</h2>\n<p>Comment <em>utiliser</em> des composants au sein d’autres composants ?  Les composants sont des fonctions, donc on <em>pourrait</em> juste les appeler :</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">let</span> reactElement <span class=\"token operator\">=</span> <span class=\"token function\">Form</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> showMessage<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>reactElement<span class=\"token punctuation\">,</span> domContainer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Cependant, ce n’est <em>pas</em> la façon idiomatique d’utiliser des composants dans la runtime React.</p>\n<p>Non, la manière idiomatique d’utiliser un composant consiste à utiliser le même mécanisme que nous avons déjà vu : les éléments React. <strong>Ça signifie que vous n’appelez pas directement une fonction composant, mais laissez React le faire plus tard pour vous</strong> :</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// { type: Form, props: { showMessage: true } }</span>\n<span class=\"token keyword\">let</span> reactElement <span class=\"token operator\">=</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Form</span></span> <span class=\"token attr-name\">showMessage</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">;</span>\nReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>reactElement<span class=\"token punctuation\">,</span> domContainer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Et quelque part dans React, votre composant sera appelé :</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// Quelque part dans React</span>\n<span class=\"token keyword\">let</span> type <span class=\"token operator\">=</span> reactElement<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">;</span> <span class=\"token comment\">// Form</span>\n<span class=\"token keyword\">let</span> props <span class=\"token operator\">=</span> reactElement<span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">;</span> <span class=\"token comment\">// { showMessage: true }</span>\n<span class=\"token keyword\">let</span> result <span class=\"token operator\">=</span> <span class=\"token function\">type</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Ce que Form renvoie</span></code></pre></div>\n<p>Les noms des fonctions composants ont par convention des initiales majuscules.  Lorsque la transformation du JSX voit <code class=\"language-text\">&lt;Form&gt;</code> au lieu de <code class=\"language-text\">&lt;form&gt;</code>, elle transforme le <code class=\"language-text\">type</code> de l’objet en identifiant plutôt qu’en chaîne :</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Chaîne 'form'</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Form</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Fonction Form</span></code></pre></div>\n<p>Il n’y a pas de mécanisme global d’enregistrement—on réfère littéralement à <code class=\"language-text\">Form</code> par son nom lorsqu’on tape <code class=\"language-text\">&lt;Form /&gt;</code>. Si <code class=\"language-text\">Form</code> n’existe pas dans la portée courante, vous verrez une erreur JavaScript comme lorsque vous utilisez un nom de variable incorrect.</p>\n<p><strong>OK, alors que fait React quand le type d’un élément est une fonction ?  Il appelle votre composant, et demande quel élément <em>celui-ci</em> veut afficher.</strong></p>\n<p>Ce processus continue récursivement, comme le décrit en détail <a href=\"https://reactjs.org/blog/2015/12/18/react-components-elements-and-instances.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">cet article</a>.  En résumé, ça ressemble à ça :</p>\n<ul>\n<li><strong>Vous :</strong> <code class=\"language-text\">ReactDOM.render(&lt;App /&gt;, domContainer)</code></li>\n<li>\n<p><strong>React :</strong> Hé <code class=\"language-text\">App</code>, tu affiches quoi ?</p>\n<ul>\n<li><code class=\"language-text\">App</code>: J’affiche un <code class=\"language-text\">&lt;Layout&gt;</code> avec un <code class=\"language-text\">&lt;Content&gt;</code> dedans.</li>\n</ul>\n</li>\n<li>\n<p><strong>React :</strong> Hé <code class=\"language-text\">Layout</code>, tu affiches quoi ?</p>\n<ul>\n<li><code class=\"language-text\">Layout</code>: J’affiche mes enfants dans un <code class=\"language-text\">&lt;div&gt;</code>. Là j’ai comme enfant un <code class=\"language-text\">&lt;Content&gt;</code> du coup j’imagine qu’il va dans le <code class=\"language-text\">&lt;div&gt;</code>.</li>\n</ul>\n</li>\n<li>\n<p><strong>React :</strong> Hé <code class=\"language-text\">&lt;Content&gt;</code>, tu affiches quoi ?</p>\n<ul>\n<li><code class=\"language-text\">Content</code>: J’affiche un <code class=\"language-text\">&lt;article&gt;</code> avec du texte et un <code class=\"language-text\">&lt;Footer&gt;</code> à l’intérieur.</li>\n</ul>\n</li>\n<li>\n<p><strong>React :</strong> Hé <code class=\"language-text\">&lt;Footer&gt;</code>, tu affiches quoi ?</p>\n<ul>\n<li><code class=\"language-text\">Footer</code>: J’affiche un <code class=\"language-text\">&lt;footer&gt;</code> avec encore du texte.</li>\n</ul>\n</li>\n<li><strong>React :</strong> OK, alors voilà :</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// Structure DOM résultante</span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>article</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    Du texte\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>footer</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">encore du texte</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>footer</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>article</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Voilà pourquoi nous disons que la réconciliation est récursive.  Quand React parcourt l’arbre d’éléments, il peut rencontrer un élément dont le <code class=\"language-text\">type</code> est un composant.  Il va alors l’appeler et continuer à descendre dans l’arbre des éléments React renvoyés.  Lorsqu’il ne restera plus de composants à appeler, React saura quoi changer dans l’arbre hôte.</p>\n<p>Les mêmes règles de réconciliation que nous avons vues plus haut s’appliquent ici aussi. Si le <code class=\"language-text\">type</code> à une position donnée (déterminée par l’index et la <code class=\"language-text\">key</code> optionnelle) évolue, React jettera les instances hôtes à l’intérieur et les re-créera.</p>\n<h2 id=\"inversion-de-contrôle\"><a href=\"#inversion-de-contr%C3%B4le\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Inversion de contrôle</h2>\n<p>Vous vous demandez peut-être pourquoi nous n’appelons pas simplement les composants en direct ?  Pourquoi écrire <code class=\"language-text\">&lt;Form /&gt;</code> plutôt que <code class=\"language-text\">Form()</code> ?</p>\n<p><strong>React est mieux à même de faire son boulot s’il « voit » vos composants plutôt que juste l’arbre des éléments React obtenu après les avoir appelés récursivement.</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// 🔴 React ignore l’existence-même de Layout et Article.</span>\n<span class=\"token comment\">// C’est vous qui les appelez.</span>\nReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>\n  <span class=\"token function\">Layout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> children<span class=\"token operator\">:</span> <span class=\"token function\">Article</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  domContainer\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// ✅ React sait que Layout et Article existent.</span>\n<span class=\"token comment\">// React les appelle.</span>\nReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Layout</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Article</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Layout</span></span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">,</span>\n  domContainer\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>C’est un exemple classique d’<a href=\"https://fr.wikipedia.org/wiki/Inversion_de_contr%C3%B4le\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">inversion de contrôle</a>.  En laissant React prendre le contrôle des appels de nos composants, on obtient quelques possibilités intéressantes :</p>\n<ul>\n<li><strong>Les composants deviennent plus que de simples fonctions.</strong>  React peut ajouter des fonctionnalités aux fonctions composants telles qu’un <em>état local</em> associé à l’identité du composant dans l’arbre.  Une bonne runtime fournit des abstractions fondamentales qui correspondent au problème traité.  Comme nous l’avons déjà mentionné, React est spécifiquement conçu pour des programmes qui affichent des arbres d’UI et répondent aux interactions.  Si vous appelez les composants directement, vous devez construire ces fonctionnalités vous-mêmes.</li>\n<li><strong>Les types de composants participent à la réconciliation.</strong>  En laissant React appeler vos composants, vous lui en dites davantage sur la structure conceptuelle de votre arbre.  Par exemple, quand vous passez du rendu d’une page  <code class=\"language-text\">&lt;Feed&gt;</code> à celui d’une page <code class=\"language-text\">&lt;Profile&gt;</code>, React n’essaiera pas de ré-utiliser des instances hôtes à l’intérieur—tout comme lorsque vous remplacez un <code class=\"language-text\">&lt;button&gt;</code> par un <code class=\"language-text\">&lt;p&gt;</code>.  Tout l’état disparaît—ce qui est généralement une bonne chose lorsqu’on passe au rendu d’une vue conceptuellement distincte.  Vous n’avez sans doute pas envie de préserver les valeurs des champs lorsque vous passez d’un <code class=\"language-text\">&lt;PasswordForm&gt;</code> à un <code class=\"language-text\">&lt;MessengerChat&gt;</code>, même si des positions de <code class=\"language-text\">&lt;input&gt;</code> dans l’arbre correspondent par pur hasard.</li>\n<li><strong>React peut différer la réconciliation.</strong>  Si React a la main sur l’appel de vos composants, il peut faire pas mal de choses intéressantes.  Par exemple, il peut laisser le navigateur avancer sur ses autres tâches entre des appels de composants, afin que le rendu d’un gros arbre de composants <a href=\"https://reactjs.org/blog/2018/03/01/sneak-peek-beyond-react-16.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ne bloque pas le thread principal</a>.  Il est délicat d’orchestrer ce genre de choses manuellement sans ré-implémenter une large portion de React.</li>\n<li><strong>Le débogage est facilité.</strong>  Si les composants sont des citoyens de premier ordre dont la bibliothèque a connaissance, on peut construire <a href=\"https://github.com/facebook/react-devtools\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">des outils développeurs avancés</a> pour l’introspection lors du développement.</li>\n</ul>\n<p>Le dernier avantage que présente l’appel de nos fonctions composants par React, c’est <em>l’évaluation paresseuse</em>.  Voyons ce que j’entends par là.</p>\n<h2 id=\"évaluation-paresseuse\"><a href=\"#%C3%A9valuation-paresseuse\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Évaluation paresseuse</h2>\n<p>Quand on appelle des fonctions en JavaScript, leurs arguments sont évalués avant l’appel :</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// (2) Ceci est calculé en second</span>\n<span class=\"token function\">eat</span><span class=\"token punctuation\">(</span>\n  <span class=\"token comment\">// (1) Ceci est calculé en premier</span>\n  <span class=\"token function\">prepareMeal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>C’est généralement ce à quoi les développeurs JavaScript s’attendent, parce que les fonctions JavaScript peuvent avoir des effets de bord implicites.  Ce serait surprenant d’appeler une fonction qui ne s’exécuterait en fait qu’une fois que JavaScript « utilise » son résultat d’une façon ou d’une autre.</p>\n<p>Cependant, les composants React sont <a href=\"#puret%C3%A9\">relativement</a> purs. Il n’y a absolument aucune raison de les exécuter si nous savons que leur résultat n’apparaîtra pas à l’écran.</p>\n<p>Prenons le composant suivant qui met un <code class=\"language-text\">&lt;Comments&gt;</code> dans une <code class=\"language-text\">&lt;Page&gt;</code> :</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Story</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> currentUser <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// return {</span>\n  <span class=\"token comment\">//   type: Page,</span>\n  <span class=\"token comment\">//   props: {</span>\n  <span class=\"token comment\">//     user: currentUser,</span>\n  <span class=\"token comment\">//     children: { type: Comments, props: {} }</span>\n  <span class=\"token comment\">//   }</span>\n  <span class=\"token comment\">// }</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Page</span></span> <span class=\"token attr-name\">user</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>currentUser<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Comments</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\"></span></span><span class=\"token plain-text\">    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Page</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Le composant <code class=\"language-text\">Page</code> pourrait afficher ses enfants à l’intérieur d’un <code class=\"language-text\">Layout</code> :</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Page</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> user<span class=\"token punctuation\">,</span> children <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Layout</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token plain-text\">      </span><span class=\"token punctuation\">{</span>children<span class=\"token punctuation\">}</span><span class=\"token plain-text\"></span></span><span class=\"token plain-text\">    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Layout</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><em>(<code class=\"language-text\">&lt;A&gt;&lt;B /&gt;&lt;/A&gt;</code> en JSX est la même chose que <code class=\"language-text\">&lt;A children={&lt;B /&gt;} /&gt;</code>.)</em></p>\n<p>Mais que se passerait-il si on avait une condition de court-circuit ?</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Page</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> user<span class=\"token punctuation\">,</span> children <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>user<span class=\"token punctuation\">.</span>isLoggedIn<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Veuillez vous identifier</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span></span>  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Layout</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">      </span><span class=\"token punctuation\">{</span>children<span class=\"token punctuation\">}</span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Layout</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Si nous appelions <code class=\"language-text\">Comments()</code> en tant que fonction, il s’exécuterait immédiatement, que <code class=\"language-text\">Page</code> veuille ou non l’utiliser dans le rendu :</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// {</span>\n<span class=\"token comment\">//   type: Page,</span>\n<span class=\"token comment\">//   props: {</span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token comment\">//     children: Comments() // Toujours exécuté !</span></span><span class=\"token comment\">//   }</span>\n<span class=\"token comment\">// }</span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Page</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token plain-text\">  </span><span class=\"token punctuation\">{</span><span class=\"token function\">Comments</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\"></span></span><span class=\"token plain-text\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Page</span></span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Mais si nous passons un élément React, nous n’éxécutons pas du tout <code class=\"language-text\">Comments</code> nous-mêmes :</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// {</span>\n<span class=\"token comment\">//   type: Page,</span>\n<span class=\"token comment\">//   props: {</span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token comment\">//     children: { type: Comments }</span></span><span class=\"token comment\">//   }</span>\n<span class=\"token comment\">// }</span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Page</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token plain-text\">  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Comments</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\"></span></span><span class=\"token plain-text\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Page</span></span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Ça permet à React de décider quand et <em>si</em> il va l’appeler.  Si notre composant <code class=\"language-text\">Page</code> ignore sa prop <code class=\"language-text\">children</code> et affiche <code class=\"language-text\">&lt;h1&gt;Veuillez vous identifier&lt;/h1&gt;</code> à la place, React n’essaiera même pas d’appeler la fonction <code class=\"language-text\">Comments</code>.  Ça servirait à quoi ?</p>\n<p>C’est une bonne chose, parce que ça nous permet non seulement d’éviter un travail de rendu superflu qui serait ensuite jeté, mais ça rend aussi notre code plus robuste.  (On se fiche de savoir si <code class=\"language-text\">Comments</code> lèverait ou non une exception lorsque l’utilisateur n’est pas identifié—elle ne sera pas appelée.)</p>\n<h2 id=\"état\"><a href=\"#%C3%A9tat\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>État</h2>\n<p>Nous avons parlé <a href=\"#r%C3%A9conciliation\">plus haut</a> de l’identité, et de la façon dont la « position » conceptuelle d’un élément dans l’arbre indique à React s’il doit réutiliser une instance hôte ou en créer une nouvelle. Les instances hôtes peuvent avoir des tas d’états locaux : le focus, la sélection, la valeur saisie, etc.  Nous voulons préserver cet état à travers les mises à jour qui affichent conceptuellement la même UI.  Nous voulons aussi le détruire de façon prévisible lorsque nous affichons quelque chose de conceptuellement distinct (comme lorsque nous passons d’un <code class=\"language-text\">&lt;SignupForm&gt;</code> à un <code class=\"language-text\">&lt;MessengerChat&gt;</code>).</p>\n<p><strong>L’état local est si utile que React permet à <em>vos propres</em> composants d’en avoir un aussi.</strong>  Les composants restent des fonctions mais React les dope avec des fonctionnalités utiles pour faire de l’UI.  L’état local associé à leur position dans l’arbre fait partie de ces améliorations.</p>\n<p>Nous appelons ces fonctionnalités des <em>Hooks</em>. Par exemple, <code class=\"language-text\">useState</code> est un Hook.</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Example</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Vous avez cliqué </span><span class=\"token punctuation\">{</span>count<span class=\"token punctuation\">}</span><span class=\"token plain-text\"> fois</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span></span><span class=\"gatsby-highlight-code-line\"><span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span>count <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span></span><span class=\"token plain-text\">        Cliquez-moi</span>\n<span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Il renvoie un duo de valeurs : l’état courant et une fonction qui le met à jour.</p>\n<p>La syntaxe de <a href=\"https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Op%C3%A9rateurs/Affecter_par_d%C3%A9composition#D%C3%A9composition_d&#x27;un_tableau\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">déstructuration positionnelle</a> nous permet de donner des noms libres à nos variables d’état.  Par exemple, j’ai appelé ce duo <code class=\"language-text\">count</code> et <code class=\"language-text\">setCount</code>, mais ça aurait tout aussi bien pu être <code class=\"language-text\">banana</code> et <code class=\"language-text\">setBanana</code>.  Dans la suite de cet article, j’utilisera <code class=\"language-text\">setState</code> pour parler de la deuxième valeur, indépendamment de son nom effectif dans les différents exemples.</p>\n<p><em>(Vous pouvez en apprendre davantage sur <code class=\"language-text\">useState</code> et les autres Hooks fournis par React <a href=\"https://reactjs.org/docs/hooks-intro.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ici</a>.)</em></p>\n<h2 id=\"cohérence\"><a href=\"#coh%C3%A9rence\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cohérence</h2>\n<p>Même si nous souhaitions découper le processus de réconciliation lui-même en étapes de travail <a href=\"https://www.youtube.com/watch?v=mDdgfyRB5kg\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">non-bloquantes</a>, nous devrions tout de même effectuer les opérations réelles sur l’arbre hôte en une seule passe synchrone.  Ainsi nous pouvons nous assurer que l’utilisateur ne verra pas une UI mise à jour à moitié, et que le navigateur n’effectuera pas inutilement de la mise en page ou des calculs de style pour des états intermédiaires que l’utilisateur ne devrait même pas voir.</p>\n<p>C’est pourquoi React découpe tout son travail en « phase de rendu » et « phase de commit ». La <em>phase de rendu</em> décrit l’appel de vos composants par React et la réconciliation.  Elle peut être interrompue de façon fiable et <a href=\"https://reactjs.org/blog/2018/03/01/sneak-peek-beyond-react-16.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">à l’avenir</a> sera asynchrone. La <em>phase de commit</em> décrit les manipulations de l’arbre hôte par React.  Elle est toujours synchrone.</p>\n<h2 id=\"mémoïsation\"><a href=\"#m%C3%A9mo%C3%AFsation\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Mémoïsation</h2>\n<p>Quand un parent planifie une mise à jour en appelant <code class=\"language-text\">setState</code>, React réconcilie par défaut tout l’arbre de ses enfants.  Il procède ainsi parce qu’il ne sait pas si une mise à jour dans le parent affecterait ou non les enfants, aussi il opte par défaut pour une garantie de cohérence.  Ça semble très coûteux dit comme ça, mais en pratique ce n’est jamais un problème pour des arbres enfants de petite et moyenne tailles.</p>\n<p>Lorsque ces arbres deviennent trop profonds ou larges, vous pouvez dire à React de <a href=\"https://fr.wikipedia.org/wiki/M%C3%A9mo%C3%AFsation\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">mémoïser</a> un sous-arbre et de réutiliser un résultat de rendu précédent lorsque les props mises à jour restent identiques en surface :</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Row</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> item <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">memo</span><span class=\"token punctuation\">(</span>Row<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span></code></pre></div>\n<p>À présent un <code class=\"language-text\">setState</code> dans le composant <code class=\"language-text\">&lt;Table&gt;</code> parent sauterait la réconciliation des <code class=\"language-text\">Row</code>s dont la prop <code class=\"language-text\">item</code> référence la même valeur (pour des objets, le même objet en mémoire) que la prop <code class=\"language-text\">item</code> du rendu précédent.</p>\n<p>Vous pouvez affiner le degré de mémoïsation jusqu’au niveau d’expressions individuelles avec le <a href=\"https://reactjs.org/docs/hooks-reference.html#usememo\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Hook <code class=\"language-text\">useMemo()</code></a>. Le cache est local à la position dans l’arbre de composants et sera détruit avec l’état local.  Il ne contient que la dernière valeur utilisée.</p>\n<p>React ne mémoïse pas par défaut les composants, et c’est volontaire.  De nombreux composants reçoivent toujours des props différentes, de sorte que les mémoïser serait inutilement coûteux.</p>\n<h2 id=\"des-modèles-bruts\"><a href=\"#des-mod%C3%A8les-bruts\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Des modèles bruts</h2>\n<p>C’est assez ironique, mais React n’utilise pas de système « réactif » pour des mises à jour fines.  En d’autres termes, toute mise à jour au sommet déclenche une réconciliation au lieu de ne mettre à jour que les composants affectés par les modifications.</p>\n<p>Cette décision de conception est volontaire.  Le <a href=\"https://calibreapp.com/blog/time-to-interactive/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Time to interactive</a> est une métrique cruciale pour les applis web grand public, et la traversée des modèles pour définir des écouteurs fins consommerait trop de ce précieux temps initial.  Qui plus est, pour de nombreuses applis les interactions ont tendance à produire  des mises à jour très localisées (survol de bouton) ou au contraire très globales (transition de page), deux cas pour lesquels une supervision fine serait un gâchis de ressources en mémoire.</p>\n<p>Un des principes de conception fondamentaux de React, c’est qu’il doit fonctionner avec des données brutes.  Si vous avez un tas d’objets JavaScript reçus par le réseau, vous devez pouvoir les injecter dans vos composants sans traitement préalable.  On ne voulait pas de pièges vous empêchant d’accéder à certaines propriétés, ou de soucis soudains de performance sur certains changements subtils de structure.  Le rendu de React est en O(<em>taille de la vue</em>) plutôt qu’en O(<em>taille du modèle</em>), et on peut significativement réduire la <em>taille de la vue</em> grâce au <a href=\"https://react-window.now.sh/#/examples/list/fixed-size\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">fenêtrage virtuel</a>.</p>\n<p>Pour certaines applis, des abonnements fins restent très utiles—par exemple des affichages temps réel d’indices boursiers.  Ce sont des exemples rares de situations où « tout est toujours mis à jour en même temps ».  Même s’il dispose de certaines sorties de secours orientées code impératif pour optimiser ce type de cas, React n’est sans doute pas la meilleure option dans ces situations.  Quoi qu’il en soit, rien ne vous empêche d’implémenter votre propre système d’abonnements fins par-dessus React.</p>\n<p><strong>Notez toutefois qu’on trouve des problèmes de performances classiques que même les abonnements fins et les sytèmes « réactifs » ne peuvent résoudre.</strong>  Par exemple, faire le rendu d’un <em>nouvel</em> arbre profond (ce qui arrive à chaque transition de page) sans bloquer le navigateur.  Suivre finement les modifications n’aiderait en rien—en fait, ça ralentirait même le traitement parce qu’on aurait davantage de boulot pour mettre en place les abonnements.  Autre souci classique : devoir attendre des données pour commencer le rendu d’une vue.  Avec React, nous espérons résoudre ces deux problématiques grâce au <a href=\"https://reactjs.org/blog/2018/03/01/sneak-peek-beyond-react-16.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Rendu Concurrent</a>.</p>\n<h2 id=\"traitement-par-lots\"><a href=\"#traitement-par-lots\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Traitement par lots</h2>\n<p>Plusieurs composants pourraient vouloir mettre à jour leur état en réponse à un même événement.  L’exemple ci-dessous est artificiel mais il illustre un schéma courant :</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Parent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span>count <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span></span><span class=\"token plain-text\">      Vous avez cliqué </span><span class=\"token punctuation\">{</span>count<span class=\"token punctuation\">}</span><span class=\"token plain-text\"> fois sur le parent</span>\n<span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Child</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">Child</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span>count <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span></span><span class=\"token plain-text\">      Vous avez cliqué </span><span class=\"token punctuation\">{</span>count<span class=\"token punctuation\">}</span><span class=\"token plain-text\"> fois sur l’enfant</span>\n<span class=\"token plain-text\">    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Quand un événement survient, la prop <code class=\"language-text\">onClick</code> de l’enfant est déclenchée d’abord (ce qui exécute un <code class=\"language-text\">setState</code>).  Puis le parent appelle <code class=\"language-text\">setState</code> au sein de son propre gestionnaire <code class=\"language-text\">onClick</code>.</p>\n<p>Si React lançait immédiatement un nouveau rendu de composants en réponse aux appels à <code class=\"language-text\">setState</code>,  on se retrouverait à faire le rendu de l’enfant deux fois :</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token operator\">**</span><span class=\"token operator\">*</span> <span class=\"token constant\">D</span>ébut du gestionnaire d’événement click de React <span class=\"token operator\">**</span><span class=\"token operator\">*</span>\n<span class=\"token function\">Child</span> <span class=\"token punctuation\">(</span>onClick<span class=\"token punctuation\">)</span>\n  <span class=\"token operator\">-</span> setState\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token operator\">-</span> rendu de Child <span class=\"token comment\">// 😞 inutile</span></span><span class=\"token function\">Parent</span> <span class=\"token punctuation\">(</span>onClick<span class=\"token punctuation\">)</span>\n  <span class=\"token operator\">-</span> setState\n  <span class=\"token operator\">-</span> rendu de Parent\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token operator\">-</span> rendu de Child</span><span class=\"token operator\">**</span><span class=\"token operator\">*</span> Fin du gestionnaire d’événement click de React <span class=\"token operator\">**</span><span class=\"token operator\">*</span></code></pre></div>\n<p>Le premier rendu de <code class=\"language-text\">Child</code> est gaspillé.  Et nous ne pourrions pas faire que React saute le deuxième rendu de <code class=\"language-text\">Child</code> parce que <code class=\"language-text\">Parent</code> lui passe peut-être des données différentes suite à la mise à jour de son état.</p>\n<p><strong>Voilà pourquoi React traite les mises à jour au sein des gestionnaires d’événements par lot :</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token operator\">**</span><span class=\"token operator\">*</span> <span class=\"token constant\">D</span>ébut du gestionnaire d’événement click de React <span class=\"token operator\">**</span><span class=\"token operator\">*</span>\n<span class=\"token function\">Child</span> <span class=\"token punctuation\">(</span>onClick<span class=\"token punctuation\">)</span>\n  <span class=\"token operator\">-</span> setState\n<span class=\"token function\">Parent</span> <span class=\"token punctuation\">(</span>onClick<span class=\"token punctuation\">)</span>\n  <span class=\"token operator\">-</span> setState\n<span class=\"token operator\">**</span><span class=\"token operator\">*</span> Traitement des mises à jour d’état               <span class=\"token operator\">**</span><span class=\"token operator\">*</span>\n  <span class=\"token operator\">-</span> rendu de Parent\n  <span class=\"token operator\">-</span> rendu de Child\n<span class=\"token operator\">**</span><span class=\"token operator\">*</span> Fin du gestionnaire d’événement click de React   <span class=\"token operator\">**</span><span class=\"token operator\">*</span></code></pre></div>\n<p>Les appels à <code class=\"language-text\">setState</code> dans les composants ne causent pas immédiatement un nouveau rendu.  Au lieu de ça, React exécute d’abord tous les gestionnaires d’événements, puis déclenche un unique rendu qui regroupe toutes les mises à jour d’état.</p>\n<p>Le regroupement en lots améliore les performances mais peut surprendre lorsque vous écrivez ce genre de code :</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCounter<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">function</span> <span class=\"token function\">increment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setCounter</span><span class=\"token punctuation\">(</span>count <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">function</span> <span class=\"token function\">handleClick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">increment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">increment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">increment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p>Si on a commencé avec un <code class=\"language-text\">count</code> à <code class=\"language-text\">0</code>, on aurait juste trois appels à <code class=\"language-text\">setCount(1)</code>.  Pour corriger ça, <code class=\"language-text\">setState</code> peut aussi être appelé avec une fonction de « mise à jour » :</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCounter<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">function</span> <span class=\"token function\">increment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setCounter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">c</span> <span class=\"token operator\">=></span> c <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">function</span> <span class=\"token function\">handleClick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">increment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">increment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">increment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p>React mettrait ces fonctions dans une file, et plus tard les déclencherait en séquence, aboutissant à un nouveau rendu avec <code class=\"language-text\">count</code> à <code class=\"language-text\">3</code>.</p>\n<p>Si votre logique de gestion d’état devient plus complexe que quelques appels à <code class=\"language-text\">setState</code>, je vous recommande de l’exprimer sous forme d’un réducteur d’état local grâce au <a href=\"https://reactjs.org/docs/hooks-reference.html#usereducer\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Hook <code class=\"language-text\">useReducer</code></a>. C’est une sorte d‘évolution de cette approche dans laquelle chaque type de mise à jour dispose d’un nom :</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>counter<span class=\"token punctuation\">,</span> dispatch<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useReducer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">state<span class=\"token punctuation\">,</span> action</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>action <span class=\"token operator\">===</span> <span class=\"token string\">'increment'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> state <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> state<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">function</span> <span class=\"token function\">handleClick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'increment'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'increment'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'increment'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p>L’argument <code class=\"language-text\">action</code> peut être n’importe quoi, même si c’est le plus souvent un objet.</p>\n<h2 id=\"arbre-dappels\"><a href=\"#arbre-dappels\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Arbre d’appels</h2>\n<p>La runtime d’un langage de programmation a généralement une <a href=\"https://medium.freecodecamp.org/understanding-the-javascript-call-stack-861e41ae61d4\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">pile d’appels</a>.  Quand une fonction <code class=\"language-text\">a()</code> appelle <code class=\"language-text\">b()</code> qui elle-même appelle <code class=\"language-text\">c()</code>, quelque part dans le moteur JavaScript on trouve une structure de données du style <code class=\"language-text\">[a, b, c]</code> qui « garde trace » de l’endroit où vous êtes et du code à exécuter ensuite.    Une fois que vous quittez <code class=\"language-text\">c</code>, son descripteur dans la pile d’appel disparaît—pouf ! On n’a plus besoin de lui.  On revient à l’intérieur de <code class=\"language-text\">b</code>.  Lorsqu’on finit par quitter <code class=\"language-text\">a</code>, la pile d’appels est vide.</p>\n<p>Bien sûr, React lui-même est en JavaScript et obéit aux règles de ce langage.  Mais on peut imaginer qu’en interne React ait une sorte de pile d’appels à lui pour se rappeler quel composant est en train de faire son rendu, par exemple <code class=\"language-text\">[App, Page, Layout, Article /* Nous sommes ici */]</code>.</p>\n<p>Là où React diffère d’une runtime de langage traditionnelle, c’est qu’il est spécialisé dans le rendu d’arbres d’UI.  Ces arbres ont besoin de « rester en vie » afin que nous puissions interagir avec eux.  Le DOM ne disparaît pas après notre premier appel à <code class=\"language-text\">ReactDOM.render()</code>.</p>\n<p>Je tire sans doute un peu trop sur la métaphore, mais j’aime imaginer que les composants React sont dans une sorte « d’arbre d’appels » plutôt qu’une simple « pile d’appels ».  Quand on « sort » d’un composant <code class=\"language-text\">Article</code>, son descripteur dans « l’arbre d’appels » de React n’est pas détruit.  Il faut bien qu’on conserve l’état local et les références vers les instances hôtes <a href=\"https://medium.com/react-in-depth/the-how-and-why-on-reacts-usage-of-linked-list-in-fiber-67f1014d0eb7\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">quelque part</a>.</p>\n<p>Ces descripteurs de « l’arbre d’appels » <em>sont bien</em> détruits, avec leur état local et leurs instances hôtes, mais uniquement quand les règles de la <a href=\"#r%C3%A9conciliation\">réconciliation</a> le jugent nécessaire.  Si vous avez déjà lu le code source de React, vous avez peut-être entendu parler de ces descripteurs, dont le nom technique est <a href=\"https://fr.wikipedia.org/wiki/Fibre_(informatique)\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Fibres</a>.</p>\n<p>C’est dans ces Fibres que l’état local est maintenu.  Quand l’état change, React considère que les Fibres dans l’arbre sous-jacent ont besoin d’une réconciliation, et appelle ces composants.</p>\n<h2 id=\"contexte\"><a href=\"#contexte\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Contexte</h2>\n<p>Dans React, on transmet des données aux autres composants à l’aide des props.  Parfois, la majorité des composants ont besoin de la même chose—par exemple, le thème visuel actuellement employé.  Ça devient vite fastidieux de transmettre cette info à chaque niveau de profondeur.</p>\n<p>React résout ça avec le <a href=\"https://reactjs.org/docs/context.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Contexte</a>.  C’est dans le principe comme une <a href=\"http://wiki.c2.com/?DynamicScoping\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">portée dynamique</a> pour les composants.  C’est comme un trou de ver qui vous permet de placer une info tout en haut, et que chaque enfant plus bas dans l’arbre soit capable de la lire et de relancer son rendu quand elle change.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> ThemeContext <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">createContext</span><span class=\"token punctuation\">(</span>\n  <span class=\"token string\">'light'</span> <span class=\"token comment\">// Valeur par défaut et valeur de secours</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">DarkApp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ThemeContext.Provider</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>dark<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MyComponents</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">ThemeContext.Provider</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">SomeDeeplyNestedChild</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Dépend d’où l’enfant fait son rendu</span>\n  <span class=\"token keyword\">const</span> theme <span class=\"token operator\">=</span> <span class=\"token function\">useContext</span><span class=\"token punctuation\">(</span>ThemeContext<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Quand <code class=\"language-text\">SomeDeeplyNestedChild</code> fait son rendu, <code class=\"language-text\">useContext(ThemeContext)</code> ira chercher le plus proche <code class=\"language-text\">&lt;ThemeContext.Provider&gt;</code> en remontant l’arbre, et utilisera sa <code class=\"language-text\">value</code>.</p>\n<p>(En pratique, React maintient une pile de contexte pendant le rendu.)</p>\n<p>S’il n’y a pas de <code class=\"language-text\">ThemeContext.Provider</code> au-dessus, le résultat d’un appel à <code class=\"language-text\">useContext(ThemeContext)</code> sera la valeur par défaut fournie lors de l’appel à <code class=\"language-text\">createContext()</code>.  Dans notre exemple, ce serait <code class=\"language-text\">&#39;light&#39;</code>.</p>\n<h2 id=\"effets\"><a href=\"#effets\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Effets</h2>\n<p>Nous avons mentionné plus tôt que les composants React ne devraient pas avoir d’effet de bord observable pendant le rendu.  Mais les effets de bord sont parfois nécessaires.  On peut vouloir gérer le focus, dessiner sur un canevas, s’abonner à une source de données, et ainsi de suite.</p>\n<p>Dans React, on fait ça en déclarant un effet :</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Example</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">    document<span class=\"token punctuation\">.</span>title <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Vous avez cliqué </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>count<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> fois</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Vous avez cliqué </span><span class=\"token punctuation\">{</span>count<span class=\"token punctuation\">}</span><span class=\"token plain-text\"> fois</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span>count <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">        Cliquez-moi</span>\n<span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Chaque fois que possible, React diffère l’exécution des effets jusqu’à ce que le navigateur redessine à l’écran.  L’intérêt est de minimiser des métriques telles que <a href=\"https://calibreapp.com/blog/time-to-interactive/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">time to interactive</a> et <a href=\"https://developers.google.com/web/tools/lighthouse/audits/first-meaningful-paint\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">time to first paint</a>, qui ne devraient pas pâtir de tâches comme l’abonnement à une source de données. (Il y a un Hook <a href=\"https://reactjs.org/docs/hooks-reference.html#uselayouteffect\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">rarement utilisé</a> qui vous permet de contourner ce comportement pour faire des traitements synchrones.  Évitez.)</p>\n<p>Les effets ne s’exécutent pas qu’une seule fois.  Ils ont lieu aussi bien après que le composant est affiché à l’utilisateur pour la première fois, qu’après ses mises à jour.  Les effets peuvent exploiter les props et l’état local courants, grâce à la fermeture lexicale <em>(closure, NdT)</em>, comme avec <code class=\"language-text\">count</code> dans l’exemple ci-dessus.</p>\n<p>Certains effets peuvent avoir besoin d’un code de nettoyage, comme dans le cas des abonnements.  Pour nettoyer derrière lui, un effet peut renvoyer une fonction :</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    DataSource<span class=\"token punctuation\">.</span><span class=\"token function\">addSubscription</span><span class=\"token punctuation\">(</span>handleChange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> DataSource<span class=\"token punctuation\">.</span><span class=\"token function\">removeSubscription</span><span class=\"token punctuation\">(</span>handleChange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>React exécutera la fonction renvoyée avant d’appliquer l’effet la fois suivante, ainsi qu’avant de détruire le composant.</p>\n<p>Parfois, re-exécuter l’effet à chaque rendu n’est pas souhaitable.  On peut demander à React de <a href=\"https://reactjs.org/docs/hooks-effect.html#tip-optimizing-performance-by-skipping-effects\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">sauter</a> l’exécution de l’effet si certaines variables n’ont pas changé :</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    document<span class=\"token punctuation\">.</span>title <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Vous avez cliqué </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>count<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> fois</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span></code></pre></div>\n<p>Ceci dit, c’est souvent une optimisation prématurée, et ça peut amener des problèmes si vous n’êtes pas bien à l’aise avec le fonctionnement des fermetures lexicales en JavaScript.</p>\n<p>Par exemple, le code suivant est défectueux :</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    DataSource<span class=\"token punctuation\">.</span><span class=\"token function\">addSubscription</span><span class=\"token punctuation\">(</span>handleChange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> DataSource<span class=\"token punctuation\">.</span><span class=\"token function\">removeSubscription</span><span class=\"token punctuation\">(</span>handleChange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Il bugue parce que <code class=\"language-text\">[]</code> dit en substance « ne re-exécute jamais cet effet ».  Mais l’effet utilise le <code class=\"language-text\">handleChange</code> de la portée englobante, et le corps de <code class=\"language-text\">handleChange</code> pourrait exploiter des props ou de l’état local :</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">  <span class=\"token keyword\">function</span> <span class=\"token function\">handleChange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>count<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p>Si on ne laisse jamais l’effet se re-exécuter, <code class=\"language-text\">handleChange</code> continuera à référencer sa version du premier rendu, et <code class=\"language-text\">count</code> y sera toujours à <code class=\"language-text\">0</code>.</p>\n<p>Pour éviter ça, assurez-vous que si vous précisez un tableau de dépendances, il contienne bien <strong>toutes</strong> les choses qui peuvent changer, y compris les fonctions :</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    DataSource<span class=\"token punctuation\">.</span><span class=\"token function\">addSubscription</span><span class=\"token punctuation\">(</span>handleChange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> DataSource<span class=\"token punctuation\">.</span><span class=\"token function\">removeSubscription</span><span class=\"token punctuation\">(</span>handleChange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>handleChange<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span></code></pre></div>\n<p>En fonction de votre code, vous verriez peut-être encore des ré-abonnements superflus parce que <code class=\"language-text\">handleChange</code> elle-même est différente à chaque <code class=\"language-text\">render</code>.  Le Hook <a href=\"https://reactjs.org/docs/hooks-reference.html#usecallback\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">useCallback</code></a> peut vous aider dans ce type de situation.  Ou alors, vous pouvez laisser le ré-abonnement se faire.  Par exemple, l’API <code class=\"language-text\">addEventListener</code> du navigateur est extrêmement rapide, et sauter à travers des cerceaux en flamme pour éviter de l’appeler risque d’être plus problématique que de la laisser faire.</p>\n<p><em>(Vous pouvez en apprendre davantage sur <code class=\"language-text\">useEffect</code> et les autres Hooks fournis par React <a href=\"https://reactjs.org/docs/hooks-effect.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ici</a>.)</em></p>\n<h2 id=\"hooks-personnalisés\"><a href=\"#hooks-personnalis%C3%A9s\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Hooks personnalisés</h2>\n<p>Dans la mesure où des Hooks comme <code class=\"language-text\">useState</code> et <code class=\"language-text\">useEffect</code> sont des appels de fonctions, nous pouvons les composer pour créer nos propres Hooks :</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">MyResponsiveComponent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> width <span class=\"token operator\">=</span> <span class=\"token function\">useWindowWidth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Notre Hook personnalisé</span></span>  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">La fenêtre fait </span><span class=\"token punctuation\">{</span>width<span class=\"token punctuation\">}</span><span class=\"token plain-text\"> de large</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">function</span> <span class=\"token function\">useWindowWidth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span>  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>width<span class=\"token punctuation\">,</span> setWidth<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>innerWidth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleResize</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setWidth</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>innerWidth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'resize'</span><span class=\"token punctuation\">,</span> handleResize<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      window<span class=\"token punctuation\">.</span><span class=\"token function\">removeEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'resize'</span><span class=\"token punctuation\">,</span> handleResize<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> width<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Les Hooks personnalisés permettent à différents composants de partager une logique à état réutilisable.  Notez que <em>l’état lui-même</em> n’est pas partagé.  Chaque appel à un Hook déclare son propre état isolé.</p>\n<p><em>(Vous pouvez en apprendre davantage sur l’écriture de vos propres Hooks <a href=\"https://reactjs.org/docs/hooks-custom.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ici</a>.)</em></p>\n<h2 id=\"ordre-statique-dutilisation\"><a href=\"#ordre-statique-dutilisation\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Ordre statique d’utilisation</h2>\n<p>Vous pouvez considérer <code class=\"language-text\">useState</code> comme une syntaxe pour définir une « variable d’état React ».  Ce n’est pas <em>vraiment</em> une syntaxe, naturellement.  Nous écrivons toujours du JavaScript.  Mais nous considérons ici React comme un environnement d’exécution, et parce que React spécialise JavaScript pour la description d’arbres d’UI, ses fonctionnalités sont parfois au plus près de la couche langage.</p>\n<p>Si <code class=\"language-text\">use</code> <em>était</em> une syntaxe, il serait logique qu’elle existe au niveau racine des composants :</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// 😉 Note : cette syntaxe n’existe pas</span>\ncomponent <span class=\"token function\">Example</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> use <span class=\"token function\">State</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">      &lt;pVous avez cliqué </span><span class=\"token punctuation\">{</span>count<span class=\"token punctuation\">}</span><span class=\"token plain-text\"> fois</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span>count <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">        Cliquez-moi</span>\n<span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Du coup, que pourrait bien signifier le recours à cette syntaxe à l’intérieur d’un bloc conditionnel, d’une fonction de rappel, ou hors d’un composant ?</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// 😉 Note : cette syntaxe n’existe pas</span>\n\n<span class=\"token comment\">// Est-ce un état local... ou autre chose ?</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> use <span class=\"token function\">State</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\ncomponent <span class=\"token function\">Example</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>condition<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Que se passe-t-il si la condition est fausse ?</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> use <span class=\"token function\">State</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">function</span> <span class=\"token function\">handleClick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Que se passe-t-il quand on quitte cette fonction ?</span>\n    <span class=\"token comment\">// En quoi est-ce différent d’une variable ?</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> use <span class=\"token function\">State</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p>L’état dans React est local au <em>composant</em> et à son identité dans l’arbre. Si <code class=\"language-text\">use</code> était une véritable syntaxe, il serait du coup logique qu’on limite son utilisabilité à la portée racine d’un composant :</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// 😉 Note : cette syntaxe n’existe pas</span>\ncomponent <span class=\"token function\">Example</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Seulement valide ici</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> use <span class=\"token function\">State</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>condition<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Ici ça donnerait une erreur de syntaxe</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> use <span class=\"token function\">State</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p>C’est un peu comme le fait que <code class=\"language-text\">import</code> ne marche qu’au niveau racine d’un module.</p>\n<p><strong>Bien sûr, <code class=\"language-text\">use</code> n‘est pas réellement une syntaxe.</strong> (Ça n’aurait pas beaucoup d’avantages mais ça entraînerait une tonne de friction.)</p>\n<p>Ceci dit, React <em>s’attend bien</em> à ce que tous les appels aux Hooks surviennent uniquement au niveau racine de composants, et de façon inconditionnelle. Ces <a href=\"https://reactjs.org/docs/hooks-rules.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Règles des Hooks</a> peuvent être garanties avec un <a href=\"https://www.npmjs.com/package/eslint-plugin-react-hooks\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">plugin de linter</a>.  Ce choix de conception a donné lieu à des débats houleux mais en pratique je n’ai pas eu vent de personnes qui auraient été surprises à l’usage.  J’ai également écrit un article qui explique pourquoi les alternatives couramment suggérées <a href=\"/why-do-hooks-rely-on-call-order/\">ne fonctionnent pas</a>.</p>\n<p>En interne, les Hooks sont implémentés avec des <a href=\"https://dev.to/aspittel/thank-u-next-an-introduction-to-linked-lists-4pph\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">listes liées</a>.  Quand on appelle <code class=\"language-text\">useState</code>, on déplace un pointeur sur le prochain élément.  Quand on quitte le <a href=\"#arbre-dappels\">descripteur dans « l’arbre d’appels »</a> du composant, on sauve la liste résultat jusqu’au prochain rendu.</p>\n<p><a href=\"https://medium.com/@ryardley/react-hooks-not-magic-just-arrays-cd4f1857236e\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Cet article</a> fournit une explication simplifiée du fonctionnement interne des Hooks.  Il est peut-être plus facile d’y penser en termes de tableaux qu’en termes de listes liées :</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// Pseudocode</span>\n<span class=\"token keyword\">let</span> hooks<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  i<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>hooks<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Rendus suivants</span>\n    <span class=\"token keyword\">return</span> hooks<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// Premier rendu</span>\n  hooks<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// On se prépare au rendu</span>\ni <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\nhooks <span class=\"token operator\">=</span> fiber<span class=\"token punctuation\">.</span>hooks <span class=\"token operator\">||</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Appel du composant</span>\n<span class=\"token function\">YourComponent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Mémoriser l’état des Hooks</span>\nfiber<span class=\"token punctuation\">.</span>hooks <span class=\"token operator\">=</span> hooks<span class=\"token punctuation\">;</span></code></pre></div>\n<p><em>(Si vous êtes curieux·se, le véritable code est <a href=\"https://github.com/facebook/react/blob/master/packages/react-reconciler/src/ReactFiberHooks.js\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ici</a>.)</em></p>\n<p>C’est <em>grosso modo</em> comme ça que les appels à <code class=\"language-text\">useState()</code> obtiennent le bon état.  Comme nous l’avons vu <a href=\"#r%C3%A9conciliation\">plus tôt</a>, « faire correspondre des trucs » n’a rien de nouveau pour React—la réconciliation repose de façon similaire sur la correspondance entre éléments d’un rendu à l’autre.</p>\n<h2 id=\"et-le-reste\"><a href=\"#et-le-reste\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Et le reste</h2>\n<p>Nous avons abordé pratiquement tous les aspects importants de React comme environnement d’exécution.  Si vous avez fini cette page, vous avez sans doute une connaissance plus pointue de React que 90% de ses utilisateurs.  Et il n’y a rien de mal à ça !</p>\n<p>J’ai laissé de côté certaines parties—principalement parce qu’elles ne sont pas encore parfaitement claires même pour nous.  React n’a pas pour le moment de solution satisfaisante pour des rendus multi-passes, c’est-à-dire quand le rendu du parent a besoin d’infos issues de ses enfants.  Et puis, l’<a href=\"https://reactjs.org/docs/error-boundaries.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">API de gestion d’erreurs</a> n’a pas encore de version Hook.  Il est possible que ces deux points soient résolus d’un seul coup.  Le Mode Concurrent n’est pas encore stable, et son interaction avec Suspense soulève des questions intéressantes.  Peut-être que je ferai un article complémentaire lorsque nous aurons de meilleures réponses à ces questions, et que Suspense sera prêt pour davantage que du <a href=\"https://reactjs.org/blog/2018/10/23/react-v-16-6.html#reactlazy-code-splitting-with-suspense\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">chargement paresseux</a>.</p>\n<p><strong>Je trouve que ça en dit long sur le succès de l’API de React, qu’on puisse aller aussi loin avec sans jamais avoir à se préoccuper de la majorité de ces questions.</strong>  De bons comportements par défaut comme l’heuristique de la réconciliation fonctionnent impeccablement la plupart du temps.  Et des avertissements comme celui sur <code class=\"language-text\">key</code> vous donnent une petite tape sur l’épaule quand vous risquez de vous tirer dans le pied.</p>\n<p>Si vous êtes accroc de bibliothèques UI, j’espère que cet article vous aura diverti, et aura clarifié le fonctionnement profond de React.  Ou peut-être avez-vous décidé que React est trop compliqué et que vous ne voulez plus en entendre parler.  Quoi qu’il en soit, j’adorerais avoir votre réaction sur Twitter !  Merci de m’avoir lu.</p>","timeToRead":43,"frontmatter":{"title":"React vu comme une Runtime d’UI","date":"February 02, 2019","spoiler":"Une description en profondeur du modèle de programmation de React.","cta":null},"fields":{"slug":"/fr/react-as-a-ui-runtime/","langKey":"fr"}}},"pageContext":{"slug":"/fr/react-as-a-ui-runtime/","translations":["es","ko","pt-br","zh-hans","fr"],"translatedLinks":["/the-elements-of-ui-engineering/","/why-do-react-elements-have-typeof-property/","/why-do-hooks-rely-on-call-order/"]}}}