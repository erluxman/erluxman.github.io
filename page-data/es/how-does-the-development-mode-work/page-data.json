{"componentChunkName":"component---src-templates-blog-post-js","path":"/es/how-does-the-development-mode-work/","result":{"data":{"site":{"siteMetadata":{"title":"Overreacted","author":"Dan Abramov"}},"markdownRemark":{"id":"fd7cf908-6fd2-5724-83f4-e0ed6b18b2b9","html":"<p>Si tu base de c√≥digo JavaScript es al menos moderadamente compleja, <strong>probablemente tienes una forma de compilar en <em>bundles</em> c√≥digo diferente en desarrollo y producci√≥n</strong>.</p>\n<p>Compilar en <em>bundles</em> y ejecutar c√≥digo diferente en desarrollo y producci√≥n es poderoso. En modo de desarrollo, React incluye muchas advertencias que te ayudan a encontrar problemas antes de que lleven a bugs. Sin embargo, el c√≥digo necesario para detectar tales problemas con frecuencia aumentan el tama√±o del <em>bundle</em> y ralentiza la aplicaci√≥n.</p>\n<p>La ralentizaci√≥n es aceptable en desarrollo. De hecho, ejecutar el c√≥digo m√°s lentamente en desarrollo <em>puede hasta ser beneficioso</em> porque compensa parcialmente la discrepancia entre m√°quinas r√°pidas de desarrollo y los dispositivos promedio de los consumidores.</p>\n<p>En producci√≥n no queremos pagar ese costo. Por lo tanto, omitimos estas verificaciones. ¬øC√≥mo funciona eso? Veamos.</p>\n<hr>\n<p>La forma exacta para ejecutar c√≥digo en desarrollo depende de tu <em>build pipeline</em> de JavaScript (y de si tienes una). En Facebook es algo as√≠:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>__DEV__<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">hacerAlgoEnDesarrollo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">hacerAlgoEnProd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Aqu√≠, <code class=\"language-text\">__DEV__</code> no es una variable real. Es una constante que se sustituye cuando los m√≥dulos son compilados para el navegador. El resultado se ve as√≠:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// En desarrollo:</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">hacerAlgoEnDesarrollo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// üëà</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">hacerAlgoEnProd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// En producci√≥n:</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">hacerAlgoEnDesarrollo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">hacerAlgoEnProd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// üëà</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>En producci√≥n, tambi√©n ejecutar√≠as un <em>minificador</em> (por ejemplo, <a href=\"https://github.com/terser-js/terser\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">terser</a>) en el c√≥digo. La mayor√≠a de los <em>minificadores</em> de JavaScript hacen una forma limitada de <a href=\"https://es.wikipedia.org/wiki/Eliminaci%C3%B3n_de_c%C3%B3digo_muerto\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">eliminaci√≥n de c√≥digo muerto</a>, como quitar las ramas <code class=\"language-text\">if (false)</code>. Entonces en producci√≥n s√≥lo ver√≠as:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// En producci√≥n (luego de minificar):</span>\n<span class=\"token function\">hacerAlgoEnProd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><em>(Ten en cuenta que hay l√≠mites significativos en qu√© tan efectiva es la eliminaci√≥n de c√≥digo muerto con herramientas comunes de JavaScript, pero eso es un tema aparte.)</em></p>\n<p>Aunque puede que no est√©s usando la constante m√°gica <code class=\"language-text\">__DEV__</code>, si usas alg√∫n <em>bundler</em> de JavaScript popular como webpack, puede que haya otra convenci√≥n que puedas seguir. Por ejemplo, es com√∫n expresar el mismo patr√≥n de esta forma:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">hacerAlgoEnDesarrollo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">hacerAlgoEnProd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>Ese es exactamente el patr√≥n usado por librer√≠as como <a href=\"https://es.reactjs.org/docs/optimizing-performance.html#use-the-production-build\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">React</a> y <a href=\"https://vuejs.org/v2/guide/deployment.html#Turn-on-Production-Mode\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Vue</a> cuando los importas de npm usando un <em>bundler</em></strong> (Las compilaciones de etiquetas <code class=\"language-text\">&lt;script&gt;</code> de un solo archivo ofrecen versiones de desarrollo y producci√≥n como archivos <code class=\"language-text\">.js</code> y <code class=\"language-text\">.min.js</code> separados.)</p>\n<p>Esta convenci√≥n en particular viene de Node.js. En Node.js, hay una variable global <code class=\"language-text\">process</code> que expone las variables de entorno de tu sistema como propiedades en el objeto <a href=\"https://nodejs.org/dist/latest-v8.x/docs/api/process.html#process_process_env\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">process.env</code></a>. Sin embargo, cuando ves este patr√≥n en una base de c√≥digo de <em>front-end</em>, no hay ninguna variable real <code class=\"language-text\">process</code> involucrada. ü§Ø</p>\n<p>En su lugar, toda la expresi√≥n <code class=\"language-text\">process.env.NODE_ENV</code> se sustituye por un string literal en el momento de compilaci√≥n, igual que nuestra variable m√°gica <code class=\"language-text\">__DEV__</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// En desarrollo</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'development'</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// true</span>\n  <span class=\"token function\">hacerAlgoEnDesarrollo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// üëà</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">hacerAlgoEnProd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// En producci√≥n:</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'production'</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// false</span>\n  <span class=\"token function\">hacerAlgoEnDesarrollo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">hacerAlgoEnProd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// üëà</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Dado que toda la expresi√≥n es constante (<code class=\"language-text\">&#39;production&#39; !== &#39;production&#39;</code> siempre ser√° <code class=\"language-text\">false</code>), un <em>minificador</em> tambi√©n puede quitar la otra rama.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// En producci√≥n (luego de minificar):</span>\n<span class=\"token function\">hacerAlgoEnProd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Travesura lograda.</p>\n<hr>\n<p>Ten en cuenta que esto <strong>no funcionar√≠a</strong> con expresiones m√°s complejas:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">let</span> mode <span class=\"token operator\">=</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>mode <span class=\"token operator\">!==</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// üî¥ no se garantiza que se elimine</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Las herramientas de an√°lisis est√°tico de JavaScript no son muy inteligentes debido a la naturaleza din√°mica del lenguaje. Cuando ven variables como <code class=\"language-text\">mode</code> en lugar de expresiones est√°ticas como <code class=\"language-text\">false</code> o <code class=\"language-text\">&#39;production&#39; !== &#39;production&#39;</code>, generalmente se rinden.</p>\n<p>De igual forma, la eliminaci√≥n de c√≥digo muerto en JavaScript generalmente no funciona bien fuera de los l√≠mites del m√≥dulo cuando usas la sentencia de nivel superior <code class=\"language-text\">import</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// üî¥ no se garantiza que se elimine</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>algunaFuncion<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'some-module'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">algunaFuncion</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Por eso necesitas escribir c√≥digo de forma muy mec√°nica tal que haga la condici√≥n <em>definitivamente est√°tica</em> y asegure que <em>todo el c√≥digo</em> que quieres eliminar se encuentre dentro.</p>\n<hr>\n<p>Para que todo esto funcione, tu <em>bundler</em> necesita reemplazar <code class=\"language-text\">process.env.NODE_ENV</code> y necesita saber en qu√© modo <em>quieres</em> compilar el proyecto.</p>\n<p>Hace unos a√±os, sol√≠a ser com√∫n olvidarse configurar el entorno. Con frecuencia ve√≠as proyectos en modo de desarrollo desplegados en producci√≥n.</p>\n<p>Eso es malo porque hace que el sitio web cargue y funcione m√°s lentamente.</p>\n<p>En los √∫ltimos dos a√±os, la situaci√≥n mejor√≥ significativamente. Por ejemplo, webpack a√±adi√≥ una simple opci√≥n <code class=\"language-text\">mode</code> en lugar de tener que configurar manualmente el reemplazo de <code class=\"language-text\">process.env.NODE_ENV</code>. Ahora React DevTools tambi√©n muestra un √≠cono rojo en sitios en modo de desarrollo, haciendo m√°s f√°cil identificar e incluso <a href=\"https://mobile.twitter.com/BestBuySupport/status/1027195363713736704\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">reportar</a>.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ca1c0db064f73cc5c8e21ad605eaba26/0a47e/devmode.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 33.108108108108105%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAABYlAAAWJQFJUiTwAAABGUlEQVQY04WQ3W6DMAyF8/4vtStWSEmAQlm7aZUmIPy1lIRAoFCYA+p1jyLn2FbkL0bTOz1fAgvp0PfX6v73+RGdv1C7qus6pZSUErxstDa/dfSl1GNon9NjWZZxmtoyr283RAnFluW5XhAEpmn6/gE8sW1sYUqhSanjUEIw3v+cnFuZqH4QXKwgE0pYWuR5ylgcx4yxvCiKsoSgiymUU7DX8hpHUcIy6GZZdvm9AOY4jgiwXoSy0cQCzHaU5m0F5xCVTiTnHIwmH8dhGJBhGK7jAuzRO5mGa1sHlxyJHfret++esbU3dztC6Po7HB7DRjTLKj153Y1ei2wUrztRd/eqvVcSTF110IRRQsB4DoDwYJ5niPBnmPwP62GCWHyCrHAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Advertencia de modo de desarrollo en React DevTools\"\n        title=\"\"\n        src=\"/static/ca1c0db064f73cc5c8e21ad605eaba26/fcda8/devmode.png\"\n        srcset=\"/static/ca1c0db064f73cc5c8e21ad605eaba26/12f09/devmode.png 148w,\n/static/ca1c0db064f73cc5c8e21ad605eaba26/e4a3f/devmode.png 295w,\n/static/ca1c0db064f73cc5c8e21ad605eaba26/fcda8/devmode.png 590w,\n/static/ca1c0db064f73cc5c8e21ad605eaba26/0a47e/devmode.png 600w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>Instaladores dogm√°ticos como Create React App, Next/Nuxt, Vue CLI, Gatsby y otros hacen m√°s dif√≠cil equivocarse con esto separando los <em>builds</em> de desarrollo y producci√≥n en dos comandos separados (por ejemplo, <code class=\"language-text\">npm start</code> y <code class=\"language-text\">npm run build</code>). Generalmente, solo se puede desplegar el build de producci√≥n por lo que el desarrollador ya no puede cometer este error.</p>\n<p>Siempre existe un argumento que quiz√°s el modo <em>producci√≥n</em> necesita ser el valor por defecto y el modo de desarrollo opcional. Personalmente no me convence este argumento. Las personas que se benefician m√°s de las advertencias en el modo de desarrollo generalmente son nuevos en la librer√≠a. <em>No sabr√≠an c√≥mo activarlo,</em> y evitar√≠an encontrar muchos bugs que con las advertencias se hacen evidentes.</p>\n<p>Si, los problemas de rendimiento son malos, pero tambi√©n es enviar experiencias rotas y llenas de bugs a los usuarios finales. Por ejemplo, el <a href=\"https://es.reactjs.org/docs/lists-and-keys.html#keys\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">warning de <em>key</em> de React</a> ayuda a prevenir bugs como enviar un mensaje a la persona equivocada o comprar el producto err√≥neo. Desarrollar con esta advertencia desactivada es un riesgo significativo para ti <em>y</em> tus usuarios. Si est√° desactivada por defecto, entonces para el momento que encuentres la opci√≥n para activarlo, tendr√°s demasiadas advertencias para limpiar. As√≠ que muchas personas lo volver√≠an a apagar. Este es el motivo por el que necesita estar activado desde el comienzo en lugar de activado luego.</p>\n<p>Finalmente, incluso si las advertencias de desarrollo son opcionales y los desarrolladores <em>supieran</em> que deben activarlas en una etapa temprana del desarrollo, simplemente volver√≠amos al mismo problema. ¬°Alguien accidentalmente las dejar√≠a activadas en producci√≥n!</p>\n<p>Y volvimos al primer casillero.</p>\n<p>Personalmente creo en <strong>herramientas que muestran y usan el modo correcto dependiendo si est√°s depurando o desplegando</strong>. Casi cualquier entorno (sea m√≥vil, escritorio o servidor) excepto el navegador ha tenido una forma de cargar y diferenciar builds de desarrollo y producci√≥n por d√©cadas.</p>\n<p>En lugar de dejar a las librer√≠as inventar y nosotros depender de convenciones ad-hoc, quiz√°s es momento que los entornos de JavaScript vean la distinci√≥n como una necesidad de primera clase.</p>\n<hr>\n<p>¬°Suficiente filosof√≠a!</p>\n<p>Miremos de nuevo a este c√≥digo:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">hacerAlgoEnDesarrollo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">hacerAlgoEnProd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Quiz√°s te preguntes: si no hay ning√∫n objeto <code class=\"language-text\">process</code> en el c√≥digo de front-end, ¬øpor qu√© las librer√≠as como React y Vue dependen de ella en los builds de npm?</p>\n<p><em>(Para aclarar esto nuevamente; las etiquetas <code class=\"language-text\">&lt;script&gt;</code> que puedes cargar en el navegador, ofrecidas tanto por React y por Vue, no dependen de esto. En su lugar, tu tienes que manualmente elegir entre los archivos de desarrollo <code class=\"language-text\">.js</code> y de producci√≥n <code class=\"language-text\">.min.js</code>. La secci√≥n debajo es solo acerca de usar React o Vue con un bundler <code class=\"language-text\">import</code>√°ndolos desde npm.)</em></p>\n<p>Como muchas cosas en programaci√≥n, esta convenci√≥n en particular tiene mayormente motivos hist√≥ricos. A√∫n estamos us√°ndola porque ahora es ampliamente adoptada por diferentes herramientas. Cambiar a algo diferente es costoso y no aporta mucho.</p>\n<p>Entonces ¬øcu√°l es la historia detr√°s?</p>\n<p>Muchos a√±os antes de estandarizar la sintaxis de <code class=\"language-text\">import</code> y <code class=\"language-text\">export</code>, hab√≠a muchas formas diferentes de expresar relaciones entre m√≥dulos. Node.js populariz√≥ <code class=\"language-text\">require()</code> y <code class=\"language-text\">module.exports</code>, conocidos como <a href=\"https://en.wikipedia.org/wiki/CommonJS\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">CommonJS</a>.</p>\n<p>El c√≥digo publicado en los comienzos del registro de npm era escrito para Node.js. Express era (¬øy quiz√°s a√∫n lo sea?) el framework para servidores Node.js y <a href=\"https://expressjs.com/en/advanced/best-practice-performance.html#set-node_env-to-production\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">usaba la variable de entorno <code class=\"language-text\">NODE_ENV</code></a> para activar el modo de producci√≥n. Algunos otros paquetes de npm adoptaron la misma convenci√≥n.</p>\n<p>Los primeros <em>bundlers</em> de JavaScript como browserify quer√≠an hacer posible usar el c√≥digo de npm en proyectos de front-end. (S√≠, en <a href=\"https://blog.npmjs.org/post/101775448305/npm-and-front-end-packaging\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ese entonces</a> ¬°casi nadie usaba npm para front-end! ¬øte imaginas?) As√≠ que extendieron la misma convenci√≥n ya presente en el ecosistema de Node.js a c√≥digo de front-end.</p>\n<p>La transformada original ‚Äúenvify‚Äù fue <a href=\"https://github.com/hughsk/envify/commit/ae8aa26b759cd2115eccbed96f70e7bbdceded97\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">lanzada en 2013</a>. React fue hecho open source por ese entonces y npm con browserify parec√≠a la mejor soluci√≥n para compilar c√≥digo CommonJS de front-end.</p>\n<p>React comenz√≥ a proveer builds npm (adicionalmente a builds para etiquetas <code class=\"language-text\">&lt;script&gt;</code>) desde el comienzo. Cuando React se hizo popular, tambi√©n lo hicieron las buenas pr√°cticas para escribir JavaScript modular con CommonJS y entregar c√≥digo de front-end v√≠a npm.</p>\n<p>React necesitaba quitar c√≥digo que era s√≥lo para desarrollo en el modo de producci√≥n. Browserify ya ofrec√≠a una soluci√≥n a este problema, as√≠ que React adopt√≥ la convenci√≥n de usar <code class=\"language-text\">process.env.NODE_ENV</code> para sus builds npm. Con el tiempo, muchas otras herramientas y librer√≠as, incluyendo webpack y Vue, hicieron lo mismo.</p>\n<p>Por el 2019, browserify ha perdido bastante popularidad. Sin embargo, reemplazar <code class=\"language-text\">process.env.NODE_ENV</code> con <code class=\"language-text\">development</code> o <code class=\"language-text\">production</code> en el paso de compilaci√≥n es una convenci√≥n a√∫n popular.</p>\n<p><em>(Ser√≠a interesante ver c√≥mo la adaptaci√≥n de m√≥dulos ES como formato de distribuci√≥n, en lugar de s√≥lo como formato de autor√≠a, cambia la ecuaci√≥n. ¬øCu√©ntamelo en Twitter?)</em></p>\n<hr>\n<p>Una cosa que a√∫n podr√≠a confundirte es que en el c√≥digo fuente de React en GitHub ver√°s que <code class=\"language-text\">__DEV__</code>es usada como variable m√°gica. Pero en el c√≥digo de React en npm, usa <code class=\"language-text\">process.env.NODE_ENV</code>. ¬øC√≥mo funciona eso?</p>\n<p>Hist√≥ricamente usamos <code class=\"language-text\">__DEV__</code> en el c√≥digo fuente para que coincida con el c√≥digo de Facebook. Por un largo tiempo, React era copiado directamente en la base de c√≥digo de Facebook por lo que deb√≠a seguir las mismas reglas. Para npm, ten√≠amos un paso de compilaci√≥n que literalmente reemplazaba las verificaciones de <code class=\"language-text\">__DEV__</code> con <code class=\"language-text\">process.env.NODE_ENV !== &#39;production&#39;</code> justo antes de publicar.</p>\n<p>Esto era a veces un problema. A veces, un patr√≥n de c√≥digo que depend√≠a de alguna convenci√≥n de Node.js funcionaba bien en npm pero romp√≠a Facebook, o viceversa.</p>\n<p>Desde React 16 cambiamos este enfoque. En su lugar, ahora <a href=\"https://reactjs.org/blog/2017/12/15/improving-the-repository-infrastructure.html#compiling-flat-bundles\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">compilamos un bundle</a> para cada entorno (incluyendo las etiquetas<code class=\"language-text\">&lt;script&gt;</code>, npm y el c√≥digo interno de Facebook). As√≠ que incluso c√≥digo en CommonJS para npm es compilado para separar bundles de desarrollo y de producci√≥n antes de tiempo.</p>\n<p>Esto significa que mientras el c√≥digo fuente de React dice <code class=\"language-text\">if (__DEV__)</code>, en realidad producimos dos bundles para cada paquete. Uno ya precompilado con <code class=\"language-text\">__DEV__ = true</code> y otro precompilado con <code class=\"language-text\">__DEV__ = false</code>. El punto de entrada para cada paquete en npm ‚Äúdecide‚Äù cu√°l exportar.</p>\n<p><a href=\"https://unpkg.com/browse/react@16.8.6/index.js\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Por ejemplo:</a></p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">===</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./cjs/react.production.min.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./cjs/react.development.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Y ese es el √∫nico lugar donde tu <em>bundler</em> interpolar√° <code class=\"language-text\">&#39;development&#39;</code> o <code class=\"language-text\">&#39;production&#39;</code> como un string, y donde tu minificador se deshacer√° de ese <code class=\"language-text\">require</code> s√≥lo para desarrollo.</p>\n<p>Tanto <code class=\"language-text\">react.production.min.js</code> como <code class=\"language-text\">react.development.js</code> ya no tienen verificaciones con <code class=\"language-text\">process.env.NODE_ENV</code>. Esto es muy bueno porque <em>cuando de hecho corremos en Node.js</em>, acceder a <code class=\"language-text\">process.env</code> es un <a href=\"https://reactjs.org/blog/2017/09/26/react-v16.0.html#better-server-side-rendering\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">poco lento</a>. Compilar los bundles en ambas formas antes de tiempo tambi√©n nos deja optimizar el tama√±o de archivo de forma <a href=\"https://reactjs.org/blog/2017/09/26/react-v16.0.html#reduced-file-size\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">mucho m√°s consistente</a>, independientemente de qu√© <em>bundler</em> o <em>minificador</em> uses.</p>\n<p>¬°Y as√≠ es como realmente funciona!</p>\n<hr>\n<p>Desear√≠a que existiera una forma m√°s <em>primera clase</em> de hacerlo sin dependender de convenciones, pero aqu√≠ estamos. Ser√≠a genial si los modos fueran un concepto de primera clase en todos los entornos de JavaScript y que hubiera una forma de que un navegador identifique que alg√∫n c√≥digo est√° en modo desarrollo cuando no debe.</p>\n<p>Por otro lado, es fascinante ver c√≥mo una convenci√≥n en un √∫nico proyecto puede propagarse en todo el ecosistema. <code class=\"language-text\">EXPRESS_ENV</code> <a href=\"https://github.com/expressjs/express/commit/03b56d8140dc5c2b574d410bfeb63517a0430451\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">se convirti√≥ en <code class=\"language-text\">NODE_ENV</code></a> en 2010 y <a href=\"https://github.com/hughsk/envify/commit/ae8aa26b759cd2115eccbed96f70e7bbdceded97\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">se propag√≥ al front-end</a> en 2013. Quiz√°s la soluci√≥n no es perfecta, pero para cada proyecto el costo de adoptarla era m√°s bajo que el costo de convencer a todos los dem√°s que adopten algo diferente. Esto nos ense√±a una valiosa lecci√≥n sobre la adopci√≥n de <a href=\"https://es.wikipedia.org/wiki/Top-down_y_bottom-up\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><em>top-down</em> versus <em>bottom-up</em></a>. Entender c√≥mo esta din√°mica funciona distingue entre intentos de estandarizaci√≥n exitosos y fracasos.</p>\n<p>Separar los modos de desarrollo y producci√≥n es una t√©cnica muy √∫til. Recomiendo que la uses en tus librer√≠as y en el c√≥digo de aplicaci√≥n para los tipos de chequeos que son demasiado costosos hacer en producci√≥n, pero son valiosos (¬°y generalmente cr√≠ticos!) de hacer en desarrollo.</p>\n<p>Como cualquier caracter√≠stica poderosa, hay formas en que puede utilizarse mal. ¬°Este ser√° el tema de mi pr√≥ximo art√≠culo!</p>","timeToRead":11,"frontmatter":{"title":"¬øC√≥mo funciona el modo de desarrollo?","date":"August 04, 2019","spoiler":"Eliminaci√≥n de c√≥digo muerto por convenci√≥n.","cta":null},"fields":{"slug":"/es/how-does-the-development-mode-work/","langKey":"es"}}},"pageContext":{"slug":"/es/how-does-the-development-mode-work/","translations":["zh-hans","es","pt-br","ko"],"translatedLinks":[]}}}