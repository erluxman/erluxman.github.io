{"componentChunkName":"component---src-templates-blog-post-js","path":"/pt-br/react-as-a-ui-runtime/","result":{"data":{"site":{"siteMetadata":{"title":"Overreacted","author":"Dan Abramov"}},"markdownRemark":{"id":"cac2f8a4-63ad-5508-a5e3-d0dcc3bf0b38","html":"<p>Muitos tutoriais introduzem React como uma biblioteca para criação de Interface com o Usuário (<em>UI</em> em inglês). Isso faz sentido porque React <em>é</em> uma biblioteca de UI. É, literalmente, o que diz o slogan!</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0429fcb4a2f2022852afc698ff8968f1/0b533/react.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 500px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 29.054054054054056%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABEElEQVQY011Qy07DMBD0v1CniRM7dt4Pp01VWgmQOKEeekKCA0hIFUcOSIgfH9amDaWH0c4+ZrxeFiY5zjGPswlBqMCvIvCZ8Ajm8t/MpcZxdmkYyoKECubmAcv3b1S7J8Iz6v0L8vs95pH2c9I0MKWFLnqorJ2MWSBoE2H+QEVOm8jxDv3rB+zbJ4bDF5rHA8ztDjxMEcnSmzitM4nTyhsnugaTpoai19K8hc47z11T0pAQGkrliGMDlZKJrrw4qyxh8BqHhOpClcQ7MFP2aPoV+sV6QjesMYwb1N2IjnLXt8trLFZbtNbxDey49bmrO41QhT8DO32V0218PPIpP4v8OOu2dBvN6Ps8+u2dbvoDB8/AqO9EOdcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Captura de tela da home do React: \"A JavaScript library for building user interfaces\"\"\n        title=\"\"\n        src=\"/static/0429fcb4a2f2022852afc698ff8968f1/0b533/react.png\"\n        srcset=\"/static/0429fcb4a2f2022852afc698ff8968f1/12f09/react.png 148w,\n/static/0429fcb4a2f2022852afc698ff8968f1/e4a3f/react.png 295w,\n/static/0429fcb4a2f2022852afc698ff8968f1/0b533/react.png 500w\"\n        sizes=\"(max-width: 500px) 100vw, 500px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>Já escrevi sobre os desafios de se criar <a href=\"/the-elements-of-ui-engineering/\">interfaces de usuário</a>. Porém, esse post é sobre React de uma maneira diferente - mais como <a href=\"https://en.wikipedia.org/wiki/Runtime_system\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">programar um ambiente de execução</a>.</p>\n<p><strong>Esse post não vai te ensinar nada sobre a criação de interfaces com o usuário.</strong> Entretando, ele pode te ajudar a entender o modelo de programação do React com mais profundidade.</p>\n<hr>\n<p>**Nota: Se você está <em>aprendendo</em> React, leia a <a href=\"https://reactjs.org/docs/getting-started.html#learn-react\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">documentação</a> em vez desse post.</p>\n<p><font size=\"60\">⚠️</font></p>\n<p><strong>Esse é um aprofundamento - ESSE NÃO É um post amigável para iniciantes.</strong> Nesse post, descrevo a maior parte do modelo de programação do React a partir dos seus princípios. Não explico como utilizá-lo - apenas como funciona.</p>\n<p>É voltado aos programadores experientes e ao pessoal que trabalha com outras bibliotecas de UI e me perguntaram sobre o custo-benefício de algumas escolhas no React. Espero que você ache-o útil!</p>\n<p><strong>Muitas pessoas tem sucesso usando React por anos sem pensar na maioria desses tópicos.</strong> Isso é, definitivamente, uma visão de programador sobre React em vez de uma <a href=\"http://mrmrs.cc/writing/developing-ui/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">visão de designer</a>. Mas não acho prejudicial ter material para as duas.</p>\n<p>With that disclaimer out of the way, let’s go!</p>\n<p>Com esse aviso dado, vamos lá!</p>\n<hr>\n<h2 id=\"árvore-do-host\"><a href=\"#%C3%A1rvore-do-host\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Árvore do Host</h2>\n<p>Some programs output numbers. Other programs output poems. Different languages and their runtimes are often optimized for a particular set of use cases, and React is no exception to that.</p>\n<p>Alguns programas geram números. Outros programas geram poemas. Diferentes linguagens e seus ambientes de execução são frequentemente otimizados para um conjunto particular de casos de uso, e o React não é uma exceção a isso.</p>\n<p>Programas em React geralmente produzem <strong>uma árvore que pode mudar com o passar do tempo</strong>. Pode ser uma <a href=\"https://www.npmjs.com/package/react-dom\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">árvore DOM</a>, uma <a href=\"https://developer.apple.com/library/archive/documentation/General/Conceptual/Devpedia-CocoaApp/View%20Hierarchy.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">hierarquia iOS</a>, uma árvore de <a href=\"https://react-pdf.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">primitivas de PDF</a>, ou mesmo <a href=\"https://reactjs.org/docs/test-renderer.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">objetos JSON</a>. Entretanto, normalmente, nós desejamos representar uma UI com isso. Nós chamamos de “árvore do <em>host</em>” porque ela é parte do <em>ambiente que hospeda</em> fora do React - como o DOM ou o iOS. A árvore do host geralmente possui <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Node/appendChild\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">sua</a> <a href=\"https://developer.apple.com/documentation/uikit/uiview/1622616-addsubview\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">própria</a> API imperativa. React é uma camada sobre ela.</p>\n<p>Então para que o React é útil? De maneira bem abstrata, ele te ajuda a escrever programas que manipulam uma árvore do host complexa de maneira previsível em resposta a eventos externos como interações, respostas de rede, temporizadores e por aí vai.</p>\n<p>Uma ferramenta especializada funciona melhor do que uma genérica quando ela pode impor algumas coisas e se beneficiar dessas limitações. O React aposta em dois princípios:</p>\n<ul>\n<li><strong>Estabilidade.</strong> A árvore do host é relativamente estável e muitas atualizações não alteram radicalmente sua estrutura geral. Se uma aplicação rearranjasse todos os seus elementos interativos em uma combinação diferente a cada segundo, ela seria bem difícil de usar. Para onde foi aquele botão? Por que minha tela está dançando?</li>\n<li><strong>Regularidade.</strong> A árvore do host pode ser quebrada em diferentes padrões de UI que se comportam de maneira consistente (como botões, listas, avatares) em vez de formas aleatórias.</li>\n</ul>\n<p><strong>Acontece que esses princípios são verdadeiros para a maioria das UIs.</strong> Contudo, React não é apropriado quando não existem “padrões” estáveis na saída do programa. Por exemplo, React pode te ajudar a escrever um cliente para o Twitter, mas não será muito útil para um <a href=\"https://www.youtube.com/watch?v=Uzx9ArZ7MUU\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">protetor de tela de pipas 3D</a>.</p>\n<h2 id=\"instâncias-do-host\"><a href=\"#inst%C3%A2ncias-do-host\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Instâncias do Host</h2>\n<p>A árvore do host consiste em nós. Vamos chamá-los de “instâncias do host”.</p>\n<p>No ambiente do DOM, as instâncias do host são nós DOM comuns - como os objetos que você recebe quando chama <code class=\"language-text\">document.createElement(&#39;div&#39;)</code>. No iOS, as instâncias do host podem ser valores que identificam unicamente uma visão nativa do JavaScript.</p>\n<p>Instâncias do host tem suas propriedades (ex: <code class=\"language-text\">domNode.className</code> ou <code class=\"language-text\">view.tintColor</code>). Elas também podem conter outras instâncias como filhas.</p>\n<p>Isso não tem nada a ver com React - Estou descrevendo os ambientes dos hosts.</p>\n<p>Geralmente, existe uma API para manipular instâncias do host. Por exemplo, o DOM provê APIs como <code class=\"language-text\">appendChild</code>, <code class=\"language-text\">removeChild</code>, <code class=\"language-text\">setAttribute</code> e por aí vai. Em aplicações React, geralmente não se chama essas APIs. Esse é o trabalho do React.</p>\n<h2 id=\"renderizadores\"><a href=\"#renderizadores\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Renderizadores</h2>\n<p>Um <em>renderizador</em> ensina o React a conversar com um ambiente host específico e a gerencias suas instâncias. React DOM, React Native e mesmo <a href=\"https://mobile.twitter.com/vadimdemedes/status/1089344289102942211\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Ink</a> são renderizadores React. Você também pode <a href=\"https://github.com/facebook/react/tree/master/packages/react-reconciler\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">criar seu próprio renderizador React</a>.</p>\n<p>Renderizadores React podem funcionar de duas maneiras diferentes.</p>\n<p>A grande maioria dos renderizadores são escritos para usar o modo “mutação”. Esse modo é como o DOM funciona: nós podemos criar um nó, determinar suas propriedades e, depois, adicionar ou remover seus filhos. As instâncias do host são completamente mutáveis.</p>\n<p>O React também pode funcionar em um modo <a href=\"https://en.wikipedia.org/wiki/Persistent_data_structure\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">“persistente”</a>. Esse modo é para ambientes host que não proveem métodos como <code class=\"language-text\">appendChild()</code> e, em vez disso, clonam a árvore pai e sempre substituem as filhas mais acima. Imutabilidade no nível da árvore torna a <em>multi-threading</em> mais fácil.</p>\n<p>Como um usuário do React, você nunca precisou pensar sobre esses modos. Apenas quero ressaltar que o React não é apenas um adaptador de um modo para o outro. Sua utilidade é ortogonal ao paradigma de baixo nível da API visual utilizada.</p>\n<h2 id=\"elementos-react\"><a href=\"#elementos-react\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Elementos React</h2>\n<p>No ambiente do host, uma instância (como um nó DOM) é o menor bloco. No React, o menor bloco é um <em>elemento React</em>.</p>\n<p>Um elemento React é um objeto JavaScript simples. Ele pode <em>descrever</em> uma instância do host.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// JSX é um açúcar sintático para esses objetos.</span>\n<span class=\"token comment\">// &lt;button className=\"blue\" /></span>\n<span class=\"token punctuation\">{</span>\n  type<span class=\"token operator\">:</span> <span class=\"token string\">'button'</span><span class=\"token punctuation\">,</span>\n  props<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> className<span class=\"token operator\">:</span> <span class=\"token string\">'blue'</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Um elemento React é leve e não possui instâncias do host atreladas a ele. Novamente, isso é apenas uma <em>descrição</em> do que você deseja ver na tela.</p>\n<p>Assim como as instâncias do host, elementos React podem formar uma árvore:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// JSX é um açúcar sintático para esses objetos.</span>\n<span class=\"token comment\">// &lt;dialog></span>\n<span class=\"token comment\">//   &lt;button className=\"blue\" /></span>\n<span class=\"token comment\">//   &lt;button className=\"red\" /></span>\n<span class=\"token comment\">// &lt;/dialog></span>\n<span class=\"token punctuation\">{</span>\n  type<span class=\"token operator\">:</span> <span class=\"token string\">'dialog'</span><span class=\"token punctuation\">,</span>\n  props<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    children<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n      type<span class=\"token operator\">:</span> <span class=\"token string\">'button'</span><span class=\"token punctuation\">,</span>\n      props<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> className<span class=\"token operator\">:</span> <span class=\"token string\">'blue'</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      type<span class=\"token operator\">:</span> <span class=\"token string\">'button'</span><span class=\"token punctuation\">,</span>\n      props<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> className<span class=\"token operator\">:</span> <span class=\"token string\">'red'</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><em>(Nota: omiti <a href=\"/why-do-react-elements-have-typeof-property/\">algumas propriedades</a> que não são importantes para essa explicação.)</em></p>\n<p>Entretanto, lembre-se de que <strong>elementos React não tem sua identidade persistida.</strong> Eles são sempre recriados e dispensados.</p>\n<p>Elementos React são imutáveis. Por exemplo, você não pode alterar os filhos ou uma propriedade de um elemento React. Se você deseja renderizar algo diferente depois, você tem de <em>descrevê-lo</em> com uma nova árvore de elementos React criadas do zero.</p>\n<p>Gosto de pensar em elementos React como sendo quadros de um filme. Eles capturam como a UI deveria parecer em algum ponto específico do tempo. Eles não se alteram.</p>\n<h2 id=\"ponto-de-entrada\"><a href=\"#ponto-de-entrada\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Ponto de entrada</h2>\n<p>Cada elemento React tem seu “ponto de entrada”. A API é o que nos permite indicar ao React que renderize uma árvore particular de elementos React dentro de um <em>container</em> de instâncias do host.</p>\n<p>Por exemplo, o ponto de entrada do React DOM é <code class=\"language-text\">ReactDOM.render</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">ReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>\n  <span class=\"token comment\">// { type: 'button', props: { className: 'blue' } }</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>blue<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">,</span>\n  document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'container'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Quando dizemos <code class=\"language-text\">ReactDOM.render(reactElement, domContainer)</code>, nós queremos dizer: <strong>“Querido React, faça a árvore do host <code class=\"language-text\">domContainer</code> ser equivalente ao meu <code class=\"language-text\">reactElement</code>.”</strong></p>\n<p>O React olhará para o <code class=\"language-text\">reactElement.type</code> (<code class=\"language-text\">&#39;button&#39;</code>, no nosso exemplo) e pedirá ao renderizador React DOM para criar uma instância do host para ele e determinar as propriedades:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// Em algum lugar do renderizador ReactDOM (simplificado)</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">createHostInstance</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">reactElement</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">let</span> domNode <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span>reactElement<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">  domNode<span class=\"token punctuation\">.</span>className <span class=\"token operator\">=</span> reactElement<span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>className<span class=\"token punctuation\">;</span></span>  <span class=\"token keyword\">return</span> domNode<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>No nosso exemplo, o React vai, efetivamente, fazer isso:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">let</span> domNode <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'button'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">domNode<span class=\"token punctuation\">.</span>className <span class=\"token operator\">=</span> <span class=\"token string\">'blue'</span><span class=\"token punctuation\">;</span></span>\ndomContainer<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>domNode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Se o elemento React tem elementos filhos em <code class=\"language-text\">reactElement.props.children</code>, o React também vai criar instâncias do host recursivamente para eles na primeira renderização.</p>\n<h2 id=\"reconciliação\"><a href=\"#reconcilia%C3%A7%C3%A3o\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reconciliação</h2>\n<p>O que acontece se chamarmos <code class=\"language-text\">ReactDOM.render()</code> duas vezes no mesmo <em>container</em>?</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">ReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>blue<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">,</span></span>  document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'container'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// ... depois ...</span>\n\n<span class=\"token comment\">// Isso deve *substituir* a instância do botão</span>\n<span class=\"token comment\">// ou apenas atualizar uma propriedade numa já existente?</span>\nReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>red<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">,</span></span>  document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'container'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Novamente, o trabalho do React é <em>fazer com que a árvore do host seja equivalente àquela provida pela àrvore de elementos do React</em>. O processo de entender <em>o que</em> fazer com a árvore da instância em resposta à nova informação é chamada, algumas vezes, de <a href=\"https://reactjs.org/docs/reconcilia%C3%A7%C3%A3o.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">reconciliação</a>.</p>\n<p>Existem duas maneiras de fazer isso. A maneira simplificada do React poderia remover toda a árvore existente e recriar uma do zero:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">let</span> domContainer <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'container'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Limpa a árvore</span>\ndomContainer<span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">=</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Cria uma nova árvore de instâncias</span>\n<span class=\"token keyword\">let</span> domNode <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'button'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ndomNode<span class=\"token punctuation\">.</span>className <span class=\"token operator\">=</span> <span class=\"token string\">'red'</span><span class=\"token punctuation\">;</span>\ndomContainer<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>domNode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Porém, no DOM, essa maneira é lenta e perde informações importantes como foco, seleção, estado de <em>scroll</em> e por aí vai. Em vez disso, nós queremos que o React faça algo parecido com isso:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">let</span> domNode <span class=\"token operator\">=</span> domContainer<span class=\"token punctuation\">.</span>firstChild<span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Atualiza a instância existente</span>\ndomNode<span class=\"token punctuation\">.</span>className <span class=\"token operator\">=</span> <span class=\"token string\">'red'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Em outras palavras, o React precisa decidir quando <em>atualizar</em> uma instância existente para se igualar a um novo elemento React e quando criar uma <em>nova</em> instância.</p>\n<p>Isso levanta a questão da <em>identidade</em>. Um elemento React pode ser diferente sempre, mas e quando ele se refere, conceitualmente, à mesma instância do host?</p>\n<p>No nosso exemplo, isso é simples. Nós renderizávamos um <code class=\"language-text\">&lt;button&gt;</code> como o primeiro (e único) filho, e nós queríamos renderizar um <code class=\"language-text\">&lt;button&gt;</code> no mesmo lugar novamente. Nós já temos uma instância <code class=\"language-text\">&lt;button&gt;</code> no host, então por que recriá-la? Vamos apenas reusá-la.</p>\n<p>Isso está bem próximo de como o React pensa sobre o problema.</p>\n<p><strong>Se o tipo de um elemento no mesmo lugar da árvore é “igual” na renderização anterior e na próxima, o React reutiliza a instância existente.</strong></p>\n<p>Aqui está um exemplo com comentários mostrando, basicamente, o que o React faz:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// let domNode = document.createElement('button');</span>\n<span class=\"token comment\">// domNode.className = 'blue';</span>\n<span class=\"token comment\">// domContainer.appendChild(domNode);</span>\nReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>blue<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">,</span>\n  document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'container'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"gatsby-highlight-code-line\"><span class=\"token comment\">// Pode reusar a instância do host? Sim! (button -> button)</span></span><span class=\"gatsby-highlight-code-line\"><span class=\"token comment\">// domNode.className = 'red';</span></span>ReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>red<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">,</span>\n  document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'container'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"gatsby-highlight-code-line\"><span class=\"token comment\">// Posso reusar a instância? Não! (button -> p)</span></span><span class=\"token comment\">// domContainer.removeChild(domNode);</span>\n<span class=\"token comment\">// domNode = document.createElement('p');</span>\n<span class=\"token comment\">// domNode.textContent = 'Hello';</span>\n<span class=\"token comment\">// domContainer.appendChild(domNode);</span>\nReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Hello</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">,</span>\n  document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'container'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"gatsby-highlight-code-line\"><span class=\"token comment\">// Posso reusar a instância? Sim! (p -> p)</span></span><span class=\"gatsby-highlight-code-line\"><span class=\"token comment\">// domNode.textContent = 'Goodbye';</span></span>ReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Goodbye</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">,</span>\n  document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'container'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>A mesma heurística é utilizada para árvores filhas. Por exemplo, quando nós atualizamos uma <code class=\"language-text\">&lt;dialog&gt;</code> com dois <code class=\"language-text\">&lt;button&gt;</code>s dentro, o React primeiro decide se vai reusar <code class=\"language-text\">&lt;dialog&gt;</code> e, depois, repete esse procedimento de decisão para cada filha.</p>\n<h2 id=\"condições\"><a href=\"#condi%C3%A7%C3%B5es\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Condições</h2>\n<p>Se o React reusar instâncias do host apenas quando os tipos dos elementos se “equivalem” entre atualizações, como podemos renderizar conteúdo condicional?</p>\n<p>Digamos que desejamos, inicialmente, exibir apenas um <em>input</em>, e, em seguida, renderizar uma mensagem antes dele:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// Primeira renderização</span>\nReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dialog</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dialog</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">,</span>\n  domContainer\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Segunda renderização</span>\nReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dialog</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token plain-text\">    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Acabei de ser adicionado aqui!</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span></span><span class=\"token plain-text\">    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dialog</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">,</span>\n  domContainer\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Nesse exemplo, a instância <code class=\"language-text\">&lt;input&gt;</code> do host seria recriada. O React caminharia na árvore de elementos, comparando-os com a versão anterior:</p>\n<ul>\n<li><code class=\"language-text\">dialog -&gt; dialog</code>: Pode reusar a instância? <strong>Sim - o tipo é o mesmo.</strong></li>\n<li><code class=\"language-text\">input -&gt; p</code>: Pode reusar a instância? <strong>Não, o tipo foi alterado!</strong> É necessário remover a instância existente de <code class=\"language-text\">input</code> e criar uma nova instância de <code class=\"language-text\">p</code>.</li>\n<li><code class=\"language-text\">(nothing) -&gt; input</code>: É necessário criar uma nova instância <code class=\"language-text\">input</code> do host.</li>\n</ul>\n<p>Então, efetivamente, o código de atualização executado pelo React seria:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">let</span> oldInputNode <span class=\"token operator\">=</span> dialogNode<span class=\"token punctuation\">.</span>firstChild<span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">dialogNode<span class=\"token punctuation\">.</span><span class=\"token function\">removeChild</span><span class=\"token punctuation\">(</span>oldInputNode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n<span class=\"token keyword\">let</span> pNode <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'p'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\npNode<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> <span class=\"token string\">'Acabei de ser adicionado aqui!'</span><span class=\"token punctuation\">;</span>\ndialogNode<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>pNode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">let</span> newInputNode <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'input'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">dialogNode<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>newInputNode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span></code></pre></div>\n<p>Isso não é bom porque <em>conceitualmente</em> o <code class=\"language-text\">&lt;input&gt;</code> não foi <em>substituído</em> por <code class=\"language-text\">&lt;p&gt;</code> - ele apenas foi movido de lugar. Nós não desejamos perder sua seleção, foco, estado e conteúdo devido à recriação do DOM.</p>\n<p>Enquanto esse problema possui um ajuste fácil (que comentaremos sobre ele em um minuto), isso geralmente não acontece em aplicações React. É interessante ver o porquê.</p>\n<p>Na prática, você raramente chamaria <code class=\"language-text\">ReactDOM.render</code> diretamente. Em vez disso, aplicações React tendem a ser divididas em funções como essa:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Form</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> showMessage <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> message <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>showMessage<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    message <span class=\"token operator\">=</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Acabei de ser adicionado aqui!</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dialog</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token punctuation\">{</span>message<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dialog</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Esse exemplo não sofre do problema que acabamos de descrever. Pode ser mais fácil ver o motivo se utilizarmos a notação de objetos em vez de JSX. Veja a árvore do elemento filho <code class=\"language-text\">dialog</code>:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Form</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> showMessage <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> message <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>showMessage<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    message <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      type<span class=\"token operator\">:</span> <span class=\"token string\">'p'</span><span class=\"token punctuation\">,</span>\n      props<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> children<span class=\"token operator\">:</span> <span class=\"token string\">'Acabei de ser adicionado aqui!'</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    type<span class=\"token operator\">:</span> <span class=\"token string\">'dialog'</span><span class=\"token punctuation\">,</span>\n    props<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">      children<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></span><span class=\"gatsby-highlight-code-line\">        message<span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token punctuation\">{</span> type<span class=\"token operator\">:</span> <span class=\"token string\">'input'</span><span class=\"token punctuation\">,</span> props<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token punctuation\">]</span></span>    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>Independentemente de <code class=\"language-text\">showMessage</code> ser <code class=\"language-text\">true</code> ou <code class=\"language-text\">false</code>, o <code class=\"language-text\">&lt;input&gt;</code> é o segundo filho e sua posição na árvore não é alterada entre as renderizações.</strong></p>\n<p>Se <code class=\"language-text\">showMessage</code> for alterado de <code class=\"language-text\">false</code> para <code class=\"language-text\">true</code>, o React caminharia a árvore de elementos, comparando-a com a versão anterior:</p>\n<ul>\n<li>\n<p><code class=\"language-text\">dialog -&gt; dialog</code>: Pode reusar a instância? <strong>Sim - o tipo é o mesmo.</strong></p>\n<ul>\n<li><code class=\"language-text\">null -&gt; p</code>: É necessário inserir uma nova instância <code class=\"language-text\">p</code>.</li>\n<li><code class=\"language-text\">input -&gt; input</code>: Pode reusar a instância? <strong>Sim - o tipo é o mesmo.</strong></li>\n</ul>\n</li>\n</ul>\n<p>E o código executado pelo React seria similar a esse:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">let</span> inputNode <span class=\"token operator\">=</span> dialogNode<span class=\"token punctuation\">.</span>firstChild<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> pNode <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'p'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\npNode<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> <span class=\"token string\">'Acabei de ser adicionado aqui!'</span><span class=\"token punctuation\">;</span>\ndialogNode<span class=\"token punctuation\">.</span><span class=\"token function\">insertBefore</span><span class=\"token punctuation\">(</span>pNode<span class=\"token punctuation\">,</span> inputNode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Nenhum estado do <em>input</em> é perdido agora.</p>\n<h2 id=\"listas\"><a href=\"#listas\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Listas</h2>\n<p>Geralmente, comparar o tipo do elemento na árvore na mesma posição é suficiente para decidir entre reusar ou recriar uma instância correspondente.</p>\n<p>Mas isso só funciona bem se as posições dos filhos são estáticas e não reordenam. No nosso exemplo acima, mesmo que <code class=\"language-text\">message</code> pudesse ser um “buraco”, nós ainda saberíamos que o <em>input</em> vai depois de <em>message</em>, e não existem outras filhas.</p>\n<p>Com listas dinâmicas, não podemos ter certeza se a ordem é sempre a mesma:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">ShoppingList</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> list <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token punctuation\">{</span>list<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n          Você comprou </span><span class=\"token punctuation\">{</span>item<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n          Insira quantos você deseja: </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Se a <code class=\"language-text\">list</code> dos nossos itens de compra é sempre reordenada, o React verá que todos os elementos filhos <code class=\"language-text\">p</code> e <code class=\"language-text\">input</code> têm o mesmo tipo e não saberá como movê-los. (Da perspectiva do React, os <em>próprios itens</em> foram alterados, e não sua ordem.)</p>\n<p>O código executado pelo React para reordenar os 10 itens seria algo assim:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> pNode <span class=\"token operator\">=</span> formNode<span class=\"token punctuation\">.</span>childNodes<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> textNode <span class=\"token operator\">=</span> pNode<span class=\"token punctuation\">.</span>firstChild<span class=\"token punctuation\">;</span>\n  textNode<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> <span class=\"token string\">'Você comprou '</span> <span class=\"token operator\">+</span> items<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Então, em vez de <em>reordená-los</em>, o React iria, efetivamente, <em>atualizar</em> cada item. Isso poderia criar problemas de desempenho e, possivelmente, bugs. Por exemplo, o conteúdo do primeiro <em>input</em> seria refletido no primeiro <em>input</em> <em>depois</em> da ordenação - mesmo que, conceitualmente, eles se refiram a produtos diferentes da sua lista de compras!</p>\n<p><strong>É por isso que o React te incomoda para especificar a propriedade especial chamada <code class=\"language-text\">key</code> sempre que você inclui um vetor de elementos na sua saída:</strong></p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">ShoppingList</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> list <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">      </span><span class=\"token punctuation\">{</span>list<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n<span class=\"gatsby-highlight-code-line\">        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span> <span class=\"token attr-name\">key</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>item<span class=\"token punctuation\">.</span>productId<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span></span><span class=\"token plain-text\">          Você comprou </span><span class=\"token punctuation\">{</span>item<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">}</span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">          Insira quantos você deseja: </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Uma <code class=\"language-text\">key</code> indica ao React que ele deve considerar um item como sendo <em>conceitualmente</em> o idêntico mesmo que ele tenha <em>posições</em> diferentes dentro do seu pai entre as renderizações.</p>\n<p>Quando o React vê <code class=\"language-text\">&lt;p key=&quot;42&quot;&gt;</code> dentro de um <code class=\"language-text\">&lt;form&gt;</code>, ele vai conferir se a renderização anterior também continha <code class=\"language-text\">&lt;p key=&quot;42&quot;&gt;</code> dentro do mesmo <code class=\"language-text\">&lt;form&gt;</code>. Isso funciona mesmo se os filhos de <code class=\"language-text\">&lt;form&gt;</code> tiverem sua ordem alterada. O React reutilizará as instâncias anteriores com a mesma <em>key</em> se ela existir, e reordenar os filhos de acordo com isso.</p>\n<p>Note que a <code class=\"language-text\">key</code> é relevante apenas dentro de um pai particular de um elemento React como um <code class=\"language-text\">&lt;form&gt;</code>. O React não vai tentar “igualar” elementos com a mesma chave entre pais diferentes. (O React não tem suporte idiomático para mover uma instância de um host entre diferentes pais sem recriá-las.)</p>\n<p>E qual é um bom valor para <code class=\"language-text\">key</code>? Uma maneira fácil de responder a isso é perguntando: <strong>quando <em>você</em> diria que um item é “igual” mesmo que a ordem seja alterada?</strong> Por exemplo, na nossa lista de compras, o ID do produto é seu identificador único entre os irmãos.</p>\n<h2 id=\"componentes\"><a href=\"#componentes\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Componentes</h2>\n<p>Já vimos funções que retornam elementos React:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Form</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> showMessage <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> message <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>showMessage<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    message <span class=\"token operator\">=</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Acabei de ser adicionado aqui!</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dialog</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token punctuation\">{</span>message<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dialog</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Elas são chamadas <em>componentes</em>. Vamos criar nossa própria “caixa de ferramentas” de botões, avatares, comentários e por aí vai. Componentes são o pão e a manteiga do React.</p>\n<p>Componentes recebem um único argumento - um objeto <em>hash</em>. Ele contém “props” (abreviação de “propriedades”). Aqui, <code class=\"language-text\">showMessage</code> é uma prop. Elas são como argumentos nomeados.</p>\n<h2 id=\"pureza\"><a href=\"#pureza\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Pureza</h2>\n<p>Assume-se que componentes React são puros em relação às suas props.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Button</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 🔴 Não funciona</span>\n  props<span class=\"token punctuation\">.</span>isActive <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>No geral, mutações não são idiomáticas no React. (Discutiremos mais sobre a maneira idiomática de atualizar a UI em resposta a eventos mais tarde.)</p>\n<p>Entretanto, <em>mutações locais</em> são perfeitamente aceitáveis:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">FriendList</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> friends <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">let</span> items <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></span>  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> friends<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> friend <span class=\"token operator\">=</span> friends<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">    items<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span></span>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Friend</span></span> <span class=\"token attr-name\">key</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>friend<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">friend</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>friend<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>section</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span>items<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>section</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Criamos <code class=\"language-text\">items</code> <em>enquanto renderizamos</em> e nenhum outro componente o “viu”, então podemos modificá-los o tanto quanto quisermos antes de passá-los adiante como parte do resultado da renderização. Não é necessário contorcer seu código para evitar mutações locais.</p>\n<p>De forma semelhante, iniciações preguiçosas são aceitáveis apesar de não serem completamente “puras”:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">ExpenseForm</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Ok se ela não afeta outros componentes:</span>\n  SuperCalculator<span class=\"token punctuation\">.</span><span class=\"token function\">initializeIfNotReady</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Continue a renderização...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Enquanto chamar um componente múltiplas vezes é seguro e não afeta a renderização de outros componentes, o React não se importa se é 100% puro no sentido da Programação Funcional (FP em inglês). <a href=\"https://stackoverflow.com/questions/1077412/what-is-an-idempotent-operation\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Idempotência</a> é mais importante para o React do que a pureza.</p>\n<p>Dito isso, efeitos colaterais que são diretamente visíveis para o usuário não são permitidos em componentes React. Em outras palavras, simplesmente <em>chamar</em> um componente não deveria, por si só, produzir uma mudança na tela.</p>\n<h2 id=\"recursão\"><a href=\"#recurs%C3%A3o\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recursão</h2>\n<p>Como <em>usamos</em> componentes em outros componentes? Componentes são funções então <em>poderíamos</em> chamá-los:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">let</span> reactElement <span class=\"token operator\">=</span> <span class=\"token function\">Form</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> showMessage<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>reactElement<span class=\"token punctuation\">,</span> domContainer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Contudo, essa <em>não é</em> a maneira idiomática de se usar componentes no ambiente de execução React.</p>\n<p>Em vez disso, a maneira idiomática de se usar um componente é com o mesmo mecanismo que já vimos aqui antes - elementos React. <strong>Isso significa que você não deve chamar diretamente a função do componente, mas deixar que o React faça isso por você</strong>:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// { type: Form, props: { showMessage: true } }</span>\n<span class=\"token keyword\">let</span> reactElement <span class=\"token operator\">=</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Form</span></span> <span class=\"token attr-name\">showMessage</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">;</span>\nReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>reactElement<span class=\"token punctuation\">,</span> domContainer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>E, em algum lugar dentro do React, seu componente será chamado:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// Em algum lugar dentro do React</span>\n<span class=\"token keyword\">let</span> type <span class=\"token operator\">=</span> reactElement<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">;</span> <span class=\"token comment\">// Form</span>\n<span class=\"token keyword\">let</span> props <span class=\"token operator\">=</span> reactElement<span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">;</span> <span class=\"token comment\">// { showMessage: true }</span>\n<span class=\"token keyword\">let</span> result <span class=\"token operator\">=</span> <span class=\"token function\">type</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// O que quer que Form retorne</span></code></pre></div>\n<p>Os nomes dos componentes são, por convenção, escritos com letra maiúscula. Quando a transformação do JSX vê <code class=\"language-text\">&lt;Form&gt;</code> em vez de <code class=\"language-text\">&lt;form&gt;</code>, ela cria o objeto <code class=\"language-text\">type</code> como um identificador em vez de uma string:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// string 'form'</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Form</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// função Form</span></code></pre></div>\n<p>Não existe um mecanismo registrador global - literalmente nos referimos ao nome <code class=\"language-text\">Form</code> quando digitamos <code class=\"language-text\">&lt;Form /&gt;</code>. Se <code class=\"language-text\">Form</code> não existe no escopo local, você verá um erro JavaScript como normalmente veria com nomes de variável.</p>\n<p><strong>Ok, então o que o React faz quando o tipo de um elemento é uma função? Ele chama seu componente e pergunta qual elemento <em>aquele</em> componente quer renderizar.</strong></p>\n<p>Esse processo continua recursivamente e é descrito em mais detalhes <a href=\"https://reactjs.org/blog/2015/12/18/react-components-elements-and-instances.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">aqui</a>. Em resumo, é parecido com isso:</p>\n<ul>\n<li><strong>Você:</strong> <code class=\"language-text\">ReactDOM.render(&lt;App /&gt;, domContainer)</code></li>\n<li>\n<p><strong>React:</strong> Ei, <code class=\"language-text\">App</code>, o que você renderiza?</p>\n<ul>\n<li><code class=\"language-text\">App</code>: Eu renderizo <code class=\"language-text\">&lt;Layout&gt;</code> com <code class=\"language-text\">&lt;Content&gt;</code> dentro.</li>\n</ul>\n</li>\n<li>\n<p><strong>React:</strong> Ei, <code class=\"language-text\">Layout</code>, o que você renderiza?</p>\n<ul>\n<li><code class=\"language-text\">Layout</code>: Eu renderizo meus filhos em uma <code class=\"language-text\">&lt;div&gt;</code>. Meu filho é <code class=\"language-text\">&lt;Content&gt;</code>, então acho que isso vai dentro da <code class=\"language-text\">&lt;div&gt;</code>.</li>\n</ul>\n</li>\n<li>\n<p><strong>React:</strong> Ei, <code class=\"language-text\">&lt;Content&gt;</code>, o que você renderiza?</p>\n<ul>\n<li><code class=\"language-text\">Content</code>: Eu renderizo um <code class=\"language-text\">&lt;article&gt;</code> com um texto e um <code class=\"language-text\">&lt;Footer&gt;</code> dentro.</li>\n</ul>\n</li>\n<li>\n<p><strong>React:</strong> Ei, <code class=\"language-text\">&lt;Footer&gt;</code>, o que você renderiza?</p>\n<ul>\n<li><code class=\"language-text\">Footer</code>: Eu renderizo um <code class=\"language-text\">&lt;footer&gt;</code> com um texto.</li>\n</ul>\n</li>\n<li><strong>React:</strong> Ok, aqui está:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// Estrutura DOM resultante</span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>article</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    Um texto\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>footer</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Mais algum texto</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>footer</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>article</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>É por isso que dizemos que a reconciliação é recursiva. Quando o React caminha na árvore de elementos, ele pode encontrar um elemento cujo <code class=\"language-text\">type</code> é um componente. Ele vai chamá-lo e continuar a descer pela árvore dos elementos React retornados. Eventualmente, vamos ficar sem componentes, e o React vai saber o que alterar na árvore do host.</p>\n<p>As mesmas regras de reconciliação já discutidas aplicam-se aqui também. Se o <code class=\"language-text\">type</code> em uma posição (determinada pelo índice e a <code class=\"language-text\">key</code> opcional) for alterada, o React vai jogar fora as instâncias do host dentro dela e recriá-las.</p>\n<h2 id=\"inversão-de-controle\"><a href=\"#invers%C3%A3o-de-controle\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Inversão de controle</h2>\n<p>Você deve estar se perguntando: por que apenas não chamamos os componentes diretamente? Por que escrever <code class=\"language-text\">&lt;Form /&gt;</code> em vez de <code class=\"language-text\">Form()</code>?</p>\n<p><strong>O React pode fazer seu trabalho melhor se “souber” a respeito dos seus componentes do que apenas ver a árvore de elementos React após chamá-los recursivamente.</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// 🔴 O React não tem ideia de que Layout e Article existem.</span>\n<span class=\"token comment\">// Você está chamando eles.</span>\nReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>\n  <span class=\"token function\">Layout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> children<span class=\"token operator\">:</span> <span class=\"token function\">Article</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  domContainer\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// ✅ O React sabe que Layout e Article existem.</span>\n<span class=\"token comment\">// O React chama eles.</span>\nReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Layout</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Article</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Layout</span></span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">,</span>\n  domContainer\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>Esse é um exemplo clássico de <a href=\"https://en.wikipedia.org/wiki/Inversion_of_control\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">inversão de controle</a>. Existem algumas propriedades interessantes que temos ao permitir que o React controle a chamada dos nossos componentes:</p>\n<ul>\n<li><strong>Componentes se tornam mais do que apenas funções.</strong> O React pode ampliar os componentes com funcionalidades como <em>estado local</em> que é ligado à identidade do componente na árvore. Um bom ambiente de execução provê abstrações fundamentais que comparam o problema em questão. Como já mencionamos, o React é orientado especificamente para programas que renderizam árvores de UI e respondem à interações. Se você chamasse os componentes diretamente, teria de implementar essas funcionalidades você mesmo.</li>\n<li><strong>Tipos de componentes participam da reconciliação.</strong> Ao permitir que o React chame seus componentes, você também diz mais a ele sobre a estrutura conceitual da sua árvore. Por exemplo, quando você move a renderização do <code class=\"language-text\">&lt;Feed&gt;</code> para a página <code class=\"language-text\">&lt;Profile&gt;</code>, o React não vai tentar reusar instâncias do host dentro dela - assim como quando você substitui <code class=\"language-text\">&lt;button&gt;</code> por um <code class=\"language-text\">&lt;p&gt;</code>. Todo o estado vai embora - o que é geralmente bom quando você renderiza uma <em>view</em> conceitualmente diferente. Você não deveria querer preservar o estado do <em>input</em> entre <code class=\"language-text\">&lt;PasswordForm&gt;</code> e <code class=\"language-text\">&lt;MessengerChat&gt;</code> mesmo que a posição do <code class=\"language-text\">&lt;input&gt;</code> na árvore se “alinhasse” entre eles acidentalmente.</li>\n<li><strong>O React pode atrasar a reconciliação.</strong> Se o React controla as chamadas aos seus componentes, ele pode fazer muitas coisas interessantes. Por exemplo, ele pode deixar o navegador realizar algumas tarefas entre as chamadas de componentes para que a re-renderização de uma árvore grande de componentes <a href=\"https://reactjs.org/blog/2018/03/01/sneak-peek-beyond-react-16.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">não bloqueie a thread principal</a>. Orquestrar isso manualmente sem reimplementar uma grande parte do React é difícil.</li>\n<li><strong>Uma história de debugging melhor.</strong> Se componentes são cidadãos de primeira classe que a biblioteca está ciente, podemos construir <a href=\"https://github.com/facebook/react-devtools\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ricas ferramentas para desenvolvedores</a> para introspecção em tempo de desenvolvimento.</li>\n</ul>\n<p>O último benefício do React chamando seus componentes é a <em>avaliação preguiçosa</em>. Vamos ver o que isso significa.</p>\n<h2 id=\"avaliação-preguiçosa\"><a href=\"#avalia%C3%A7%C3%A3o-pregui%C3%A7osa\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Avaliação Preguiçosa</h2>\n<p>Quando nós chamamos funções em JavaScript, os argumentos são avaliados antes da chamada:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// (2) This gets computed second</span>\n<span class=\"token function\">eat</span><span class=\"token punctuation\">(</span>\n  <span class=\"token comment\">// (1) This gets computed first</span>\n  <span class=\"token function\">prepareMeal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Isso é, geralmente, o que os desenvolvedores JavaScript esperam porque as funções em JavaScript podem ter efeitos colaterais implícitos. Seria surpreendente se chamássemos uma função em JavaScript, mas ela não executasse até que seu resultado fosse “usado” de alguma maneira.</p>\n<p>Entretanto, componentes React são <a href=\"#pureza\">relativamente</a> puros. Não existe absolutamente nenhuma necessidade de executá-los se soubermos que o resultado não vai ser renderizado na tela.</p>\n<p>Considere esse componente que usa <code class=\"language-text\">&lt;Comments&gt;</code> dentro de um <code class=\"language-text\">&lt;Page&gt;</code>:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Story</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> currentUser <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// return {</span>\n  <span class=\"token comment\">//   type: Page,</span>\n  <span class=\"token comment\">//   props: {</span>\n  <span class=\"token comment\">//     user: currentUser,</span>\n  <span class=\"token comment\">//     children: { type: Comments, props: {} }</span>\n  <span class=\"token comment\">//   }</span>\n  <span class=\"token comment\">// }</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Page</span></span> <span class=\"token attr-name\">user</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>currentUser<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Comments</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\"></span></span><span class=\"token plain-text\">    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Page</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>O componente <code class=\"language-text\">Page</code> pode renderizar os filhos dado a ele dentro de um <code class=\"language-text\">Layout</code>:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Page</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> user<span class=\"token punctuation\">,</span> children <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Layout</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token plain-text\">      </span><span class=\"token punctuation\">{</span>children<span class=\"token punctuation\">}</span><span class=\"token plain-text\"></span></span><span class=\"token plain-text\">    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Layout</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><em>(<code class=\"language-text\">&lt;A&gt;&lt;B /&gt;&lt;/A&gt;</code> em JSX é o mesmo que <code class=\"language-text\">&lt;A children={&lt;B /&gt;} /&gt;</code>.)</em></p>\n<p>Mas e se ele tem uma condição de saída antes disso?</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Page</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> user<span class=\"token punctuation\">,</span> children <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>user<span class=\"token punctuation\">.</span>isLoggedIn<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Por favor, faça login</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span></span>  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Layout</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">      </span><span class=\"token punctuation\">{</span>children<span class=\"token punctuation\">}</span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Layout</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Se chamarmos <code class=\"language-text\">Comments()</code> como uma função, ele seria executado imediatamente, independente de <code class=\"language-text\">Page</code> desejar renderizá-lo ou não:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// {</span>\n<span class=\"token comment\">//   type: Page,</span>\n<span class=\"token comment\">//   props: {</span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token comment\">//     children: Comments() // Sempre executa!</span></span><span class=\"token comment\">//   }</span>\n<span class=\"token comment\">// }</span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Page</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token plain-text\">  </span><span class=\"token punctuation\">{</span><span class=\"token function\">Comments</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\"></span></span><span class=\"token plain-text\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Page</span></span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Mas se passarmos um elemento React, não precisamos executar <code class=\"language-text\">Comments</code>:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// {</span>\n<span class=\"token comment\">//   type: Page,</span>\n<span class=\"token comment\">//   props: {</span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token comment\">//     children: { type: Comments }</span></span><span class=\"token comment\">//   }</span>\n<span class=\"token comment\">// }</span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Page</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token plain-text\">  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Comments</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\"></span></span><span class=\"token plain-text\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Page</span></span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Isso deixa o React decidir quando e <em>como</em> chamá-lo. Se nosso componente <code class=\"language-text\">Page</code> ignora suas props <code class=\"language-text\">children</code> e, em vez disso, renderiza <code class=\"language-text\">&lt;h1&gt;Por favor, faça login&lt;/h1&gt;</code>, o React não vai nem tentar chamar a função de <code class=\"language-text\">Comments</code>. Mas e daí?</p>\n<p>Isso é bom porque nos permite evitar renderizações desnecessárias que seriam jogadas fora e faz nosso código menos frágil. (Não nos importamos se `Comments’ é jogado fora ou não quando o usuário não fez login - ele não vai ser chamado.)</p>\n<h2 id=\"estado\"><a href=\"#estado\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Estado</h2>\n<p>Falamos <a href=\"#reconcilia%C3%A7%C3%A3o\">mais cedo</a> sobre identidade e como a “posição” conceitual de um elemento na árvore indica ao React se ele deve reusar uma instância de host ou criar uma nova. Instâncias do host têm todo tipo de estado local: foco, seleção, <em>input</em>, etc. Queremos preservar esse estado entre atualizações que, conceitualmente, renderizam a mesma UI. Também desejamos conseguir prever o momento de destruir a instância quando renderizamos algo conceitualmente diferente (como quando saímos de <code class=\"language-text\">&lt;SignupForm&gt;</code> para <code class=\"language-text\">&lt;MessengerChat&gt;</code>).</p>\n<p><strong>Estado local não é tão útil quando o React permite que <em>seus próprios</em> componentes também tenham os seus.</strong> Componentes continuam sendo funções, mas o React amplia-os com funcionalidades que são úteis para UIs. Estado local associado à posição na árvore é uma dessas funcionalidades.</p>\n<p>Chamamos essas funcionalidades de <em>Hooks</em>. Por exemplo, <code class=\"language-text\">useState</code> é um Hook.</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Example</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Você clicou </span><span class=\"token punctuation\">{</span>count<span class=\"token punctuation\">}</span><span class=\"token plain-text\"> vezes</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span></span><span class=\"gatsby-highlight-code-line\"><span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span>count <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span></span><span class=\"token plain-text\">        Clique em mim</span>\n<span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Ela retorna um par de valores: o estado atual e uma função que o atualiza.</p>\n<p>A sintaxe do <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment#Array_destructuring\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">array destructuring</a> nos permite dar nomes arbitrários às nossas variáveis de estado. Por exemplo, chamei esse par de <code class=\"language-text\">count</code> e <code class=\"language-text\">setCount</code>, mas poderia ser <code class=\"language-text\">banana</code> e <code class=\"language-text\">setBanana</code>. No texto abaixo, usarei <code class=\"language-text\">setState</code> para referir ao segundo valor independentemente do nome atual nos exemplos.</p>\n<p><em>(Você pode aprender mais sobre <code class=\"language-text\">useState</code> e outros Hooks fornecidos pelo React <a href=\"https://reactjs.org/docs/hooks-intro.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">aqui</a>.)</em></p>\n<h2 id=\"consistência\"><a href=\"#consist%C3%AAncia\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Consistência</h2>\n<p>Mesmo se desejarmos dividir o processo de reconciliação em partes <a href=\"https://www.youtube.com/watch?v=mDdgfyRB5kg\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">não-bloqueantes</a>, deveríamos realizar as operações da árvore do host em uma única ação síncrona. Dessa maneira, podemos garantir que o usuário não verá uma UI atualizada pela metade, e que o navegador não executará layout desnecessário e recálculo de estilo para estados intermediários que o usuário não deveria ver.</p>\n<p>É por isso que o React divide todo o trabalho entre a “fase de renderização” e a “fase de commit”. <em>Fase de renderização</em> é quando o React chama os seus componentes e executa a reconciliação. É seguro interromper e <a href=\"https://reactjs.org/blog/2018/03/01/sneak-peek-beyond-react-16.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">no futuro</a> isso vai ser assíncrono. A <em>fase de commit</em> é quando o React toca a árvore do host. Ela é sempre síncrona.</p>\n<h2 id=\"memorizando\"><a href=\"#memorizando\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Memorizando</h2>\n<p>Quando um pai agenda uma atualização chamando <code class=\"language-text\">setState</code>, o React, por padrão, reconcilia toda sua sub-árvore filha. Isso acontece porque o React não consegue saber se uma atualização no pai afetaria os filhos ou não e, por padrão, o React opta por ser consistente. Isso pode parecer muito caro na prática, mas não é um problema para sub-árvores pequenas e médias.</p>\n<p>Quando a árvore se torna muito profunda ou larga, você pode pedir para o React <a href=\"https://en.wikipedia.org/wiki/Memoization\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">memorizar</a> a sub-árvore e reusar renderizações anteriores durante alterações rasas de props iguais:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Row</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> item <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">memo</span><span class=\"token punctuation\">(</span>Row<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span></code></pre></div>\n<p>Agora, <code class=\"language-text\">setState</code> em um componente <code class=\"language-text\">&lt;Table&gt;</code> pai vai desconsiderar a reconciliação dos <code class=\"language-text\">item</code> das <code class=\"language-text\">Row</code>s que são, referencialmente, iguais aos <code class=\"language-text\">item</code> da última renderização.</p>\n<p>Você pode conseguir memorização fina no nível das expressões individuais com o <a href=\"https://reactjs.org/docs/hooks-reference.html#usememo\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Hook <code class=\"language-text\">useMemo()</code></a>. O <em>cache</em> é local para a posição do componente na árvore e vai ser destruído junto com seu estado local. Ele só guarda o último item.</p>\n<p>O React intencionalmente não memoriza componentes por padrão. Muitos componentes sempre recebem props diferentes, por isso memorizá-los seria um prejuízo.</p>\n<h2 id=\"modelos-puros\"><a href=\"#modelos-puros\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Modelos Puros</h2>\n<p>Ironicamente, o React não usa um sistema de “reatividade” para atualizações delicadas. Em outras palavras, qualquer atualização no topo desencadea reconciliação em vez de atualizar apenas os componentes afetados pela mudança.</p>\n<p>Essa é uma decisão intencional de design. O <a href=\"https://calibreapp.com/blog/time-to-interactive/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">tempo para ser interativo</a> é uma métrica crucial em aplicações web para consumidores, e atravessar modelos para configurar escutas delicadas consome muito desse tempo precioso. Adicionalmente, em muitas apps, interações tendem a resultar em pequenas (<em>hover</em> de botão) ou grandes (transição de página) atualizações, sendo inscrições delicadas um desperdício de recursos de memória nesse caso.</p>\n<p>Um dos mais importantes princípios de design do React é que ele funciona com dados puros. Se você tiver um monte de objetos JavaScript recebidos da rede, você pode, então, colocá-los diretamente em seus componentes sem pré-processamento. Não existem pegadinhas sobre quais propriedades você pode acessar, ou picos de performance inesperados quando uma estrutura muda um pouco. A Renderização do React é O(<em>tamanho da view</em>) em vez de O(<em>tamanho do modelo</em>), e você pode cortar significamente o <em>tamanho da view</em> com <a href=\"https://react-window.now.sh/#/examples/list/fixed-size\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">windowing</a>.</p>\n<p>Existem alguns tipos de aplicações onde inscrições delicadas são benéficas - como cotações de ações. Esse é um exemplo raro de “tudo se altera constantemente ao mesmo tempo”. Enquanto saídas de emergência imperativas podem ajudar a otimizar tal código, o React pode não ser a melhor opção para esse caso de uso. Ainda assim, você pode implementar seu próprio sistema de inscrição delicada em cima do React.</p>\n<p><strong>Note que existem problemas comuns de performance que mesmo inscrições delicadas e sistemas de “reatividade” não podem resolver.</strong> Por exemplo, renderizar uma <em>nova</em> árvore profunda (que acontece a cada transição de página) sem bloquear o navegador. Alterar o acompanhamento não o faz mais rápido - o faz mais lento porque temos mais trabalho a fazer para configurar as inscrições. Outro problema é que temos que esperar pelos dados antes de podermos renderizar a <em>view</em>. No React, nosso objetivo é resolver ambos os problemas com <a href=\"https://reactjs.org/blog/2018/03/01/sneak-peek-beyond-react-16.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Renderização Concorrente</a>.</p>\n<h2 id=\"agrupamento\"><a href=\"#agrupamento\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Agrupamento</h2>\n<p>Muitos componentes podem desejar atualizar o estado em resposta ao mesmo evento. Esse exemplo é simples, mas ilustra um padrão comum:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Pai</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span>count <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span></span><span class=\"token plain-text\">      O Pai clicou </span><span class=\"token punctuation\">{</span>count<span class=\"token punctuation\">}</span><span class=\"token plain-text\"> vezes</span>\n<span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Filho</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">Filho</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span>count <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span></span><span class=\"token plain-text\">      O filho clicou </span><span class=\"token punctuation\">{</span>count<span class=\"token punctuation\">}</span><span class=\"token plain-text\"> vezes</span>\n<span class=\"token plain-text\">    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Quando um evento é despachado, o <code class=\"language-text\">onClick</code> do filho é disparado primeiro (chamando seu <code class=\"language-text\">setState</code>). Então, o pai chama <code class=\"language-text\">setState</code> no seu próprio <code class=\"language-text\">onClick</code>.</p>\n<p>Se o React rerenderizar imediatamente os componentes em resposta às chamadas de <code class=\"language-text\">setState</code>, nós terminaríamos renderizando o filho duas vezes:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token operator\">**</span><span class=\"token operator\">*</span> <span class=\"token constant\">O</span> React entrando no evento de click <span class=\"token keyword\">do</span> navegador <span class=\"token operator\">**</span><span class=\"token operator\">*</span>\n<span class=\"token function\">Filho</span> <span class=\"token punctuation\">(</span>onClick<span class=\"token punctuation\">)</span>\n  <span class=\"token operator\">-</span> setState\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token operator\">-</span> rerenderiza o filho <span class=\"token comment\">// 😞 desnecessário</span></span><span class=\"token function\">Pai</span> <span class=\"token punctuation\">(</span>onClick<span class=\"token punctuation\">)</span>\n  <span class=\"token operator\">-</span> setState\n  <span class=\"token operator\">-</span> rerenderiza o Pai\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token operator\">-</span> rerenderiza o Filho</span><span class=\"token operator\">**</span><span class=\"token operator\">*</span> <span class=\"token constant\">O</span> React saindo <span class=\"token keyword\">do</span> evento de click <span class=\"token keyword\">do</span> navegador <span class=\"token operator\">**</span><span class=\"token operator\">*</span></code></pre></div>\n<p>O primeiro render do <code class=\"language-text\">Filho</code> seria desperdiçado. E não poderíamos fazer o React pular a renderização do <code class=\"language-text\">Filho</code> pela segunda vez porque o <code class=\"language-text\">Pai</code> poderia passar dados diferentes para ele baseado no seu estado atualizado.</p>\n<p><strong>É por isso que o React agrupa as atualizações dentro dos eventos:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token operator\">**</span><span class=\"token operator\">*</span> <span class=\"token constant\">O</span> React entrando no evento de click <span class=\"token keyword\">do</span> navegador <span class=\"token operator\">**</span><span class=\"token operator\">*</span>\n<span class=\"token function\">Filho</span> <span class=\"token punctuation\">(</span>onClick<span class=\"token punctuation\">)</span>\n  <span class=\"token operator\">-</span> setState\n<span class=\"token function\">Pai</span> <span class=\"token punctuation\">(</span>onClick<span class=\"token punctuation\">)</span>\n  <span class=\"token operator\">-</span> setState\n<span class=\"token operator\">**</span><span class=\"token operator\">*</span> Processando atualizações de estado <span class=\"token operator\">**</span><span class=\"token operator\">*</span>\n  <span class=\"token operator\">-</span> rerenderizando o Pai\n  <span class=\"token operator\">-</span> rerenderizando o Filho\n<span class=\"token operator\">**</span><span class=\"token operator\">*</span> <span class=\"token constant\">O</span> React saindo <span class=\"token keyword\">do</span> evento de click <span class=\"token keyword\">do</span> navegador <span class=\"token operator\">**</span><span class=\"token operator\">*</span></code></pre></div>\n<p>As chamadas de <code class=\"language-text\">setState</code> nos componentes não deveriam causar uma rerenderização imediata. Em vez disso, o React executaria todos os eventos primeiro e, depois, dispararia uma única rerenderização agrupando todas as atualizações de uma vez.</p>\n<p>Agrupamento é bom para performance, mas pode ser uma surpresa se você escrever código assim:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">function</span> <span class=\"token function\">increment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span>count <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">function</span> <span class=\"token function\">handleClick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">increment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">increment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">increment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p>Se começarmos com <code class=\"language-text\">count</code> em <code class=\"language-text\">0</code>, esses seriam apenas três chamadas de <code class=\"language-text\">setCount(1)</code>. Para resolver isso, o <code class=\"language-text\">setState</code> provê uma sobrecarga que aceita uma função “atualizador”:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">function</span> <span class=\"token function\">increment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">c</span> <span class=\"token operator\">=></span> c <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">function</span> <span class=\"token function\">handleClick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">increment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">increment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">increment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p>O React colocaria as funções atualizadoras em uma fila, e depois as executaria em sequência, resultando em uma rerenderização com <code class=\"language-text\">count</code> em <code class=\"language-text\">3</code>.</p>\n<p>Quando uma lógica de estado se torna mais complexa do que algumas chamadas para <code class=\"language-text\">setState</code>, eu recomendo expressar isso como um redutor de estado local com o <a href=\"https://reactjs.org/docs/hooks-reference.html#usereducer\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Hook <code class=\"language-text\">useReducer</code></a>. É como uma evolução desse padrão de “atualizador” em que cada atualização tem um nome:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>counter<span class=\"token punctuation\">,</span> dispatch<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useReducer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">state<span class=\"token punctuation\">,</span> action</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>action <span class=\"token operator\">===</span> <span class=\"token string\">'increment'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> state <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> state<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">function</span> <span class=\"token function\">handleClick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'increment'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'increment'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'increment'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p>O argumento <code class=\"language-text\">action</code> pode ser qualquer coisa, porém uma escolha comum é um objeto.</p>\n<h2 id=\"árvore-de-chamadas\"><a href=\"#%C3%A1rvore-de-chamadas\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Árvore de Chamadas</h2>\n<p>O ambiente de execução de uma linguagem geralmente tem uma <a href=\"https://medium.freecodecamp.org/understanding-the-javascript-call-stack-861e41ae61d4\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">pilha de chamadas</a>. Quando uma função <code class=\"language-text\">a()</code> chama <code class=\"language-text\">b()</code> que, por sua vez, chama <code class=\"language-text\">c()</code>, em algum lugar do motor JavaScript existe uma estrutura de dados como <code class=\"language-text\">[a, b, c]</code> que “rastreia” onde você está e qual código executar em seguida. Uma vez que você sai do <code class=\"language-text\">c</code>, sua pilha de chamada se vai - puf! Ela não é mais necessária. Saltamos de volta ao <code class=\"language-text\">b</code>. No momento em que saímos de <code class=\"language-text\">a</code>, a pilha de chamadas está vazia.</p>\n<p>Claro, o próprio React executa no JavaScript e obedece as regras do JavaScript. Mas podemos imaginas que, internamente, o React tem algum tipo próprio de pilha de chamadas para lembrar qual o componente que está renderizando no momento, ex: <code class=\"language-text\">[App, Page, Layout, Article /* estamos aqui */]</code>.</p>\n<p>O React é diferente de um ambiente de execução de uma linguagem de propósito geral porque ele é voltado para renderização de árvores de UI. Essas árvores precisam “manter-se vivas” para que possamos interagir com elas.</p>\n<p>Isso pode extrapolar a metáfora, mas gosto de pensar nos componentes React estando dentro de uma “árvore de chamadas” do que simplesmente uma “pilha de chamadas”. Quando “saímos” do componente <code class=\"language-text\">Article</code>, seu espaço na “árvore de chamadas” do React não é destruído. Precisamos manter o estado local e as referências às instâncias do host <a href=\"https://medium.com/react-in-depth/the-how-and-why-on-reacts-usage-of-linked-list-in-fiber-67f1014d0eb7\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">em algum lugar</a>.</p>\n<p>Esses espaços na “árvore de chamadas” <em>são</em> destruídos junto com seus estados locais e instâncias do host, porém apenas quando as regras de <a href=\"#reconcilia%C3%A7%C3%A3o\">reconciliação</a> dizem que é necessário. Se você já viu o código-fonte do React alguma vez, você deve ter visto esses espaços sendo referidos como <a href=\"https://en.wikipedia.org/wiki/Fiber_(computer_science)\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Fibers</a>.</p>\n<p><em>Fibers</em> são onde o estado local realmente vive. Quando o estado é atualizado, o React marca os <em>Fibers</em> abaixo como precisando de reconciliação, e chama esses componentes.</p>\n<h2 id=\"contexto\"><a href=\"#contexto\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Contexto</h2>\n<p>No React, passamos as coisas para outros componentes abaixo como props. Algumas vezes, a maioria dos componentes precisam da mesma coisa - por exemplo, o tema visual escolhido. Se torna trabalhoso passá-lo para cada nível abaixo.</p>\n<p>No React, isso é resolvido com o <a href=\"https://reactjs.org/docs/context.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Contexto</a>. Isso é essencialmente como um <a href=\"http://wiki.c2.com/?DynamicScoping\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">escopo dinâmico</a> para componentes. É como um buraco de minhoca que te permite colocar algo no topo e faz com que cada filho abaixo seja capaz de lê-lo e rerenderizar quando é alterado.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> ThemeContext <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">createContext</span><span class=\"token punctuation\">(</span>\n  <span class=\"token string\">'light'</span> <span class=\"token comment\">// Valor padrão como reserva</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">DarkApp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ThemeContext.Provider</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>dark<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MyComponents</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">ThemeContext.Provider</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">SomeDeeplyNestedChild</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Depende de onde o filho é renderizado</span>\n  <span class=\"token keyword\">const</span> theme <span class=\"token operator\">=</span> <span class=\"token function\">useContext</span><span class=\"token punctuation\">(</span>ThemeContext<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Quando <code class=\"language-text\">SomeDeeplyNestedChild</code> renderiza, <code class=\"language-text\">useContext(ThemeContext)</code> vai procurar pelo <code class=\"language-text\">&lt;ThemeContext.Provider&gt;</code> mais próximo acima dele na árvore, e usar o seu <code class=\"language-text\">value</code>.</p>\n<p>(Na prática, o React mantém uma pilha de contexto enquanto renderiza.)</p>\n<p>Se não existe <code class=\"language-text\">ThemeContext.Provider</code> acima, o resultado da chamada de <code class=\"language-text\">useContext(ThemeContext)</code> vai ser o valor padrão especificado na chamada de <code class=\"language-text\">createContext()</code>.  No nosso exemplo, isso é <code class=\"language-text\">&#39;light&#39;</code>.</p>\n<h2 id=\"efeitos\"><a href=\"#efeitos\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Efeitos</h2>\n<p>Mencionamos anteriormente que os componentes React não deveriam ter efeitos colaterais observáveis durante a renderização. Mas efeitos colaterais são necessários algumas vezes. Podemos querer gerenciar o foco, desenhar em um <em>canvas</em>, inscrever em uma fonte de dados e por aí vai.</p>\n<p>No React, isso pode ser feito declarando um efeito:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Example</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">    document<span class=\"token punctuation\">.</span>title <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">You clicked </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>count<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> times</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">You clicked </span><span class=\"token punctuation\">{</span>count<span class=\"token punctuation\">}</span><span class=\"token plain-text\"> times</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span>count <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">        Click me</span>\n<span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Quando possível, o React adia a execução dos efeitos até que o navegador repinte a tela. Isso é bom porque códigos como inscrições de fontes de dados não deveriam prejudicar o <a href=\"https://calibreapp.com/blog/time-to-interactive/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">tempo para interatividade</a> o <a href=\"https://developers.google.com/web/tools/lighthouse/audits/first-meaningful-paint\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">tempo para primeira pintura</a>. (Existe um Hook <a href=\"https://reactjs.org/docs/hooks-reference.html#uselayouteffect\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">usado raramente</a> que te permite sair desse comportamento e fazer as coisas de forma síncrona. Evite-o.)</p>\n<p>Efeitos não executam apenas uma vez. Eles executam tanto depois de um componente ser exibido para o usuário pela primeira vez quanto depois que ele atualiza. Efeitos podem aproximar props e estado, assim como o <code class=\"language-text\">count</code> no exemplo acima.</p>\n<p>Efeitos podem requerer uma limpeza, como no caso das inscrições. Para limpar, um efeito pode retornar uma função:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    DataSource<span class=\"token punctuation\">.</span><span class=\"token function\">addSubscription</span><span class=\"token punctuation\">(</span>handleChange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> DataSource<span class=\"token punctuation\">.</span><span class=\"token function\">removeSubscription</span><span class=\"token punctuation\">(</span>handleChange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>O React vai executar a função retornada antes de aplicar esse efeito na próxima vez, e também antes do componente ser destruído.</p>\n<p>Algumas vezes, re-executar o efeito em cada renderização pode ser indesejado. Você pode pedir ao React para <a href=\"https://reactjs.org/docs/hooks-effect.html#tip-optimizing-performance-by-skipping-effects\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">pular</a> a aplicação do efeito se certas variáveis não mudarem:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    document<span class=\"token punctuation\">.</span>title <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">You clicked </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>count<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> times</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span></code></pre></div>\n<p>Entretando, é, geralmente, uma otimização prematura e pode levar a problemsa se você não está familiarizado em como as <em>closures</em> em JavaScript funcionam.</p>\n<p>Por exemplo, esse código está bugado:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    DataSource<span class=\"token punctuation\">.</span><span class=\"token function\">addSubscription</span><span class=\"token punctuation\">(</span>handleChange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> DataSource<span class=\"token punctuation\">.</span><span class=\"token function\">removeSubscription</span><span class=\"token punctuation\">(</span>handleChange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Está bugado porque o <code class=\"language-text\">[]</code> diz “jamais reexecute esse efeito”. Mas o efeito utiliza <code class=\"language-text\">handleChange</code> que é definido fora dele. E <code class=\"language-text\">handleChange</code> pode conter referência para qualquer props ou estado:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">  <span class=\"token keyword\">function</span> <span class=\"token function\">handleChange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>count<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p>Se nós jamais permitirmos o efeito executar novamente, <code class=\"language-text\">handleChange</code> vai permanecer apontando para a versão da primeira renderização, e <code class=\"language-text\">count</code> vai sempre ser <code class=\"language-text\">0</code> dentro dele.</p>\n<p>Para resolver isso, se assegure de que se você especificar um array de dependências, que ele inclua <em>tudo</em> que pode mudar, incluindo as funções:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    DataSource<span class=\"token punctuation\">.</span><span class=\"token function\">addSubscription</span><span class=\"token punctuation\">(</span>handleChange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> DataSource<span class=\"token punctuation\">.</span><span class=\"token function\">removeSubscription</span><span class=\"token punctuation\">(</span>handleChange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>handleChange<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span></code></pre></div>\n<p>Dependendo do seu código, você ainda pode ver reinscrições desnecessárias porque o próprio <code class=\"language-text\">handleChange</code> é diferente em cada renderização. O Hook <a href=\"https://reactjs.org/docs/hooks-reference.html#usecallback\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">useCallback</code></a> pode te ajudar com isso. Alternativamente, você pode apenas permiti-lo se reinscrever. Por exemplo, o <code class=\"language-text\">addEventListener</code> da API de um navegador é extremamente rápido, e fazer saltos para impedir que ele seja chamado pode causar mais problemas do que o necessário.</p>\n<p><em>(Você pode aprender mais sobre <code class=\"language-text\">useEffect</code> e outros Hooks que o React provê <a href=\"https://reactjs.org/docs/hooks-effect.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">aqui</a>.)</em></p>\n<h2 id=\"hooks-customizados\"><a href=\"#hooks-customizados\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Hooks Customizados</h2>\n<p>Já que Hooks como <code class=\"language-text\">useState</code> e <code class=\"language-text\">useEffect</code> são chamadas de funções, podemos usá-las em nossos próprios Hooks:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">MyResponsiveComponent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> width <span class=\"token operator\">=</span> <span class=\"token function\">useWindowWidth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Our custom Hook</span></span>  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Window width is </span><span class=\"token punctuation\">{</span>width<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">function</span> <span class=\"token function\">useWindowWidth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span>  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>width<span class=\"token punctuation\">,</span> setWidth<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>innerWidth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleResize</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setWidth</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>innerWidth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'resize'</span><span class=\"token punctuation\">,</span> handleResize<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      window<span class=\"token punctuation\">.</span><span class=\"token function\">removeEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'resize'</span><span class=\"token punctuation\">,</span> handleResize<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> width<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Hooks customizados permitem que diferentes componentes compartilhem uma lógica com estado. Note que o <em>próprio estado</em> não é compartilhado. Cada chamada para um Hook declara seu próprio estado isolado.</p>\n<p><em>(Você pode aprender mais sobre escrever seus próprios Hooks <a href=\"https://reactjs.org/docs/hooks-custom.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">aqui</a>.)</em></p>\n<h2 id=\"ordem-de-uso-estático\"><a href=\"#ordem-de-uso-est%C3%A1tico\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Ordem de Uso Estático</h2>\n<p>Você pode pensar em <code class=\"language-text\">useState</code> como uma sintaxe para definir uma “variável de estado do React”. Não é <em>exatamente</em> uma sintaxe, é claro. Ainda estamos escrevendo JavaScript. Mas estamos olhando para o React como um ambiente de execução, e porque o React utiliza JavaScript para descrever árvores de UI, suas funcionalidades algumas vezes vivem perto do espaço da linguagem.</p>\n<p>Se <code class=\"language-text\">use</code> <em>fosse</em> uma sintaxe, faria sentido para ela estar no nível mais alto:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// 😉 Nota: não é uma sintaxe real</span>\ncomponent <span class=\"token function\">Example</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> use <span class=\"token function\">State</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">You clicked </span><span class=\"token punctuation\">{</span>count<span class=\"token punctuation\">}</span><span class=\"token plain-text\"> times</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span>count <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">        Click me</span>\n<span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>O que colocá-lo em uma condição ou um <em>callback</em> ou fora de um componente significaria?</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// 😉 Nota: não é uma sintaxe real</span>\n\n<span class=\"token comment\">// Isso é estado local... de quê?</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> use <span class=\"token function\">State</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\ncomponent <span class=\"token function\">Example</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>condition<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// O que acontece a ele se a condição for falsa?</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> use <span class=\"token function\">State</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">function</span> <span class=\"token function\">handleClick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// O que acontece a ele quando saímos da função?</span>\n    <span class=\"token comment\">// Qual a diferença disso para uma variável?</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> use <span class=\"token function\">State</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p>O estado do React é local para o <em>componente</em> e sua identidade na árvore. Se <code class=\"language-text\">use</code> fosse uma sintaxe real, faria sentido colocá-la no nível mais alto de um componente também:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// 😉 Nota: não é uma sintaxe real</span>\ncomponent <span class=\"token function\">Example</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Só é válido aqui</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> use <span class=\"token function\">State</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>condition<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Isso seria um erro de sintaxe</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> use <span class=\"token function\">State</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p>Isso é similar a como o <code class=\"language-text\">import</code> só funciona no nível mais alto como um módulo.</p>\n<p><strong>É claro, <code class=\"language-text\">use</code> não é realmente uma sintaxe.</strong> (não traria muitos benefícios e criaria muita fricção.)</p>\n<p>Entretanto, o React <em>realmente</em> espera que todas as chamadas de Hooks aconteçam no nível mais alto de um componente incondicionalmente. Essas <a href=\"https://reactjs.org/docs/hooks-rules.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Regras dos Hooks</a> podem ser reforçadas com um <a href=\"https://www.npmjs.com/package/eslint-plugin-react-hooks\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">plugin de linter</a>. Essa escolha de design gerou argumentos acalorados, mas, na prática, não tenho visto isso confundir as pessoas. Também escrevi sobre como alternativas comumente propostas <a href=\"https://overreacted.io/why-do-hooks-rely-on-call-order/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">não funcionam</a>.</p>\n<p>Internamente, Hooks são implementados como <a href=\"https://dev.to/aspittel/thank-u-next-an-introduction-to-linked-lists-4pph\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">listas encadeadas</a>. Quando você chama <code class=\"language-text\">useState</code>, nós movemos o ponteiro para o próximo item. Quando saímos do <a href=\"#%C3%A1rvore-de-chamadas\">espaço na “árvore de chamadas”</a> do componente, nós salvamos a lista resultante ali até a próxima renderização.</p>\n<p><a href=\"https://medium.com/@ryardley/react-hooks-not-magic-just-arrays-cd4f1857236e\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Esse artigo</a> provê uma explicação simplificado de como os Hooks funcionam internamente. Vetores podem ser um modelo mental mais fácil do que listas encadeadas:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// Pseudocódigo</span>\n<span class=\"token keyword\">let</span> hooks<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  i<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>hooks<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Próxima renderização</span>\n    <span class=\"token keyword\">return</span> hooks<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// Primeira renderização</span>\n  hooks<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Preparando para renderizar</span>\ni <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\nhooks <span class=\"token operator\">=</span> fiber<span class=\"token punctuation\">.</span>hooks <span class=\"token operator\">||</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Chamando o componente</span>\n<span class=\"token function\">YourComponent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Memorizando o estado do Hooks</span>\nfiber<span class=\"token punctuation\">.</span>hooks <span class=\"token operator\">=</span> hooks<span class=\"token punctuation\">;</span></code></pre></div>\n<p><em>(Se você for uma pessoa curiosa, o código real está <a href=\"https://github.com/facebook/react/blob/master/packages/react-reconciler/src/ReactFiberHooks.js\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">aqui</a>.)</em></p>\n<p>Isso é basicamente como cada chamada a <code class=\"language-text\">useState()</code> encontra o estado correto. Como aprendemos <a href=\"#reconcilia%C3%A7%C3%A3o\">mais cedo</a>, “comparar as coisas” não é novo para o React - a reconciliação se baseia nos elementos sendo comparados entre renderizações de maneira semelhante.</p>\n<h2 id=\"o-que-sobrou\"><a href=\"#o-que-sobrou\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>O que sobrou</h2>\n<p>Toquei em quase todos os aspectos importantes do ambiente de execução do React. Se você terminou de ler essa página, você provavelmente sabe mais dos detalhes do React do que 90% dos seus usuários. E não há nada de errado com isso!</p>\n<p>Há algumas partes que deixei de fora - mais porque elas ainda não são claras mesmo para nós. O React não tem uma boa história para as renderizações com muitos passes - como quando o pai precisa de informações do filho para renderizar. A <a href=\"https://reactjs.org/docs/error-boundaries.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">API de gestão de erro</a> também ainda não tem uma versão para os Hooks. É possível que esses dois problemas sejam resolvidos juntos. Modo Concorrente ainda não está estável, e existem questões interessantes sobre como o Suspense se encaixa nesse quadro. Talvez eu faça um acompanhamento quando esteja tudo resolvido e o Suspense esteja pronto para mais coisas do que apenas o <a href=\"https://reactjs.org/blog/2018/10/23/react-v-16-6.html#reactlazy-code-splitting-with-suspense\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">carregamento preguiçoso</a>.</p>\n<p><strong>Eu acho que isso mostra o sucesso da API do React quando você pode chegar muito longe sem nem se preocupar com muitos desses tópicos.</strong> Muitos padrões como a heurística da reconciliação fazem o certo em muitos casos. Cuidados, como o da <code class=\"language-text\">key</code>, te incomodam quando você arrisca atirar no próprio pé.</p>\n<p>Se você é um nerd de bibliotecas UI, espero que esse post foi algo divertido e esclareceu como o React trabalha com mais profundidade. Ou talvez você decidiu que o React é muito complicado e não quer nunca mais vê-lo de novo. De todo modo, eu gostaria de ouvir de você no Twitter! Obrigado por ler.</p>","timeToRead":39,"frontmatter":{"title":"React como um ambiente de execução de Interfaces","date":"February 02, 2019","spoiler":"Uma descrição aprofundada do modelo de programação do React.","cta":null},"fields":{"slug":"/pt-br/react-as-a-ui-runtime/","langKey":"pt-br"}}},"pageContext":{"slug":"/pt-br/react-as-a-ui-runtime/","translations":["es","fr","ko","pt-br","zh-hans"],"translatedLinks":["/the-elements-of-ui-engineering/","/why-do-react-elements-have-typeof-property/"]}}}