{"componentChunkName":"component---src-templates-blog-post-js","path":"/pt-br/how-does-the-development-mode-work/","result":{"data":{"site":{"siteMetadata":{"title":"Overreacted","author":"Dan Abramov"}},"markdownRemark":{"id":"820f8707-85bc-5491-83d9-00c09113d6d6","html":"<p>Se sua base de c√≥digo JavaScript for moderadamente complexa, <strong>voc√™ provavelmente ter√° uma maneira de agrupar e executar c√≥digo diferente no desenvolvimento e produ√ß√£o</strong>.</p>\n<p>Agrupar e executar c√≥digo diferente no desenvolvimento e produ√ß√£o √© poderoso. No modo de desenvolvimento, o React inclui muitos avisos que ajudam a encontrar problemas antes que eles levem a erros. No entanto, o c√≥digo necess√°rio para detectar esses erros geralmente aumenta o tamanho do pacote e torna o aplicativo mais lento.</p>\n<p>A desacelera√ß√£o √© aceit√°vel no desenvolvimento. De fato, executar o c√≥digo mais lentamente no desenvolvimento <em>pode at√© ser ben√©fico</em>, pois compensa parcialmente a discrep√¢ncia entre m√°quinas de desenvolvimento r√°pido e um dispositivo de consumo m√©dio.</p>\n<p>Em produ√ß√£o, n√£o queremos pagar nenhum custo. Portanto, omitimos essas verifica√ß√µes na produ√ß√£o. Como isso funciona? Vamos dar uma olhada.</p>\n<p>‚Äî</p>\n<p>A maneira exata de executar c√≥digo diferente no desenvolvimento depende do pipeline de constru√ß√£o do seu JavaScript (e se voc√™ possui um). No Facebook, parece com isso:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>__DEV__<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">doSomethingDev</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">doSomethingProd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Aqui, <code class=\"language-text\">__DEV__</code> n√£o √© uma vari√°vel real. √â uma constante que √© substitu√≠da quando os m√≥dulos s√£o unidos para o navegador. O resultado fica assim:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// Em desenvolvimento:</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">doSomethingDev</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// üëà</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">doSomethingProd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Em produ√ß√£o:</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">doSomethingDev</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">doSomethingProd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// üëà</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Em produ√ß√£o, voc√™ tamb√©m executa um minificador (por exemplo, <a href=\"https://github.com/terser-js/terser\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">terser</a>) no c√≥digo. A maioria dos minificadores de JavaScript faz uma forma limitada de <a href=\"https://en.wikipedia.org/wiki/Dead_code_elimination\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">elimina√ß√£o de c√≥digo morto</a>, como a remo√ß√£o de ramifica√ß√µes <code class=\"language-text\">if (false)</code>. Ent√£o, em produ√ß√£o, voc√™ s√≥ v√™:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// In production (after minification):</span>\n<span class=\"token function\">doSomethingProd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><em>(Observe que existem limites significativos sobre a efic√°cia da elimina√ß√£o do c√≥digo morto com as principais ferramentas JavaScript, mas esse √© um t√≥pico separado.)</em></p>\n<p>Embora voc√™ possa n√£o estar usando uma constante m√°gica <code class=\"language-text\">__DEV__</code>, se voc√™ usar um empacotador JavaScript popular como o webpack, provavelmente h√° outras conven√ß√µes que voc√™ pode seguir. Por exemplo, √© comum expressar o mesmo padr√£o assim:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">doSomethingDev</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">doSomethingProd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>Esse √© exatamente o padr√£o usado por bibliotecas como <a href=\"https://reactjs.org/docs/optimizing-performance.html#use-the-production-build\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">React</a> e <a href=\"https://vuejs.org%20/v2/guide/deployment.html#Turn-on-Production-Mode\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Vue</a> ao import√°-los do npm usando um empacotador.</strong> (A cria√ß√£o da tag <code class=\"language-text\">&lt;script&gt;</code> de arquivo √∫nico oferece vers√µes de desenvolvimento e produ√ß√£o separadas como arquivos <code class=\"language-text\">.js</code> e <code class=\"language-text\">.min.js</code>.)</p>\n<p>Essa conven√ß√£o em particular √© origin√°ria do Node.js. No Node.js, existe uma vari√°vel global <code class=\"language-text\">process</code> que exp√µe as vari√°veis de ambiente do sistema como propriedades no <a href=\"https://nodejs.org/dist/latest-v8.x/docs/api/process.html#process_process_env\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">process.env</code></a>. No entanto, quando voc√™ v√™ esse padr√£o em uma base de c√≥digo front-end, geralmente n√£o h√° nenhuma vari√°vel real de <code class=\"language-text\">processo</code> envolvida. ü§Ø</p>\n<p>Em vez disso, toda a express√£o <code class=\"language-text\">process.env.NODE_ENV</code> √© substitu√≠da por uma string literal no momento da constru√ß√£o, assim como nossa vari√°vel m√°gica <code class=\"language-text\">__DEV__</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// Em desenvolvimento:</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'development'</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// true</span>\n  <span class=\"token function\">doSomethingDev</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// üëà</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">doSomethingProd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Em produ√ß√£o:</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'production'</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// false</span>\n  <span class=\"token function\">doSomethingDev</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">doSomethingProd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// üëà</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Como toda a express√£o √© constante (<code class=\"language-text\">&#39;produ√ß√£o&#39; !== &#39;produ√ß√£o&#39;</code> √© garantida como <code class=\"language-text\">falsa</code>), um minificador tamb√©m pode remover o outro ramo.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// Em produ√ß√£o (depois da minifica√ß√£o):</span>\n<span class=\"token function\">doSomethingProd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Preju√≠zo controlado.</p>\n<hr>\n<p>Observe que isso <strong>n√£o funcionaria</strong> com express√µes mais complexas:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">let</span> mode <span class=\"token operator\">=</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>mode <span class=\"token operator\">!==</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// üî¥ n√£o √© garantido que seja eliminado</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>As ferramentas de an√°lise est√°tica do JavaScript n√£o s√£o muito inteligentes devido √† natureza din√¢mica da linguagem. Quando eles veem vari√°veis como <code class=\"language-text\">mode</code> em vez de express√µes est√°ticas como <code class=\"language-text\">false</code> ou <code class=\"language-text\">&#39;production&#39; !== &#39;production&#39;</code>, eles geralmente desistem.</p>\n<p>Da mesma forma, a elimina√ß√£o de c√≥digo morto no JavaScript geralmente n√£o funciona bem nos limites do m√≥dulo quando voc√™ usa as instru√ß√µes <code class=\"language-text\">import</code> de n√≠vel superior:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// üî¥ n√£o √© garantido que seja eliminado</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>someFunc<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'some-module'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">someFunc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Portanto, voc√™ precisa escrever o c√≥digo de uma maneira muito mec√¢nica que torne a condi√ß√£o <em>definitivamente est√°tica</em> e garantir que <em>todo o c√≥digo</em> que voc√™ deseja eliminar esteja dentro dela.</p>\n<hr>\n<p>Para que tudo isso funcione, seu empacotador precisa fazer a substitui√ß√£o do <code class=\"language-text\">process.env.NODE_ENV</code> e precisa saber em qual modo voc√™ <em>deseja</em> construir o projeto.</p>\n<p>Alguns anos atr√°s, costumava-se esquecer de configurar o ambiente. Voc√™ costuma ver um projeto no modo de desenvolvimento implantado na produ√ß√£o.</p>\n<p>Isso √© ruim porque faz o site carregar e ficar mais lento.</p>\n<p>Nos √∫ltimos dois anos, a situa√ß√£o melhorou significativamente. Por exemplo, o webpack adicionou uma op√ß√£o simples <code class=\"language-text\">mode</code> em vez de configurar manualmente a substitui√ß√£o do <code class=\"language-text\">process.env.NODE_ENV</code>. O React DevTools agora tamb√©m exibe um √≠cone vermelho em sites com modo de desenvolvimento, facilitando a localiza√ß√£o e at√© o <a href=\"https://mobile.twitter.com/BestBuySupport/status/1027195363713736704\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">relat√≥rio</a>.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ca1c0db064f73cc5c8e21ad605eaba26/0a47e/devmode.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 33.108108108108105%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAABYlAAAWJQFJUiTwAAABGUlEQVQY04WQ3W6DMAyF8/4vtStWSEmAQlm7aZUmIPy1lIRAoFCYA+p1jyLn2FbkL0bTOz1fAgvp0PfX6v73+RGdv1C7qus6pZSUErxstDa/dfSl1GNon9NjWZZxmtoyr283RAnFluW5XhAEpmn6/gE8sW1sYUqhSanjUEIw3v+cnFuZqH4QXKwgE0pYWuR5ylgcx4yxvCiKsoSgiymUU7DX8hpHUcIy6GZZdvm9AOY4jgiwXoSy0cQCzHaU5m0F5xCVTiTnHIwmH8dhGJBhGK7jAuzRO5mGa1sHlxyJHfret++esbU3dztC6Po7HB7DRjTLKj153Y1ei2wUrztRd/eqvVcSTF110IRRQsB4DoDwYJ5niPBnmPwP62GCWHyCrHAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Development mode warning in React DevTools\"\n        title=\"\"\n        src=\"/static/ca1c0db064f73cc5c8e21ad605eaba26/fcda8/devmode.png\"\n        srcset=\"/static/ca1c0db064f73cc5c8e21ad605eaba26/12f09/devmode.png 148w,\n/static/ca1c0db064f73cc5c8e21ad605eaba26/e4a3f/devmode.png 295w,\n/static/ca1c0db064f73cc5c8e21ad605eaba26/fcda8/devmode.png 590w,\n/static/ca1c0db064f73cc5c8e21ad605eaba26/0a47e/devmode.png 600w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>Configura√ß√µes opinativas como Create React App, Next/Nuxt, Vue CLI, Gatsby e outras dificultam ainda mais a confus√£o, separando as compila√ß√µes de desenvolvimento e produ√ß√£o em dois comandos separados. (Por exemplo, <code class=\"language-text\">npm start</code> e <code class=\"language-text\">npm run build</code>.) Normalmente, apenas uma compila√ß√£o de produ√ß√£o pode ser implantada, para que o desenvolvedor n√£o cometa mais esse erro.</p>\n<p>Sempre h√° um argumento de que talvez o modo <em>produ√ß√£o</em> precise ser o padr√£o e o modo de desenvolvimento precise ser aceito. Pessoalmente, n√£o acho esse argumento convincente. As pessoas que mais se beneficiam dos avisos do modo de desenvolvimento geralmente s√£o novas na biblioteca. <em>Eles n√£o saberiam ativ√°-lo</em> e perderiam muitos bugs que os avisos teriam detectado antes.</p>\n<p>Sim, problemas de desempenho s√£o ruins. Mas o envio de experi√™ncias cheias de bugs para os usu√°rios finais tamb√©m √© ruim. Por exemplo, o <a href=\"https://reactjs.org/docs/lists-and-keys.html#keys\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Aviso React sobre keys de arrays</a> ajuda a evitar erros, como enviar uma mensagem para uma pessoa errada ou comprar um produto errado. Desenvolver com esse aviso desabilitado √© um risco significativo para voc√™ <em>e</em> para os seus usu√°rios. Se estiver desativado por padr√£o, no momento em que voc√™ encontrar o comando e ativ√°-lo, voc√™ ter√° muitos avisos para limpar. Ent√£o, a maioria das pessoas iria desativ√°-lo. √â por isso que ele precisa estar ativado desde o in√≠cio, e n√£o ativado mais tarde.</p>\n<p>Por fim, mesmo que os avisos de desenvolvimento tenham sido aceitos e os desenvolvedores <em>soubessem</em> ativ√°-los no in√≠cio do desenvolvimento, voltar√≠amos ao problema original. Algu√©m os deixaria ativos acidentalmente ao implantar na produ√ß√£o!</p>\n<p>E voltamos √† estaca zero.</p>\n<p>Pessoalmente, acredito em <strong>ferramentas que exibem e usam o modo correto, dependendo de voc√™ estar depurando ou implantando</strong>. Quase todos os outros ambientes (m√≥veis, desktops ou servidores), exceto o navegador, j√° t√™m uma maneira de carregar e diferenciar o desenvolvimento e a produ√ß√£o h√° d√©cadas.</p>\n<p>Em vez de as bibliotecas criarem e confiarem em conven√ß√µes ad-hoc, talvez seja a hora dos ambientes JavaScript verem essa distin√ß√£o como uma necessidade de primeira classe.</p>\n<hr>\n<p>Chega de filosofia!</p>\n<p>Vamos dar uma olhada novamente neste c√≥digo:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">doSomethingDev</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">doSomethingProd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Voc√™ pode estar se perguntando: se n√£o h√° um objeto <code class=\"language-text\">process</code> real no c√≥digo front-end, por que bibliotecas como React e Vue dependem dele nas compila√ß√µes npm?</p>\n<p><em>(Para esclarecer isso novamente: as tags <code class=\"language-text\">&lt;script&gt;</code> que voc√™ pode carregar no navegador, oferecidas pelo React e pelo Vue, n√£o confiam nisso. Em vez disso, voc√™ deve escolher manualmente entre os arquivos desenvolvimento <code class=\"language-text\">.js</code> e o <code class=\"language-text\">.min.js</code> de produ√ß√£o. A se√ß√£o abaixo √© apenas sobre o uso do React ou do Vue com um empacotador, <code class=\"language-text\">import</code>ando-os do npm.)</em></p>\n<p>Como muitas coisas na programa√ß√£o, esta conven√ß√£o em particular tem raz√µes hist√≥ricas. Ainda o estamos usando, porque agora ele √© amplamente adotado por diferentes ferramentas. Mudar para outra coisa √© caro e n√£o agrega muito.</p>\n<p>Ent√£o, qual √© a hist√≥ria por tr√°s disso?</p>\n<p>Muitos anos antes da padroniza√ß√£o da sintaxe <code class=\"language-text\">import</code> e <code class=\"language-text\">export</code>, havia v√°rias maneiras concorrentes de expressar relacionamentos entre os m√≥dulos. O Node.js. popularizou <code class=\"language-text\">require()</code> e <code class=\"language-text\">module.exports</code>, conhecidos como <a href=\"https://en.wikipedia.org/wiki/CommonJS\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">CommonJS</a>.</p>\n<p>O c√≥digo publicado no registro npm no in√≠cio foi escrito para Node.js. <a href=\"https://expressjs.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Express</a> foi (e provavelmente ainda √©?) a estrutura do servidor mais popular para o Node.js e <a href=\"https://expressjs.com/en/advanced/best-practice-performance.html#set-node_env-to-production\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">usou a vari√°vel de ambiente <code class=\"language-text\">NODE_ENV</code></a> para ativar o modo de produ√ß√£o. Alguns outros pacotes npm adotaram a mesma conven√ß√£o.</p>\n<p>Os primeiros empacotadores de JavaScript, como o browserify, queriam possibilitar o uso do c√≥digo do npm em projetos de front-end. (Sim, <a href=\"https://blog.npmjs.org/post/101775448305/npm-and-front-end-packaging\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">naquela √©poca</a> quase ningu√©m usava o npm no front-end! Voc√™ pode imaginar?) Ent√£o eles estenderam o mesma conven√ß√£o j√° presente no ecossistema Node.js. para o c√≥digo de front-end.</p>\n<p>A transforma√ß√£o ‚Äúenvify‚Äù original foi <a href=\"https://github.com/hughsk/envify/commit/ae8aa26b759cd2115eccbed96f70e7bbdceded97\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">lan√ßada em 2013</a>. O React teve seu c√≥digo aberto nessa √©poca e o npm com o browserify parecia a melhor solu√ß√£o para agrupar o c√≥digo CommonJS de front-end naquela √©poca.</p>\n<p>O React come√ßou a fornecer compila√ß√µes npm (al√©m das compila√ß√µes de tags <code class=\"language-text\">&lt;script&gt;</code>) desde o in√≠cio. √Ä medida que o React se popularizou, a pr√°tica de escrever JavaScript modular com m√≥dulos CommonJS e enviar c√≥digo de front-end via npm tamb√©m ficou popular.</p>\n<p>React precisave de remover o c√≥digo somente de desenvolvimento no modo de produ√ß√£o. O Browserify j√° ofereceu uma solu√ß√£o para esse problema, ent√£o o React tamb√©m adotou a conven√ß√£o de usar o <code class=\"language-text\">process.env.NODE_ENV</code> para suas compila√ß√µes npm. Com o tempo, muitas outras ferramentas e bibliotecas, incluindo webpack e Vue, fizeram o mesmo.</p>\n<p>Em 2019, o browserify perdeu um pouco de aten√ß√£o. No entanto, substituir <code class=\"language-text\">process.env.NODE_ENV</code> por <code class=\"language-text\">&#39;development&#39;</code> ou <code class=\"language-text\">&#39;production&#39;</code> durante uma etapa de compila√ß√£o √© uma conven√ß√£o mais popular do que nunca.</p>\n<p><em>(Seria interessante ver como a ado√ß√£o dos M√≥dulos ES como um formato de distribui√ß√£o, em vez de apenas o formato de autoria, altera a equa√ß√£o. Diga-me no Twitter?)</em></p>\n<hr>\n<p>Uma coisa que ainda pode confundir voc√™ √© que no React <em>c√≥digo-fonte</em> no GitHub, voc√™ ver√° <code class=\"language-text\">__DEV__</code> sendo usado como uma vari√°vel m√°gica. Mas no c√≥digo React no npm, ele usa <code class=\"language-text\">process.env.NODE_ENV</code>. Como isso funciona?</p>\n<p>Historicamente, usamos <code class=\"language-text\">__DEV__</code> no c√≥digo-fonte para corresponder ao c√≥digo-fonte do Facebook. Por um longo tempo, o React foi copiado diretamente na base de c√≥digo do Facebook, por isso era necess√°rio seguir as mesmas regras. Para o npm, tivemos uma etapa de constru√ß√£o que literalmente substituiu as verifica√ß√µes <code class=\"language-text\">__DEV__</code> por <code class=\"language-text\">process.env.NODE_ENV! == &#39;produ√ß√£o&#39;</code> logo antes da publica√ß√£o.</p>\n<p>Isso √†s vezes era um problema. √Äs vezes, um padr√£o de c√≥digo baseado em alguma conven√ß√£o do Node.js funcionava bem no npm, mas quebrava o Facebook ou vice-versa.</p>\n<p>Desde ao React 16, mudamos a abordagem. Em vez disso, agora <a href=\"https://reactjs.org/blog/2017/12/15/improving-the-repository-infrastructure.html#compiling-flat-bundles\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">compilamos um pacote</a> para cada ambiente (incluindo <code class=\"language-text\">&lt;script&gt;</code> tags, npm e a base de c√≥digo interna do Facebook). Assim, mesmo o c√≥digo CommonJS para npm √© compilado para separar os pacotes de desenvolvimento e produ√ß√£o antes do tempo.</p>\n<p>Isso significa que enquanto o c√≥digo fonte do React diz <code class=\"language-text\">if (__DEV __)</code>, na verdade produzimos <em>dois</em> pacotes para cada pacote. Um j√° est√° pr√©-compilado com <code class=\"language-text\">__DEV__ = true</code> e outro √© pr√©-compilado com <code class=\"language-text\">__DEV__ = false</code>. O ponto de entrada para cada pacote no npm ‚Äúdecide‚Äù qual exportar.</p>\n<p><a href=\"https://unpkg.com/browse/react@16.8.6/index.js\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Por exemplo:</a></p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">===</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./cjs/react.production.min.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./cjs/react.development.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>E esse √© o √∫nico local em que seu empacotador interpolar√° <code class=\"language-text\">&#39;development&#39;</code> ou <code class=\"language-text\">&#39;production&#39;</code> como uma string e o seu minificador se livrar√° do somente <code class=\"language-text\">necess√°rio</code> para o desenvolvimento.</p>\n<p>Tanto o <code class=\"language-text\">react.production.min.js</code> quanto o <code class=\"language-text\">react.development.js</code> n√£o t√™m mais nenhuma verifica√ß√£o do <code class=\"language-text\">process.env.NODE_ENV</code>. Isso √© √≥timo porque <em>ao executar o Node.js</em>, o acesso ao <code class=\"language-text\">process.env</code> √© <a href=\"https://reactjs.org/blog/2017/09/26/react-v16.0.html#better-server-side-rendering\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">um pouco lento</a>. A compila√ß√£o antecipada de pacotes nos dois modos tamb√©m permite otimizar o tamanho do arquivo <a href=\"https://reactjs.org/blog/2017/09/26/react-v16.0.html#reduced-file-size\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">com muito mais consist√™ncia</a>, independentemente de qual bundler ou minificador voc√™ est√° usando.</p>\n<p>E √© assim que realmente funciona!</p>\n<hr>\n<p>Eu gostaria que houvesse uma maneira mais de primeira classe de fazer isso sem depender de conven√ß√µes, mas aqui estamos. Seria √≥timo se os modos fossem um conceito de primeira classe em todos os ambientes JavaScript e se houvesse alguma maneira de um navegador mostrar que algum c√≥digo est√° sendo executado em um modo de desenvolvimento quando n√£o deveria.</p>\n<p>Por outro lado, √© fascinante como uma conven√ß√£o em um √∫nico projeto pode se propagar pelo ecossistema. <code class=\"language-text\">EXPRESS_ENV</code> <a href=\"https://github.com/expressjs/express/commit/03b56d8140dc5c2b574d410bfeb63517a0430451\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">se tornou <code class=\"language-text\">NODE_ENV</code></a> em 2010 e <a href=\"https://github.com/hughsk/envify/commit/ae8aa26b759cd2115eccbed96f70e7bbdceded97\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">espalhou para o front-end</a> em 2013. Talvez a solu√ß√£o n√£o seja perfeita, mas para cada projeto o custo de adot√°-la foi menor do que o custo de convencer os outros a fazer algo diferente. Isso ensina uma li√ß√£o valiosa sobre a ado√ß√£o de cima para baixo versus de baixo para cima. A compreens√£o de como essa din√¢mica ocorre distingue as tentativas bem-sucedidas de tentativas de padroniza√ß√£o mal sucedidas.</p>\n<p>Separar os modos de desenvolvimento e produ√ß√£o √© uma t√©cnica muito √∫til. Eu recomendo us√°-lo em suas bibliotecas e no c√≥digo de aplica√ß√µes que os tipos de verifica√ß√µes s√£o muito caras para fazer na produ√ß√£o, mas s√£o valiosas (e geralmente cr√≠ticas!) de fazer no desenvolvimento.</p>\n<p>Como em qualquer recurso poderoso, existem algumas maneiras de us√°-lo incorretamente. Este ser√° o t√≥pico do meu pr√≥ximo post!</p>","timeToRead":11,"frontmatter":{"title":"Como Funciona o Mode de Desenvolvimento?","date":"August 04, 2019","spoiler":"Elimina√ß√£o de c√≥digo morto por conven√ß√£o.","cta":null},"fields":{"slug":"/pt-br/how-does-the-development-mode-work/","langKey":"pt-br"}}},"pageContext":{"slug":"/pt-br/how-does-the-development-mode-work/","translations":["zh-hans","ko","pt-br","es"],"translatedLinks":[]}}}