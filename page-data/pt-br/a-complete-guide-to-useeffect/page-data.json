{"componentChunkName":"component---src-templates-blog-post-js","path":"/pt-br/a-complete-guide-to-useeffect/","result":{"data":{"site":{"siteMetadata":{"title":"Overreacted","author":"Dan Abramov"}},"markdownRemark":{"id":"e03b393c-40d2-57f6-b4ed-24134176a49b","html":"<p>VocÃª escreveu alguns componentes com <a href=\"https://reactjs.org/docs/hooks-intro.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Hooks</a>. Talvez atÃ© um pequeno app. AtÃ© entÃ£o vocÃª estÃ¡ satisfeito. EstÃ¡ confortÃ¡vel com a API e aprendeu alguns truques durante o caminho. VocÃª atÃ© <a href=\"https://reactjs.org/docs/hooks-custom.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">criou alguns Hooks personalizados</a> para extrair lÃ³gica repetitiva (lÃ¡ se foram 300 linhas!) e mostrou tudo isso para seus colegas. â€œÃ“timo trabalho!â€, eles disseram.</p>\n<p>Mas, algumas vezes, quando vocÃª usa <code class=\"language-text\">useEffect</code>, os pedaÃ§os nÃ£o se encaixam muito bem. VocÃª tem aquela sensaÃ§Ã£o incÃ´moda de que estÃ¡ perdendo alguma coisa. Parece semelhante aos ciclos de vida das classesâ€¦mas Ã© mesmo? VocÃª se encontra fazendo perguntas como:</p>\n<ul>\n<li>ğŸ¤” Como faÃ§o para replicar <code class=\"language-text\">componentDidMount</code> com <code class=\"language-text\">useEffect</code>?</li>\n<li>ğŸ¤” Como faÃ§o para buscar dados corretamente dentro de <code class=\"language-text\">useEffect</code>? O que Ã© <code class=\"language-text\">[]</code>?</li>\n<li>ğŸ¤” Preciso especificar funÃ§Ãµes como dependÃªncias do efeito ou nÃ£o?</li>\n<li>ğŸ¤” Por que Ã s vezes recebo um loop infinito na busca de dados?</li>\n<li>ğŸ¤” Por que Ã s vezes recebo um <em>state</em> ou <em>props</em> antiga dentro do meu efeito?</li>\n</ul>\n<p>Quando comecei a usar o Hooks, tambÃ©m fiquei confuso com todas essas perguntas. Mesmo ao escrever os documentos iniciais, eu nÃ£o tinha uma compreensÃ£o firme de algumas das sutilezas. Desde entÃ£o, tive alguns momentos â€œahaâ€ que quero compartilhar com vocÃª. <strong>Faremos um mergulho profundo nesses detalhes, trazendo a superfÃ­cie as respostas a essas perguntas, que no final, parecerÃ£o Ã³bvias para vocÃª.</strong></p>\n<p>Para <strong>ver</strong> essas respostas, precisamos dar um passo para trÃ¡s. O objetivo deste artigo nÃ£o Ã© fornecer uma lista de receitas. Ã‰ para ajudar vocÃª a realmente â€œclicarâ€ o <code class=\"language-text\">useEffect</code>. NÃ£o haverÃ¡ muito a aprender. Na verdade, passaremos a maior parte do tempo <em>desaprendendo</em>.</p>\n<p><strong>SÃ³ depois que parei de olhar para o Hook <code class=\"language-text\">useEffect</code> atravÃ©s do prisma que estou acostumado dos mÃ©todos de ciclo de vida de classes, que todas as peÃ§as se juntaram para mim.</strong></p>\n<blockquote>\n<p>â€œDesaprenda o que vocÃª aprendeu.â€ â€” Yoda</p>\n</blockquote>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6203a1f1f2c771816a5ba0969baccd12/fce5f/yoda.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 497px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 64.1891891891892%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAQBAwX/xAAXAQADAQAAAAAAAAAAAAAAAAAAAQID/9oADAMBAAIQAxAAAAF5WKs71REF/8QAGxAAAQUBAQAAAAAAAAAAAAAAAgABAxESEyH/2gAIAQEAAQUCvzvk9Woz0njdBK5j/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFREBAQAAAAAAAAAAAAAAAAAAEBH/2gAIAQIBAT8Bh//EAB0QAAICAQUAAAAAAAAAAAAAAAABAhEhMTJBUZH/2gAIAQEABj8CK4Nno10Obm8FvU//xAAbEAEBAQEAAwEAAAAAAAAAAAABEQAhMVFxgf/aAAgBAQABPyH0Zd076TuCbR9Rz80qZiwUvg37TTf/2gAMAwEAAgADAAAAEEPf/8QAGBEAAgMAAAAAAAAAAAAAAAAAAAERMUH/2gAIAQMBAT8QlaUf/8QAFhEBAQEAAAAAAAAAAAAAAAAAAQAx/9oACAECAQE/EFOQF//EABwQAQEAAgIDAAAAAAAAAAAAAAERACExQVFx0f/aAAgBAQABPxA0TUOLkyoSi0+4SldSl6yfaQttpzhvHAwULvWAwOi0F8zP/9k='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Yoda cheirando o ar. Legenda: â€œSinto cheiro de bacon.â€\"\n        title=\"\"\n        src=\"/static/6203a1f1f2c771816a5ba0969baccd12/fce5f/yoda.jpg\"\n        srcset=\"/static/6203a1f1f2c771816a5ba0969baccd12/a80bd/yoda.jpg 148w,\n/static/6203a1f1f2c771816a5ba0969baccd12/1c91a/yoda.jpg 295w,\n/static/6203a1f1f2c771816a5ba0969baccd12/fce5f/yoda.jpg 497w\"\n        sizes=\"(max-width: 497px) 100vw, 497px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<hr>\n<p><strong>Este artigo assume que vocÃª esteja familiarizado com a API do <a href=\"https://reactjs.org/docs/hooks-effect.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">useEffect</code></a>.</strong></p>\n<p><strong>TambÃ©m Ã© <em>muito</em> longo. Ã‰ como um mini-livro. Esse Ã© apenas o meu formato preferido. Mas eu escrevi um TLDR logo abaixo se vocÃª estÃ¡ com pressa ou nÃ£o se importa.</strong></p>\n<p><strong>Se vocÃª nÃ£o se sentir confortÃ¡vel com guias que mergulham profundo nos detalhes, espere atÃ© que essas explicaÃ§Ãµes apareÃ§am em outro lugar. Assim como quando o React saiu em 2013, levarÃ¡ algum tempo para que as pessoas reconheÃ§am um modelo mental diferente e o ensinem.</strong></p>\n<hr>\n<h2 id=\"tldr\"><a href=\"#tldr\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TLDR</h2>\n<p>Aqui estÃ¡ um rÃ¡pido TLDR se vocÃª nÃ£o quiser ler a coisa toda. Se algumas partes nÃ£o fizerem sentido, vocÃª pode rolar para baixo atÃ© encontrar algo relacionado.</p>\n<p>Sinta-se livre para ignorÃ¡-lo se vocÃª pretende ler o post inteiro. TambÃ©m vou vinculÃ¡-lo no final.</p>\n<p><strong>ğŸ¤” Pergunta: Como faÃ§o para replicar <code class=\"language-text\">componentDidMount</code> com <code class=\"language-text\">useEffect</code>?</strong></p>\n<p>Embora vocÃª possa usar o <code class=\"language-text\">useEffect(fn, [])</code>, nÃ£o Ã© um equivalente exato. Ao contrÃ¡rio do <code class=\"language-text\">componentDidMount</code>, ele irÃ¡ capturar <em>props</em> e <em>state</em>. Assim, mesmo dentro dos retornos de chamada, vocÃª verÃ¡ os valores iniciais de <em>props</em> e <em>state</em>. Se vocÃª quiser ver algo â€œmais recenteâ€, vocÃª pode escrever uma <em>ref</em> para isso. Mas normalmente hÃ¡ uma maneira mais simples de estruturar o cÃ³digo para que vocÃª nÃ£o precise fazer isso. Tenha em mente que o modelo mental para efeitos Ã© diferente de <code class=\"language-text\">componentDidMount</code> e outros ciclos de vida, e tentar encontrar seus equivalentes exatos pode te confundir mais do que ajudar. Para se tornar produtivo, vocÃª precisa â€œpensar em efeitosâ€, e o modelo mental deles estÃ¡ mais perto de â€œimplementar a sincronizaÃ§Ã£oâ€ do que â€œresponder a eventos do ciclo de vidaâ€.</p>\n<p><strong>ğŸ¤” Pergunta: Como faÃ§o para buscar dados corretamente dentro de <code class=\"language-text\">useEffect</code>? O que Ã© <code class=\"language-text\">[]</code>?</strong></p>\n<p><a href=\"https://www.robinwieruch.de/react-hooks-fetch-data/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Este artigo</a> Ã© um bom manual sobre como buscar dados com <code class=\"language-text\">useEffect</code>. Certifique-se de ler atÃ© o fim! NÃ£o Ã© tÃ£o longo como este. <code class=\"language-text\">[]</code> significa que o efeito nÃ£o usa nenhum valor que participa do fluxo de dados do React e, por esse motivo, Ã© seguro para ser aplicado apenas uma vez. TambÃ©m Ã© uma fonte comum de erros quando o valor Ã© realmente usado. VocÃª precisarÃ¡ aprender algumas estratÃ©gias (principalmente <code class=\"language-text\">useReducer</code> e <code class=\"language-text\">useCallback</code>) que podem remover a necessidade de uma dependÃªncia, ao invÃ©s de omitir isso incorretamente.</p>\n<p><strong>ğŸ¤” Pergunta: Preciso especificar funÃ§Ãµes como dependÃªncias do efeito ou nÃ£o?</strong></p>\n<p>A recomendaÃ§Ã£o Ã© mover funÃ§Ãµes que nÃ£o precisam de <em>props</em> ou <em>state</em> para fora do seu componente e extrair aquelas que sÃ£o usadas apenas por um efeito, para dentro desse efeito. Se mesmo depois disso, o efeito ainda acabar usando funÃ§Ãµes do escopo da renderizaÃ§Ã£o (incluindo funÃ§Ãµes vindas de <em>props</em>), envolva-as em <code class=\"language-text\">useCallback</code> aonde elas estiverem definidas e repita o processo. Por que isso Ã© importante? FunÃ§Ãµes podem â€œverâ€ valores de <em>props</em> e <em>state</em>, significa eles participam do fluxo de dados do React.</p>\n<p><strong>ğŸ¤” Pergunta: Por que Ã s vezes recebo um loop infinito na busca de dados?</strong></p>\n<p>Isso pode acontecer se vocÃª estiver buscando dados em um efeito sem o segundo argumento de dependÃªncias. Sem ele, os efeitos sÃ£o executados apÃ³s cada renderizaÃ§Ã£o - e definindo um novo estado acionarÃ¡ os efeitos novamente. Um loop infinito tambÃ©m pode acontecer se vocÃª especificar um valor que sempre muda no array de dependÃªncias. VocÃª pode descobrir qual deles, removendo-os um por um. No entanto, remover uma dependÃªncia usada (ou especificar cegamente <code class=\"language-text\">[]</code>) geralmente Ã© uma correÃ§Ã£o incorreta. Ao invÃ©s disso, corrija o problema na sua origem. Por exemplo, funÃ§Ãµes podem causar esse problema e colocÃ¡-las dentro de efeitos, movendo-as ou envolvendo-as com o uso de <code class=\"language-text\">useCallback</code>. Para evitar a recriaÃ§Ã£o de objetos, o <code class=\"language-text\">useMemo</code> pode servir a um propÃ³sito semelhante.</p>\n<p><strong>ğŸ¤” Pergunta: Por que Ã s vezes recebo um <em>state</em> ou <em>props</em> antiga dentro do meu efeito?</strong></p>\n<p>Os efeitos sempre podem â€œverâ€ as <em>props</em> e <em>state</em> da renderizaÃ§Ã£o em que foram definidos. <a href=\"https://overreacted.io/how-are-function-components-different-from-classes/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Isso ajuda a evitar erros</a>, mas em alguns casos pode ser irritante. Para esses casos, vocÃª pode manter, explicitamente, algum valor em uma <em>ref</em> mutÃ¡vel (o artigo do link explica isso no final). Se vocÃª acha que estÃ¡ vendo <em>props</em> ou <em>state</em> a de uma renderizaÃ§Ã£o antiga, mas nÃ£o Ã© o que vocÃª espera, vocÃª provavelmente deixou passar alguma dependÃªncia. Tente usar a <a href=\"https://github.com/facebook/react/issues/14920\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">regra do linter</a> para te treinar a exergÃ¡-los. Depois de alguns dias, serÃ¡ como uma segunda natureza para vocÃª. Veja tambÃ©m <a href=\"https://reactjs.org/docs/hooks-faq.html#why-am-i-seeing-stale-props-or-state-inside-my-function\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">essa reposta</a> no nosso FAQ.</p>\n<hr>\n<p>Espero que este TLDR tenha sido Ãºtil! Caso contrÃ¡rio, vamos continuar.</p>\n<hr>\n<h2 id=\"cada-renderizaÃ§Ã£o-tem-seus-prÃ³prios-props-e-state\"><a href=\"#cada-renderiza%C3%A7%C3%A3o-tem-seus-pr%C3%B3prios-props-e-state\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cada renderizaÃ§Ã£o tem seus prÃ³prios <em>props</em> e <em>state</em></h2>\n<p>Antes de falarmos sobre efeitos, precisamos falar sobre renderizaÃ§Ã£o.</p>\n<p>Aqui estÃ¡ um contador. Olhe a linha destacada de perto:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Counter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">You clicked </span><span class=\"token punctuation\">{</span>count<span class=\"token punctuation\">}</span><span class=\"token plain-text\"> times</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span></span><span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span>count <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">        Click me</span>\n<span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>O que isso significa? SerÃ¡ que <code class=\"language-text\">count</code>, de alguma forma, â€œfica olhandoâ€ as alteraÃ§Ãµes ao nosso estado e atualiza automaticamente? Essa pode ser uma primeira intuiÃ§Ã£o quando vocÃª aprende React, mas nÃ£o Ã© um <a href=\"https://overreacted.io/react-as-a-ui-runtime/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">modelo mental preciso</a>.</p>\n<p>Neste exemplo, <code class=\"language-text\">count</code> Ã© apenas um nÃºmero. NÃ£o Ã© uma mÃ¡gica de â€œligaÃ§Ã£o de dadosâ€ (<strong>data binding</strong>), um â€œobservadorâ€ (<strong>watcher</strong>), um â€œproxyâ€ ou qualquer outra coisa. Ã‰ um bom e antigo nÃºmero como este:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> count <span class=\"token operator\">=</span> <span class=\"token number\">42</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ...</span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">You clicked </span><span class=\"token punctuation\">{</span>count<span class=\"token punctuation\">}</span><span class=\"token plain-text\"> times</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n<span class=\"token comment\">// ...</span></code></pre></div>\n<p>A primeira vez que nosso componente renderiza, a variÃ¡vel <code class=\"language-text\">count</code> que obtemos de <code class=\"language-text\">useState()</code> Ã© <code class=\"language-text\">0</code>. Quando chamamos <code class=\"language-text\">setCount(1)</code>, o React chama nosso componente novamente. Desta vez, a contagem serÃ¡ <code class=\"language-text\">1</code>. E assim por diante:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// Durante primeira renderizaÃ§Ã£o</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">Counter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> count <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Returned by useState()</span></span>  <span class=\"token comment\">// ...</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">You clicked </span><span class=\"token punctuation\">{</span>count<span class=\"token punctuation\">}</span><span class=\"token plain-text\"> times</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// ApÃ³s um clique, nossa funÃ§Ã£o Ã© chamada novamente</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">Counter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> count <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Returned by useState()</span></span>  <span class=\"token comment\">// ...</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">You clicked </span><span class=\"token punctuation\">{</span>count<span class=\"token punctuation\">}</span><span class=\"token plain-text\"> times</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// ApÃ³s outro clique, nossa funÃ§Ã£o Ã© chamada novamente</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">Counter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> count <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Returned by useState()</span></span>  <span class=\"token comment\">// ...</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">You clicked </span><span class=\"token punctuation\">{</span>count<span class=\"token punctuation\">}</span><span class=\"token plain-text\"> times</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>Sempre que atualizamos o estado, o React chama nosso componente. Cada renderizaÃ§Ã£o â€œvÃªâ€ seu prÃ³prio valor de <code class=\"language-text\">count</code>, que Ã© uma <em>constante</em> dentro de nossa funÃ§Ã£o.</strong></p>\n<p>Portanto, essa linha nÃ£o faz nenhuma ligaÃ§Ã£o de dados especial:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">You clicked </span><span class=\"token punctuation\">{</span>count<span class=\"token punctuation\">}</span><span class=\"token plain-text\"> times</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p><strong>Ela apenas incorpora um valor numÃ©rico na saÃ­da de renderizaÃ§Ã£o.</strong> Esse nÃºmero Ã© fornecido pelo React. Quando chamamos <code class=\"language-text\">setCount</code>, React chama nosso componente novamente com um valor de contagem diferente. Em seguida, o React atualiza o DOM para corresponder Ã  nossa nova saÃ­da de renderizaÃ§Ã£o.</p>\n<p>A principal conclusÃ£o Ã© que a constante <code class=\"language-text\">count</code>, em qualquer renderizaÃ§Ã£o, nÃ£o muda com o tempo. Ã‰ nosso componente que Ã© chamado novamente e cada renderizaÃ§Ã£o â€œvÃªâ€ seu prÃ³prio valor de contagem isolado entre renderizaÃ§Ãµes.</p>\n<p><em>(Para uma visÃ£o detalhada desse processo, confira meu post <a href=\"https://overreacted.io/react-as-a-ui-runtime/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">React as a UI Runtime</a>.)</em></p>\n<h2 id=\"cada-renderizaÃ§Ã£o-tem-seus-prÃ³prios-manipuladores-de-eventos\"><a href=\"#cada-renderiza%C3%A7%C3%A3o-tem-seus-pr%C3%B3prios-manipuladores-de-eventos\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cada renderizaÃ§Ã£o tem seus prÃ³prios manipuladores de eventos</h2>\n<p>Por enquanto, tudo bem. E quanto aos manipuladores de eventos?</p>\n<p>Veja este exemplo. Ele mostra um alerta com <code class=\"language-text\">count</code> apÃ³s trÃªs segundos:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Counter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">function</span> <span class=\"token function\">handleAlertClick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'You clicked on: '</span> <span class=\"token operator\">+</span> count<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span></span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">You clicked </span><span class=\"token punctuation\">{</span>count<span class=\"token punctuation\">}</span><span class=\"token plain-text\"> times</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span>count <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">        Click me</span>\n<span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>handleAlertClick<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span></span><span class=\"gatsby-highlight-code-line\"><span class=\"token plain-text\">        Show alert</span></span><span class=\"gatsby-highlight-code-line\"><span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span></span><span class=\"token plain-text\">    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Digamos que eu faÃ§a a seguinte sequÃªncia de etapas:</p>\n<ul>\n<li><strong>Incrementar</strong> o contador 3 vezes</li>\n<li><strong>Pressionar</strong> â€œMostrar alertaâ€</li>\n<li><strong>Incrementar</strong> o contador para 5 antes que o tempo limite seja disparado</li>\n</ul>\n<p><img src=\"/46c55d5f1f749462b7a173f1e748e41e/counter.gif\" alt=\"DemonstraÃ§Ã£o do Counter\"></p>\n<p>O que vocÃª espera que o alerta mostre? VocÃª espera que seja 5 - que Ã© o estado do contador no momento do alerta? Ou que irÃ¡ mostrar 3 - o estado quando eu cliquei?</p>\n<hr>\n<p><em>spoilers Ã  frente</em></p>\n<hr>\n<p>VÃ¡ em frente e <a href=\"https://codesandbox.io/s/w2wxl3yo0l\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">tente vocÃª mesmo!</a></p>\n<p>Se o comportamento nÃ£o fizer muito sentido para vocÃª, imagine um exemplo mais prÃ¡tico: um aplicativo de bate-papo com o ID do destinatÃ¡rio atual no estado e um botÃ£o Enviar. <a href=\"https://overreacted.io/how-are-function-components-different-from-classes/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Este artigo</a> explora as razÃµes em profundidade, mas a resposta correta Ã© 3.</p>\n<p>O alerta irÃ¡ â€œcapturarâ€ o estado no momento em que eu cliquei no botÃ£o.</p>\n<p><em>(TambÃ©m existem maneiras de implementar o outro comportamento, mas vou me concentrar no caso padrÃ£o por enquanto. Ao construir um modelo mental, Ã© importante distinguir o â€œcaminho de menor resistÃªnciaâ€ das saÃ­das de emergÃªncia que vocÃª pode utilizar uma vez ou outra.)</em></p>\n<hr>\n<p>Mas como isso funciona?</p>\n<p>NÃ³s vimos que o valor <code class=\"language-text\">count</code> Ã© uma constante para cada chamada especÃ­fica da nossa funÃ§Ã£o. Vale a pena enfatizar isso - <strong>nossa funÃ§Ã£o Ã© chamada muitas vezes (uma vez para cada renderizaÃ§Ã£o), mas em cada uma dessas vezes o valor de <code class=\"language-text\">count</code> dentro dela Ã© constante e configurado para um valor especÃ­fico (o estado para aquela renderizaÃ§Ã£o).</strong></p>\n<p>Isso nÃ£o Ã© especÃ­fico do React - o comportamento regular de funÃ§Ãµes funcionam de maneira semelhante:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">sayHi</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">person</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> name <span class=\"token operator\">=</span> person<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">;</span></span>  <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Hello, '</span> <span class=\"token operator\">+</span> name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">let</span> someone <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>name<span class=\"token operator\">:</span> <span class=\"token string\">'Dan'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">sayHi</span><span class=\"token punctuation\">(</span>someone<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nsomeone <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>name<span class=\"token operator\">:</span> <span class=\"token string\">'Yuzhi'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">sayHi</span><span class=\"token punctuation\">(</span>someone<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nsomeone <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>name<span class=\"token operator\">:</span> <span class=\"token string\">'Dominic'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">sayHi</span><span class=\"token punctuation\">(</span>someone<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Nesse <a href=\"https://codesandbox.io/s/mm6ww11lk8\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">exemplo</a>, a variÃ¡vel externa <code class=\"language-text\">someone</code> Ã© reatribuÃ­da vÃ¡rias vezes. (Assim como em algum lugar no React, o estado <em>atual</em> do component pode mudar.) <strong>No entanto, no interior de <code class=\"language-text\">sayHi</code>, hÃ¡ uma constante local chamada <code class=\"language-text\">name</code> associada a uma <code class=\"language-text\">person</code> de uma chamada especÃ­fica.</strong> Essa constante Ã© local, por isso Ã© isolado entre as chamadas! Como resultado, quando os temporizadores sÃ£o acionados, cada alerta â€œlembraâ€ o prÃ³prio <code class=\"language-text\">name</code>.</p>\n<p>Isso explica como o manipulador de eventos captura <code class=\"language-text\">count</code> no momento do clique. Se aplicarmos o mesmo princÃ­pio de substituiÃ§Ã£o, cada render â€œvÃªâ€ o seu prÃ³prio <code class=\"language-text\">count</code>:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// Durante primeira renderizaÃ§Ã£o</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">Counter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> count <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Returned by useState()</span></span>  <span class=\"token comment\">// ...</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">handleAlertClick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'You clicked on: '</span> <span class=\"token operator\">+</span> count<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// ApÃ³s um clique, nossa funÃ§Ã£o Ã© chamada novamente</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">Counter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> count <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Returned by useState()</span></span>  <span class=\"token comment\">// ...</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">handleAlertClick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'You clicked on: '</span> <span class=\"token operator\">+</span> count<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// ApÃ³s outro clique, nossa funÃ§Ã£o Ã© chamada novamente</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">Counter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> count <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Returned by useState()</span></span>  <span class=\"token comment\">// ...</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">handleAlertClick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'You clicked on: '</span> <span class=\"token operator\">+</span> count<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>EntÃ£o, efetivamente, cada render retorna sua prÃ³pria â€œversÃ£oâ€ de <code class=\"language-text\">handleAlertClick</code>. Cada uma dessas versÃµes â€œlembraâ€ o seu prÃ³prio valor de <code class=\"language-text\">count</code>:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// Durante primeira renderizaÃ§Ã£o</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">Counter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">handleAlertClick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">      <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'You clicked on: '</span> <span class=\"token operator\">+</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>handleAlertClick<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span> <span class=\"token comment\">// Com 0 dentro</span></span>  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// ApÃ³s um clique, nossa funÃ§Ã£o Ã© chamada novamente</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">Counter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">handleAlertClick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">      <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'You clicked on: '</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>handleAlertClick<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span> <span class=\"token comment\">// Com 1 dentro</span></span>  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// ApÃ³s outro clique, nossa funÃ§Ã£o Ã© chamada novamente</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">Counter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">handleAlertClick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">      <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'You clicked on: '</span> <span class=\"token operator\">+</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>handleAlertClick<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span> <span class=\"token comment\">// Com 2 dentro</span></span>  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Ã‰ por isso que <a href=\"https://codesandbox.io/s/w2wxl3yo0l\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">nesse exemplo</a>, os manipuladores de eventos â€œpertencemâ€ a uma determinada renderizaÃ§Ã£o e quando vocÃª clica, ele mantÃ©m com o estado de <code class=\"language-text\">counter</code> daquela renderizaÃ§Ã£o.</p>\n<p><strong>Dentro de qualquer renderizaÃ§Ã£o em particular, os objetos e o estado permanecem para sempre iguais.</strong> Mas se <em>props</em> e <em>state</em> forem isolados entre renderizadores, o mesmo acontecerÃ¡ com qualquer valor usando-os (incluindo os manipuladores de eventos). Eles tambÃ©m â€œpertencemâ€ a uma renderizaÃ§Ã£o especÃ­fica. Assim, mesmo as funÃ§Ãµes assÃ­ncronas dentro de um manipulador de eventos â€œirÃ£o verâ€ o mesmo valor de <code class=\"language-text\">count</code>.</p>\n<p><em>Nota: eu adicionei valores literais do <code class=\"language-text\">count</code> diretamente nas funÃ§Ãµes <code class=\"language-text\">handleAlertClick</code> acima. Essa substituiÃ§Ã£o mental Ã© segura pois <code class=\"language-text\">count</code> nÃ£o pode ser alterado em uma renderizaÃ§Ã£o especÃ­fica. Ã‰ declarado como uma <code class=\"language-text\">const</code> e Ã© um nÃºmero. Seria seguro pensar da mesma maneira sobre outros valores, como objetos, mas somente se concordarmos em evitar mutaÃ§Ã£o no estado. Chamar <code class=\"language-text\">setSomething(newObj)</code> com um novo objeto recÃ©m-criado, ao invÃ©s de mutÃ¡-lo, Ã© bom pois o estado pertencente a renderizaÃ§Ãµes anteriores ficarÃ¡ intacto.</em></p>\n<h2 id=\"cada-renderizaÃ§Ã£o-tem-seus-prÃ³prios-efeitos\"><a href=\"#cada-renderiza%C3%A7%C3%A3o-tem-seus-pr%C3%B3prios-efeitos\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cada renderizaÃ§Ã£o tem seus prÃ³prios efeitos</h2>\n<p>Este deveria ser um post sobre efeitos, mas ainda nÃ£o falamos sobre eles ainda! NÃ³s vamos corrigir isso agora. Acontece que os efeitos nÃ£o sÃ£o realmente diferentes.</p>\n<p>Vamos voltar a um <a href=\"https://reactjs.org/docs/hooks-effect.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">exemplo da documentaÃ§Ã£o</a>:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Counter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">    document<span class=\"token punctuation\">.</span>title <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">You clicked </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>count<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> times</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">You clicked </span><span class=\"token punctuation\">{</span>count<span class=\"token punctuation\">}</span><span class=\"token plain-text\"> times</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span>count <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">        Click me</span>\n<span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>Aqui estÃ¡ uma pergunta para vocÃª: como fazer para que o efeito leia o estado mais recente de <code class=\"language-text\">count</code>?</strong></p>\n<p>Talvez haja algum tipo de â€œvinculaÃ§Ã£o de dadosâ€ ou â€œobservaÃ§Ã£oâ€ que faÃ§a a atualizaÃ§Ã£o contÃ­nua de <code class=\"language-text\">count</code> dentro da funÃ§Ã£o de efeito? Talvez <code class=\"language-text\">count</code> seja uma variÃ¡vel mutÃ¡vel que o React define dentro de nosso componente para que nosso efeito sempre tenha o valor mais recente?</p>\n<p>NÃ£o.</p>\n<p>NÃ³s jÃ¡ sabemos que <code class=\"language-text\">count</code> Ã© constante dentro de uma determinada renderizaÃ§Ã£o. Os manipuladores de eventos â€œveemâ€ o estado de <code class=\"language-text\">count</code> da renderizaÃ§Ã£o que eles â€œpertencemâ€ pois <code class=\"language-text\">count</code> Ã© uma variÃ¡vel dentro do seu escopo. O mesmo Ã© verdade para efeitos!</p>\n<p><strong>NÃ£o Ã© a variÃ¡vel <code class=\"language-text\">count</code> que de alguma forma mudou dentro de um efeito â€œimutÃ¡velâ€. Ã‰ a <em>funÃ§Ã£o do efeito em si</em> que Ã© diferente em cada renderizaÃ§Ã£o.</strong></p>\n<p>Cada versÃ£o â€œvÃªâ€ o valor de <code class=\"language-text\">count</code> da renderizaÃ§Ã£o que ela â€œpertenceâ€:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// Durante primeira renderizaÃ§Ã£o</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">Counter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token comment\">// FunÃ§Ã£o de efeito da primeira renderizaÃ§Ã£o</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">      document<span class=\"token punctuation\">.</span>title <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">You clicked </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token number\">0</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> times</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">}</span></span>  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// ApÃ³s um clique, nossa funÃ§Ã£o Ã© chamada novamente</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">Counter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token comment\">// FunÃ§Ã£o de efeito da segunda renderizaÃ§Ã£o</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">      document<span class=\"token punctuation\">.</span>title <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">You clicked </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token number\">1</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> times</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">}</span></span>  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// ApÃ³s outro clique, nossa funÃ§Ã£o Ã© chamada novamente</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">Counter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token comment\">// FunÃ§Ã£o de efeito da terceira renderizaÃ§Ã£o</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">      document<span class=\"token punctuation\">.</span>title <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">You clicked </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token number\">2</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> times</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">}</span></span>  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// ..</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>O React lembra a funÃ§Ã£o de efeito que vocÃª forneceu e a executa depois de liberar as alteraÃ§Ãµes para o DOM e permitir que o navegador pinte a tela.</p>\n<p>Mesmo se falarmos de um conceitual Ãºnico <em>efeito</em> aqui (atualizando o tÃ­tulo do documento), ele Ã© representado por uma <em>funÃ§Ã£o diferente</em> em cada renderizaÃ§Ã£o - e cada funÃ§Ã£o de efeito â€œvÃªâ€ suas <em>props</em> e <em>state</em> da renderizaÃ§Ã£o especÃ­fica Ã  qual ele â€œpertenceâ€.</p>\n<p><strong>Conceitualmente, vocÃª pode imaginar que os efeitos <em>fazem parte do resultado da renderizaÃ§Ã£o</em>.</strong></p>\n<p>Falando rigorosamente, eles nÃ£o sÃ£o (tudo isso para <a href=\"https://overreacted.io/why-do-hooks-rely-on-call-order/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">permitir a composiÃ§Ã£o do Hook</a> sem uma sintaxe grotesca ou com alguma sobrecarga em tempo de execuÃ§Ã£o). No modelo mental que estamos construindo, as funÃ§Ãµes de efeito pertencem a uma renderizaÃ§Ã£o especÃ­fica, da mesma maneira que os manipuladores de eventos.</p>\n<hr>\n<p>Para ter certeza de que temos uma sÃ³lida compreensÃ£o, vamos recapitular nossa primeira renderizaÃ§Ã£o:</p>\n<ul>\n<li><strong>React</strong>: Me retorna a interface do usuÃ¡rio quando o estado Ã© <code class=\"language-text\">0</code>.</li>\n<li>\n<p><strong>Seu Componente</strong>:</p>\n<ul>\n<li>Aqui estÃ¡ o resultado da renderizaÃ§Ã£o: <code class=\"language-text\">&lt;p&gt;You clicked 0 times&lt;/p&gt;</code>.</li>\n<li>Lembre-se de executar este efeito depois que vocÃª estiver pronto: <code class=\"language-text\">() =&gt; { document.title = &#39;You clicked 0 times&#39; }</code>.</li>\n</ul>\n</li>\n<li><strong>React</strong>: Claro. Atualizando a interface do usuÃ¡rio. OlÃ¡ navegador, estou adicionando algumas coisas ao DOM.</li>\n<li><strong>Navegador</strong>: Legal, eu pintei para a tela.</li>\n<li>\n<p><strong>React</strong>: OK, agora vou executar o efeito que vocÃª me deu.</p>\n<ul>\n<li>Executando: <code class=\"language-text\">() =&gt; { document.title = &#39;You clicked 0 times&#39; }</code>.</li>\n</ul>\n</li>\n</ul>\n<hr>\n<p>Agora vamos recapitular o que acontece depois que clicamos:</p>\n<ul>\n<li><strong>Seu componente</strong>: Ei React, defina meu estado como <code class=\"language-text\">1</code>.</li>\n<li><strong>React</strong>: Me retorna a interface do usuÃ¡rio quando o estado Ã© <code class=\"language-text\">1</code></li>\n<li>\n<p><strong>Seu componente</strong>:</p>\n<ul>\n<li>Aqui estÃ¡ o resultado da renderizaÃ§Ã£o: <code class=\"language-text\">&lt;p&gt;You clicked 1 times&lt;/p&gt;</code>.</li>\n<li>Lembre-se de executar este efeito depois que vocÃª estiver pronto: <code class=\"language-text\">() =&gt; { document.title = &#39;You clicked 1 times&#39; }</code>.</li>\n</ul>\n</li>\n<li><strong>React</strong>: Claro. Atualizando a interface do usuÃ¡rio. Ei navegador, eu mudei o DOM.</li>\n<li><strong>Navegador</strong>: Legal, eu pintei suas alteraÃ§Ãµes na tela.</li>\n<li>\n<p><strong>React</strong>: OK, agora eu vou executar o efeito que pertence a rendererizaÃ§Ã£o que acabei de fazer.</p>\n<ul>\n<li>Executando: <code class=\"language-text\">() =&gt; { document.title = &#39;You clicked 1 times&#39; }</code>.</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h2 id=\"cada-renderizaÃ§Ã£o-tem-seu-prÃ³prio-tudo\"><a href=\"#cada-renderiza%C3%A7%C3%A3o-tem-seu-pr%C3%B3prio-tudo\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cada renderizaÃ§Ã£o tem seu prÃ³prioâ€¦ tudo</h2>\n<p><strong>Sabemos agora que os efeitos sÃ£o executados apÃ³s cada renderizaÃ§Ã£o, sÃ£o conceitualmente parte da saÃ­da do componente e â€œveemâ€ os objetos e o estado a partir dessa renderizaÃ§Ã£o especÃ­fica.</strong></p>\n<p>Vamos tentar um experimento mental. Considere este cÃ³digo:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Counter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">You clicked </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>count<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> times</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">You clicked </span><span class=\"token punctuation\">{</span>count<span class=\"token punctuation\">}</span><span class=\"token plain-text\"> times</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span>count <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">        Click me</span>\n<span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Se eu clicar vÃ¡rias vezes com um pequeno <em>delay</em>, como o log de registros irÃ¡ ficar?</p>\n<hr>\n<p><em>spoilers Ã  frente</em></p>\n<hr>\n<p>VocÃª pode pensar que isso Ã© uma pegadinha e o resultado final nÃ£o Ã© intuitivo. NÃ£o Ã©! Vamos ver uma sequÃªncia de logs - cada um pertencente a uma renderizaÃ§Ã£o especÃ­fica e, portanto, com seu prÃ³prio valor de <code class=\"language-text\">count</code>. <a href=\"https://codesandbox.io/s/lyx20m1ol\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">VocÃª pode tentar aqui</a>:</p>\n<p><img src=\"/a5727d333c270e05942f508707265378/timeout_counter.gif\" alt=\"GravaÃ§Ã£o da tela com logs 1, 2, 3, 4, 5 em ordem\"></p>\n<p>VocÃª pode pensar: â€œClaro que Ã© assim que funciona! De que outra forma poderia funcionar?</p>\n<p>Bem, nÃ£o Ã© assim que <code class=\"language-text\">this.state</code> funciona em <code class=\"language-text\">class</code>. Ã‰ fÃ¡cil cometer o erro de pensar que <a href=\"https://codesandbox.io/s/kkymzwjqz3\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">essa implementaÃ§Ã£o</a> Ã© equivalente em <code class=\"language-text\">class</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">  <span class=\"token function\">componentDidUpdate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">You clicked </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>count<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> times</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p>No entanto, <code class=\"language-text\">this.state.count</code> sempre aponta para a contagem mais recente ao invÃ©s da que pertence a uma renderizaÃ§Ã£o especÃ­fica. EntÃ£o, vocÃª verÃ¡ <code class=\"language-text\">5</code> nos logs:</p>\n<p><img src=\"/264b329edc111a1973003bdf2bcacd65/timeout_counter_class.gif\" alt=\"GravaÃ§Ã£o da tela com logs 5, 5, 5, 5, 5 em ordem\"></p>\n<p>Eu acho irÃ´nico que os Hooks dependam tanto de <strong>closures</strong> em JavaScript, e ainda assim, Ã© a implementaÃ§Ã£o de classes que sofre com <a href=\"https://wsvincent.com/javascript-closure-settimeout-for-loop/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">a confusÃ£o canÃ´nica de valores errados em temporizadores</a> que Ã© freqÃ¼entemente associada com <strong>closures</strong>. Isso ocorre porque a fonte real da confusÃ£o neste exemplo Ã© a mutaÃ§Ã£o (o React faz mutaÃ§Ã£o em <code class=\"language-text\">this.state</code> nas classes para apontar para o estado mais recente) e nÃ£o na <strong>closures</strong> em si.</p>\n<p><strong>Closures sÃ£o Ã³timas quando os valores que vocÃª encapsula nunca mudam. Isso os torna fÃ¡ceis de se pensar porque vocÃª estÃ¡ essencialmente se referindo a uma constante.</strong> E como discutimos, <em>props</em> e <em>state</em> nunca mudam dentro de uma renderizaÃ§Ã£o especÃ­fica. A propÃ³sito, podemos consertar a versÃ£o de classeâ€¦utilizando <a href=\"https://codesandbox.io/s/w7vjo07055\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">uma <strong>closure</strong></a>.</p>\n<h2 id=\"nadando-contra-a-marÃ©\"><a href=\"#nadando-contra-a-mar%C3%A9\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Nadando contra a marÃ©</h2>\n<p>Neste ponto, Ã© importante falar explicitamente: cada funÃ§Ã£o dentro da renderizaÃ§Ã£o do componente (incluindo manipuladores de eventos, efeitos, temporizadores ou chamadas de API dentro delas) capturam <em>props</em> e <em>state</em> da chamada de renderizaÃ§Ã£o que a definiu.</p>\n<p>EntÃ£o, esses dois exemplos sÃ£o equivalentes:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Example</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">.</span>counter<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Example</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> counter <span class=\"token operator\">=</span> props<span class=\"token punctuation\">.</span>counter<span class=\"token punctuation\">;</span></span>  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>counter<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>NÃ£o importa se vocÃª lÃª as <em>props</em> ou as declara mais â€œcedoâ€ dentro do seu componente.</strong> Elas nÃ£o vÃ£o mudar! Dentro do escopo de uma Ãºnica renderizaÃ§Ã£o, as <em>props</em> e <em>state</em> permanecem as mesmas. (desestruturando as <em>props</em> tornam isso mais Ã³bvio.)</p>\n<p>Naturalmente, Ã s vezes vocÃª deseja ler o valor mais recente ao invÃ©s do que foi capturado, talvez em algum retorno de chamada definido em um efeito. A maneira mais fÃ¡cil de fazer isso Ã© usando refs, conforme descrito na Ãºltima seÃ§Ã£o <a href=\"https://overreacted.io/how-are-function-components-different-from-classes/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">deste artigo</a>.</p>\n<p>Fique ciente de que quando vocÃª quiser ler as <em>props</em> futuras, ou <em>state</em> de uma funÃ§Ã£o em uma renderizaÃ§Ã£o passada, vocÃª estarÃ¡ nadando contra a marÃ©. NÃ£o Ã© errado (e, em alguns casos, necessÃ¡rio), mas isso pode parecer menos â€œlimpoâ€, ao sair do paradigma. Essa Ã© uma consequÃªncia intencional porque ajuda a destacar qual cÃ³digo Ã© frÃ¡gil e depende de um tempo especÃ­fico. Nas <strong>class</strong>, Ã© menos Ã³bvio quando isso acontece.</p>\n<p>Aqui estÃ¡ uma <a href=\"https://codesandbox.io/s/rm7z22qnlp\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">versÃ£o do nosso contador</a> que replica o comportamento da classe:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Example</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> latestCount <span class=\"token operator\">=</span> <span class=\"token function\">useRef</span><span class=\"token punctuation\">(</span>count<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token comment\">// Define o Ãºltimo valor por mutaÃ§Ã£o</span></span><span class=\"gatsby-highlight-code-line\">    latestCount<span class=\"token punctuation\">.</span>current <span class=\"token operator\">=</span> count<span class=\"token punctuation\">;</span></span>    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">      <span class=\"token comment\">// Lendo o Ãºltimo valor da mutaÃ§Ã£o</span></span><span class=\"gatsby-highlight-code-line\">      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">You clicked </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>latestCount<span class=\"token punctuation\">.</span>current<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> times</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// ...</span></code></pre></div>\n<p><img src=\"/78f7948263dd13b023498b23cb99f4fc/timeout_counter_refs.gif\" alt=\"GravaÃ§Ã£o da tela com logs 5, 5, 5, 5, 5 em ordem\"></p>\n<p>Pode parecer estranho mutar algo em React. No entanto, Ã© exatamente assim que o prÃ³prio React reatribui <code class=\"language-text\">this.state</code> em classes. Ao contrÃ¡rio das <em>props</em> e <em>state</em> capturadas, vocÃª nÃ£o tem nenhuma garantia de que a leitura <code class=\"language-text\">latestCount.current</code> forneÃ§a o mesmo valor em qualquer chamada de retorno especÃ­fica. Por definiÃ§Ã£o, vocÃª pode alterÃ¡-lo a qualquer momento. Ã‰ por isso que nÃ£o Ã© um padrÃ£o, e vocÃª tem que optar manualmente por isso.</p>\n<h2 id=\"entÃ£o-o-que-acontece-no-momento-de-limpeza\"><a href=\"#ent%C3%A3o-o-que-acontece-no-momento-de-limpeza\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>EntÃ£o, o que acontece no momento de limpeza?</h2>\n<p>Como <a href=\"https://reactjs.org/docs/hooks-effect.html#effects-with-cleanup\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">a documentaÃ§Ã£o explica</a>, alguns efeitos podem ter uma fase de limpeza. Essencialmente, sua finalidade Ã© â€œdesfazerâ€ um efeito para casos como <strong>subscriptions</strong>.</p>\n<p>Considere este cÃ³digo:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    ChatAPI<span class=\"token punctuation\">.</span><span class=\"token function\">subscribeToFriendStatus</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span> handleStatusChange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      ChatAPI<span class=\"token punctuation\">.</span><span class=\"token function\">unsubscribeFromFriendStatus</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span> handleStatusChange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Vamos supor que <em>props</em> estÃ¡ em <code class=\"language-text\">{id: 10}</code> na primeira renderizaÃ§Ã£o e <code class=\"language-text\">{id: 20}</code> na segunda. VocÃª pode pensar que algo assim acontece:</p>\n<ul>\n<li>React limpa o efeito para <code class=\"language-text\">{id: 10}</code></li>\n<li>React renderiza a interface do usuÃ¡rio para <code class=\"language-text\">{id: 20}</code></li>\n<li>React executa o efeito para <code class=\"language-text\">{id: 20}</code></li>\n</ul>\n<p>(Esse nÃ£o Ã© bem o caso.)</p>\n<p>Com este modelo mental, vocÃª pode pensar que a limpeza â€œvÃªâ€ os objetos antigos porque ela executa antes de renderizar novamente, e entÃ£o o novo efeito â€œvÃªâ€ as novas <em>props</em> porque executa apÃ³s a re-renderizaÃ§Ã£o. Esse Ã© o modelo mental diretamente relacionado aos ciclos de vida das classes, e <strong>nÃ£o Ã© preciso nesse caso</strong>. Vamos ver o porque.</p>\n<p>React apenas executa os efeitos <a href=\"https://medium.com/@dan_abramov/this-benchmark-is-indeed-flawed-c3d6b5b6f97f\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">depois de deixar o navegador pintar as alteraÃ§Ãµes na tela</a>. Isso torna seu aplicativo mais rÃ¡pido, pois a maioria dos efeitos nÃ£o precisa bloquear as atualizaÃ§Ãµes de tela. A limpeza do efeito tambÃ©m Ã© atrasada. <strong>O efeito anterior Ã© limpo <em>apÃ³s</em> a nova renderizaÃ§Ã£o com novas <em>props</em></strong>:</p>\n<ul>\n<li><strong>React renderiza a interface do usuÃ¡rio para <code class=\"language-text\">{id: 20}</code>.</strong></li>\n<li>O navegador pinta a tela. NÃ³s vemos a interface do usuÃ¡rio para <code class=\"language-text\">{id: 20}</code>na tela.</li>\n<li><strong>React limpa o efeito para <code class=\"language-text\">{id: 10}</code>.</strong></li>\n<li>React executa o efeito para <code class=\"language-text\">{id: 20}</code>.</li>\n</ul>\n<p>VocÃª pode estar se perguntando: mas como a limpeza do efeito anterior ainda pode â€œverâ€ as <em>props</em> <code class=\"language-text\">{id: 10}</code> se ele foi executado depois que os adereÃ§os mudaram para <code class=\"language-text\">{id: 20}</code>?</p>\n<p>NÃ³s estivemos aqui antesâ€¦ğŸ¤”</p>\n<p><img src=\"/5fe238cf03a21dfa32af624124fcdcff/deja_vu.gif\" alt=\"DÃ©jÃ  vu (cena do gato do filme Matrix)\"></p>\n<p>Citando a seÃ§Ã£o anterior:</p>\n<blockquote>\n<p>Todas as funÃ§Ãµes dentro da renderizaÃ§Ã£o do componente (incluindo manipuladores de eventos, efeitos, temporizadores ou chamadas de API dentro delas) capturam <em>props</em> e <em>state</em> da chamada de renderizaÃ§Ã£o que a definiu.</p>\n</blockquote>\n<p>Agora a resposta Ã© clara! A limpeza do efeito nÃ£o lÃª as <em>props</em> â€œmais recentesâ€, o que quer que isso signifique. Ela lÃª as <em>props</em> que pertencem Ã  renderizaÃ§Ã£o que a definiu:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// Primeira renderizaÃ§Ã£o, props sÃ£o {id: 10}</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">Example</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span>\n    <span class=\"token comment\">// Efeito da primeirza renderizaÃ§Ã£o</span>\n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      ChatAPI<span class=\"token punctuation\">.</span><span class=\"token function\">subscribeToFriendStatus</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> handleStatusChange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">      <span class=\"token comment\">// Limpeza para o efeito da primeira renderizaÃ§Ã£o</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">        ChatAPI<span class=\"token punctuation\">.</span><span class=\"token function\">unsubscribeFromFriendStatus</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> handleStatusChange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></span>    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// PrÃ³xima renderizaÃ§Ã£o, props sÃ£o {id: 20}</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">Example</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span>\n    <span class=\"token comment\">// Efeito da segunda renderizaÃ§Ã£o</span>\n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      ChatAPI<span class=\"token punctuation\">.</span><span class=\"token function\">subscribeToFriendStatus</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">,</span> handleStatusChange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token comment\">// Limpeza para o efeito da segunda renderizaÃ§Ã£o</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        ChatAPI<span class=\"token punctuation\">.</span><span class=\"token function\">unsubscribeFromFriendStatus</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">,</span> handleStatusChange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Reinos se elevarÃ£o e se transformarÃ£o em cinzas, o Sol irÃ¡ ejetar suas camadas externas e se tornar uma <a href=\"https://pt.wikipedia.org/wiki/An%C3%A3_branca\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">anÃ£ branca</a> e a Ãºltima civilizaÃ§Ã£o terminarÃ¡. Mas nada farÃ¡ com que as <em>props</em> utilizadas pela etapa de limpeza da primeira renderizaÃ§Ã£o sejam outras do que <code class=\"language-text\">{id: 10}</code>.</p>\n<p>Isso Ã© o que permite que o React lide com os efeitos logo apÃ³s a pintura - tornando seus aplicativos mais rÃ¡pidos por padrÃ£o. As <em>props</em> antigas ainda estÃ£o lÃ¡, se o nosso cÃ³digo precisar delas.</p>\n<h2 id=\"sincronizaÃ§Ã£o-nÃ£o-ciclos-de-vida\"><a href=\"#sincroniza%C3%A7%C3%A3o-n%C3%A3o-ciclos-de-vida\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SincronizaÃ§Ã£o, nÃ£o Ciclos de Vida</h2>\n<p>Uma das minhas coisas favoritas sobre o React Ã© que ele unifica a descriÃ§Ã£o do resultado inicial da renderizaÃ§Ã£o e das atualizaÃ§Ãµes. Isso <a href=\"https://overreacted.io/the-bug-o-notation/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">reduz a entropia do seu programa</a>.</p>\n<p>Digamos que meu componente Ã© o seguinte:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Greeting</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> name <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Greeting<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      Hello, </span><span class=\"token punctuation\">{</span>name<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>NÃ£o importa se eu renderizo <code class=\"language-text\">&lt;Greeting name=&quot;Dan&quot; /&gt;</code> e depois <code class=\"language-text\">&lt;Greeting name=&quot;Yuzhi&quot; /&gt;</code>, ou se apenas renderizo <code class=\"language-text\">&lt;Greeting name=&quot;Yuzhi&quot; /&gt;</code>. No final, vamos ver <code class=\"language-text\">&quot;Hello, Yuzhi&quot;</code> em ambos os casos.</p>\n<p>As pessoas dizem: â€œÃ‰ tudo sobre a jornada, nÃ£o o destinoâ€. Com React, Ã© o oposto. <strong>Ã‰ tudo sobre o destino, nÃ£o a jornada</strong>. Essa Ã© a diferenÃ§a entre as chamadas <code class=\"language-text\">$.addClass</code> e <code class=\"language-text\">$.removeClass</code> no cÃ³digo jQuery (nossa â€œjornadaâ€) e especificando <em>qual deve</em> ser a classe CSS no cÃ³digo React (nosso â€œdestinoâ€).</p>\n<p><strong>React sincroniza o DOM de acordo com nossas <em>props</em> e <em>state</em> atuais.</strong> NÃ£o hÃ¡ distinÃ§Ã£o entre uma â€œmontagemâ€ ou uma â€œatualizaÃ§Ã£oâ€ durante a renderizaÃ§Ã£o.</p>\n<p>VocÃª deve pensar nos efeitos de maneira semelhante. <strong><code class=\"language-text\">useEffect</code> permite sincronizar as coisas fora da Ã¡rvore do React de acordo com as nossas <em>props</em> e <em>state</em></strong>.</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Greeting</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> name <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">    document<span class=\"token punctuation\">.</span>title <span class=\"token operator\">=</span> <span class=\"token string\">'Hello, '</span> <span class=\"token operator\">+</span> name<span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Greeting<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">      Hello, </span><span class=\"token punctuation\">{</span>name<span class=\"token punctuation\">}</span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Isso Ã© sutilmente diferente do modelo mental familiar de montagem/atualizaÃ§Ã£o/desmontagem. <strong>Ã‰ importante realmente internalizar isso. Se vocÃª estÃ¡ tentando escrever um efeito que se comporta de maneira diferente dependendo se o componente renderiza pela primeira vez ou nÃ£o, vocÃª estÃ¡ nadando contra a marÃ©!</strong> Falhamos em sincronizar se nosso resultado depende da â€œjornadaâ€ e nÃ£o do â€œdestinoâ€.</p>\n<p>NÃ£o importa se renderizamos com as <em>props</em> A, B e C, ou se renderizamos com C imediatamente. Embora possa haver algumas diferenÃ§as temporÃ¡rias (por exemplo, enquanto estamos buscando dados), eventualmente, o resultado final deve ser o mesmo.</p>\n<p>Ainda assim, Ã© claro que executar todos os efeitos em cada render pode nÃ£o ser eficiente. (E em alguns casos, isso levaria a loops infinitos.)</p>\n<p>EntÃ£o, como podemos consertar isso?</p>\n<h2 id=\"ensinando-react-a-diferenciar-seus-efeitos\"><a href=\"#ensinando-react-a-diferenciar-seus-efeitos\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Ensinando React a diferenciar seus efeitos</h2>\n<p>NÃ³s jÃ¡ aprendemos essa liÃ§Ã£o com o prÃ³prio DOM. Ao invÃ©s de alterÃ¡-lo em cada nova renderizaÃ§Ã£o, o React sÃ³ atualiza as partes do DOM que realmente mudam.</p>\n<p>Quando vocÃª estÃ¡ atualizando:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Greeting<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n  Hello, Dan\n</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Para:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Greeting<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n  Hello, Yuzhi\n</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>React vÃª dois objetos:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> oldProps <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>className<span class=\"token operator\">:</span> <span class=\"token string\">'Greeting'</span><span class=\"token punctuation\">,</span> children<span class=\"token operator\">:</span> <span class=\"token string\">'Hello, Dan'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> newProps <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>className<span class=\"token operator\">:</span> <span class=\"token string\">'Greeting'</span><span class=\"token punctuation\">,</span> children<span class=\"token operator\">:</span> <span class=\"token string\">'Hello, Yuzhi'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>React verifica cada uma de suas <em>props</em> e determina que <code class=\"language-text\">children</code> mudou e por isso, precisa realizar uma atualizaÃ§Ã£o no DOM, mas <code class=\"language-text\">className</code> nÃ£o mudou. EntÃ£o, ele pode apenas fazer:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">domNode<span class=\"token punctuation\">.</span>innerText <span class=\"token operator\">=</span> <span class=\"token string\">'Hello, Yuzhi'</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// NÃ£o precisa tocar `domNode.className`</span></code></pre></div>\n<p><strong>Podemos fazer algo assim com efeitos tambÃ©m? Seria bom evitar sua execuÃ§Ã£o quando desnecessÃ¡rio.</strong></p>\n<p>Por exemplo, talvez nosso componente renderize novamente devido a uma alteraÃ§Ã£o de estado:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Greeting</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> name <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>counter<span class=\"token punctuation\">,</span> setCounter<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    document<span class=\"token punctuation\">.</span>title <span class=\"token operator\">=</span> <span class=\"token string\">'Hello, '</span> <span class=\"token operator\">+</span> name<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Greeting<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">      Hello, </span><span class=\"token punctuation\">{</span>name<span class=\"token punctuation\">}</span><span class=\"token plain-text\"></span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setCounter</span><span class=\"token punctuation\">(</span>count <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span></span><span class=\"gatsby-highlight-code-line\"><span class=\"token plain-text\">        Increment</span></span><span class=\"gatsby-highlight-code-line\"><span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span></span><span class=\"token plain-text\">    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Mas nosso efeito nÃ£o usa o estado <code class=\"language-text\">counter</code>. <strong>Nosso efeito sincroniza o <code class=\"language-text\">document.title</code> com a prop <code class=\"language-text\">name</code>, mas nesse caso, a prop <code class=\"language-text\">name</code> Ã© a mesma</strong>. Reatribuir <code class=\"language-text\">document.title</code> em cada mudanÃ§a de <code class=\"language-text\">counter</code> nÃ£o Ã© ideal.</p>\n<p>Certo, entÃ£oâ€¦ React pode checar a diferenÃ§a em efeitos?</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">let</span> <span class=\"token function-variable function\">oldEffect</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span> document<span class=\"token punctuation\">.</span>title <span class=\"token operator\">=</span> <span class=\"token string\">'Hello, Dan'</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> <span class=\"token function-variable function\">newEffect</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span> document<span class=\"token punctuation\">.</span>title <span class=\"token operator\">=</span> <span class=\"token string\">'Hello, Dan'</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// O React pode ver entender que essas funÃ§Ãµes fazem a mesma coisa?</span></code></pre></div>\n<p>Na verdade nÃ£o. React nÃ£o pode adivinhar o que a funÃ§Ã£o faz sem chamÃ¡-la. (O cÃ³digo fonte realmente nÃ£o contÃ©m valores especÃ­ficos, apenas encapsula a prop <code class=\"language-text\">name</code>.)</p>\n<p>Ã‰ por isso que, se vocÃª quiser evitar a repetiÃ§Ã£o desnecessÃ¡rias de efeitos, vocÃª pode fornecer um array de dependÃªncias como segundo argumento (tambÃ©m conhecido como â€œdepsâ€) para <code class=\"language-text\">useEffect</code>:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    document<span class=\"token punctuation\">.</span>title <span class=\"token operator\">=</span> <span class=\"token string\">'Hello, '</span> <span class=\"token operator\">+</span> name<span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Nossas \"deps\"</span></span></code></pre></div>\n<p><strong>Ã‰ como dizer ao React: â€œEi, eu sei que vocÃª nÃ£o pode â€œverâ€ dentro desta funÃ§Ã£o, mas eu prometo que sÃ³ a prop <code class=\"language-text\">name</code> Ã© usada do escopo de renderizaÃ§Ã£o e nada mais.â€</strong></p>\n<p>Se cada um desses valores for o mesmo entre a renderizaÃ§Ã£o atual e a anterior, esse efeito nÃ£o serÃ¡ sincronizado, portanto, o React pode pular o efeito:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">oldEffect</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span> document<span class=\"token punctuation\">.</span>title <span class=\"token operator\">=</span> <span class=\"token string\">'Hello, Dan'</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> oldDeps <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'Dan'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">newEffect</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span> document<span class=\"token punctuation\">.</span>title <span class=\"token operator\">=</span> <span class=\"token string\">'Hello, Dan'</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> newDeps <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'Dan'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// React nÃ£o pode \"olhar\" dentro de funÃ§Ãµes, apenas em \"deps\"</span>\n<span class=\"token comment\">// Como todas as \"deps\" sÃ£o as mesmas, ele nÃ£o precisa executar o efeito</span></code></pre></div>\n<p>Se mesmo um dos valores do array de dependÃªncias for diferente entre renderizaÃ§Ãµes, sabemos que a execuÃ§Ã£o do efeito nÃ£o serÃ¡ ignorada. Sincronizando todas as coisas!</p>\n<h2 id=\"mentir-para-o-react-sobre-suas-deps-pode-causar-problemas\"><a href=\"#mentir-para-o-react-sobre-suas-deps-pode-causar-problemas\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Mentir para o React sobre suas â€œdepsâ€ pode causar problemas</h2>\n<p>Mentir para o React sobre suas â€œdepsâ€ tem consequÃªncias ruins. Intuitivamente, isso faz sentido, mas eu vi praticamente todo mundo que tenta usar <code class=\"language-text\">useEffect</code> com um modelo mental das <code class=\"language-text\">class</code>, tenta enganar as regras! (E eu fiz isso tambÃ©m no comeÃ§o!)</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">SearchResults</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">fetchData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">fetchData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Isso Ã© certo? Nem sempre -- e tem um jeito melhor de escrever isso.</span>\n\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><em>(O <a href=\"https://reactjs.org/docs/hooks-faq.html#is-it-safe-to-omit-functions-from-the-list-of-dependencies\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">FAQ dos Hooks explica</a> o que fazer ao invÃ©s do exemplo acima. <a href=\"https://overreacted.io/a-complete-guide-to-useeffect/#moving-functions-inside-effects\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Voltaremos nesse exemplo</a> mais para frente.)</em></p>\n<p>â€œMas eu sÃ³ quero executar isso ao montar o componente!â€, VocÃª dirÃ¡. Por enquanto, lembre-se: se vocÃª especificar â€œdepsâ€, <strong>todos os valores de dentro de seu componente que sÃ£o usados â€‹â€‹pelo efeito devem ser listados lÃ¡</strong>. Incluindo <em>props</em>, <em>state</em>, funÃ§Ãµes - qualquer coisa no escopo do seu componente usado dentro do efeito.</p>\n<p>Ã€s vezes, quando vocÃª faz isso, isso causa algum problema. Por exemplo, talvez vocÃª veja um loop de infinito ao buscar dados ou um <strong>socket</strong> Ã© recriado com muita freqÃ¼Ãªncia. <strong>A soluÃ§Ã£o para esse problema nÃ£o Ã© remover a dependÃªncia</strong> e iremos ver as soluÃ§Ãµes em breve.</p>\n<p>Mas antes de pularmos para as soluÃ§Ãµes, vamos entender melhor o problema.</p>\n<h2 id=\"o-que-acontece-se-mentirmos-na-nossa-lista-de-deps\"><a href=\"#o-que-acontece-se-mentirmos-na-nossa-lista-de-deps\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>O que acontece se mentirmos na nossa lista de â€œdepsâ€</h2>\n<p>Se na nossa lista de â€œdepsâ€ estiverem todos os valores usados â€‹â€‹pelo efeito, o React saberÃ¡ quando executÃ¡-lo novamente:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    document<span class=\"token punctuation\">.</span>title <span class=\"token operator\">=</span> <span class=\"token string\">'Hello, '</span> <span class=\"token operator\">+</span> name<span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span></code></pre></div>\n<p><img src=\"/fae247cd068eedbd4b62ba50592d2b3d/deps-compare-correct.gif\" alt=\"Diagrama de efeitos substituindo uns aos outros\"></p>\n<p><em>(Quando as dependÃªncias sÃ£o diferentes, nÃ³s executamos novamente o efeito.)</em></p>\n<p>Mas se especificamos <code class=\"language-text\">[]</code> para este efeito, a nova funÃ§Ã£o de efeito nÃ£o seria executada:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    document<span class=\"token punctuation\">.</span>title <span class=\"token operator\">=</span> <span class=\"token string\">'Hello, '</span> <span class=\"token operator\">+</span> name<span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Errado: `name` estÃ¡ faltando na lista de \"deps\"</span></span></code></pre></div>\n<p><img src=\"/25f75db3f9f57ffe1426912093577445/deps-compare-wrong.gif\" alt=\"Diagrama de efeitos substituindo uns aos outros\"></p>\n<p><em>(Como as dependÃªncias sÃ£o iguais, nÃ³s pulamos o efeito.)</em></p>\n<p>Nesse caso, o problema pode parecer Ã³bvio. Mas a intuiÃ§Ã£o pode enganÃ¡-lo em outros casos, especialmente se sua memÃ³ria muscular lembrar de soluÃ§Ãµes com <em>class</em>.</p>\n<p>Por exemplo, digamos que estamos escrevendo um contador que aumenta a cada segundo. Com <code class=\"language-text\">class</code>, nossa intuiÃ§Ã£o Ã©: â€œConfigure o intervalo uma vez e destrua-o uma vezâ€. Aqui estÃ¡ um <a href=\"https://codesandbox.io/s/n5mjzjy9kl\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">exemplo</a> de como podemos fazer isso. Quando traduzimos mentalmente esse cÃ³digo em <code class=\"language-text\">useEffect</code>, instintivamente adicionamos <code class=\"language-text\">[]</code> a lista de â€œdepsâ€. â€œEu quero que seja executado uma vezâ€, certo?</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Counter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> id <span class=\"token operator\">=</span> <span class=\"token function\">setInterval</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span>count <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">clearInterval</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span>count<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>No entanto, este exemplo <a href=\"https://codesandbox.io/s/91n5z8jo7r\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">sÃ³ incrementa uma vez</a>. <em>Oops.</em></p>\n<p>Se o seu modelo mental Ã© â€œdependÃªncias, deixe-me especificar quando quero reativar o efeitoâ€, este exemplo pode dar a vocÃª uma crise existencial. VocÃª <em>quer</em> acionÃ¡-lo uma vez porque Ã© um intervalo - entÃ£o por que ele estÃ¡ causando problemas?</p>\n<p>No entanto, isso faz sentido se vocÃª sabe que a lista de dependÃªncias sÃ£o nossas dicas para o React sobre <em>tudo</em> o que o efeito usa do escopo de renderizaÃ§Ã£o. Ele usa, <code class=\"language-text\">count</code>, mas nÃ³s mentimos para o React, dizendo que isso nÃ£o acontece com <code class=\"language-text\">[]</code>. Ã‰ sÃ³ uma questÃ£o de tempo antes que isso nos morde de volta!</p>\n<p>Na primeira renderizaÃ§Ã£o, <code class=\"language-text\">count</code> Ã© <code class=\"language-text\">0</code>. Portanto, <code class=\"language-text\">setCount(count + 1)</code> no primeiro efeito de renderizaÃ§Ã£o significa <code class=\"language-text\">setCount(0 + 1)</code>. <strong>Como nunca executamos novamente o efeito por causa das â€œdepsâ€ <code class=\"language-text\">[]</code>, ele continuarÃ¡ chamando <code class=\"language-text\">setCount(0 + 1)</code> cada segundo:</strong></p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// Primeira renderizaÃ§Ã£o, `state` Ã© 0</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">Counter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span>\n    <span class=\"token comment\">// Efeito da primeira renderizaÃ§Ã£o</span>\n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> id <span class=\"token operator\">=</span> <span class=\"token function\">setInterval</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">        <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Always setCount(1)</span></span>      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">clearInterval</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token comment\">// Nunca re-execute o efeito</span></span>  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Toda renderizaÃ§Ã£o subsequente, `state` Ã© 1</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">Counter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token comment\">// Esse efeito Ã© sempre ignorado porque</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token comment\">// nÃ³s mentimos para o React sobre a lista</span></span>    <span class=\"token comment\">// em branco de dependÃªncias</span>\n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> id <span class=\"token operator\">=</span> <span class=\"token function\">setInterval</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">clearInterval</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>NÃ³s mentimos para o React dizendo que nosso efeito nÃ£o depende de um valor de dentro de nosso componente, quando na verdade ele depende!</p>\n<p>Nosso efeito usa <code class=\"language-text\">count</code> - um valor dentro do escopo de renderizaÃ§Ã£o do componente, porÃ©m fora do efeito:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> count <span class=\"token operator\">=</span> <span class=\"token comment\">// ...</span></span>\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> id <span class=\"token operator\">=</span> <span class=\"token function\">setInterval</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">      <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span>count <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">clearInterval</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Portanto, especificar <code class=\"language-text\">[]</code> como uma dependÃªncia criarÃ¡ um erro. O React irÃ¡ comparar as dependÃªncias e pularÃ¡ a atualizaÃ§Ã£o desse efeito:</p>\n<p><img src=\"/29e53bd0c9b7d2ac70d3cd924886b030/interval-wrong.gif\" alt=\"Diagrama da closure do intervalo jÃ¡ obsoleto\"></p>\n<p><em>(As dependÃªncias sÃ£o iguais, entÃ£o pulamos o efeito.)</em></p>\n<p>QuestÃµes como essa sÃ£o difÃ­ceis de se pensar. Portanto, eu te encorajo a adotar como uma regra rigorosa de sempre ser honesto sobre suas dependÃªncias de efeito e especificar todas elas. Fornecemos <a href=\"https://github.com/facebook/react/issues/14920\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">uma regra no linter</a> se vocÃª quiser impor isso ao seu time.</p>\n<h2 id=\"duas-maneiras-de-ser-honesto-sobre-suas-dependÃªncias\"><a href=\"#duas-maneiras-de-ser-honesto-sobre-suas-depend%C3%AAncias\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Duas maneiras de ser honesto sobre suas dependÃªncias</h2>\n<p>Existem duas estratÃ©gias para ser honesto sobre suas dependÃªncias. Geralmente, vocÃª deve comeÃ§ar com o primeiro e depois aplicar o segundo, se necessÃ¡rio.</p>\n<p><strong>A primeira estratÃ©gia Ã© arrumar o array de dependÃªncias para incluir todos os valores do escopo do componente que sÃ£o usados â€‹â€‹dentro do efeito.</strong> Vamos incluir <code class=\"language-text\">count</code>:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> id <span class=\"token operator\">=</span> <span class=\"token function\">setInterval</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span>count <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">clearInterval</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span></code></pre></div>\n<p>Isso faz com que o array de dependÃªncias fique correto. Pode nÃ£o ser <em>ideal</em>, mas esse Ã© o primeiro problema que precisamos corrigir. Agora, uma mudanÃ§a em <code class=\"language-text\">count</code> irÃ¡ executar o efeito novamente, com cada prÃ³ximo intervalo referenciando <code class=\"language-text\">count</code> do escopo de renderizaÃ§Ã£o do seu component em <code class=\"language-text\">setCount(count + 1)</code>:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// Primeira renderizaÃ§Ã£o, `state` Ã© 0</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">Counter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span>\n    <span class=\"token comment\">// Efeito na primeira renderizaÃ§Ã£o</span>\n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> id <span class=\"token operator\">=</span> <span class=\"token function\">setInterval</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">        <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// setCount(count + 1)</span></span>      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">clearInterval</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token comment\">// [count]</span></span>  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Segunda renderizaÃ§Ã£o, `state` Ã© 1</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">Counter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span>\n    <span class=\"token comment\">// Effect from second render</span>\n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> id <span class=\"token operator\">=</span> <span class=\"token function\">setInterval</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">        <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// setCount(count + 1)</span></span>      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">clearInterval</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token comment\">// [count]</span></span>  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Isso <a href=\"https://codesandbox.io/s/0x0mnlyq8l\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">resolveria o problema</a>, mas nosso intervalo seria limpo e definido novamente sempre que alteraÃ§Ãµes no <code class=\"language-text\">count</code> fossem feitas. Isso pode ser indesejÃ¡vel:</p>\n<p><img src=\"/5734271ddfa94d2d65ac6160515e0069/interval-rightish.gif\" alt=\"Diagrama do intervalo que se reinscreve\"></p>\n<p><em>(As dependÃªncias sÃ£o diferentes, entÃ£o executamos novamente o efeito.)</em></p>\n<hr>\n<p><strong>A segunda estratÃ©gia Ã© alterar o cÃ³digo do nosso efeito para que ele nÃ£o <em>precise</em> de um valor que mude com mais frequÃªncia do que desejamos.</strong> NÃ³s nÃ£o queremos mentir sobre as dependÃªncias - apenas queremos que nosso efeito tenha menos dependÃªncias.</p>\n<p>Vamos ver algumas tÃ©cnicas comuns para remover dependÃªncias.</p>\n<hr>\n<h2 id=\"tornando-os-efeitos-auto-suficientes\"><a href=\"#tornando-os-efeitos-auto-suficientes\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tornando os Efeitos Auto-Suficientes</h2>\n<p>Queremos nos livrar de <code class=\"language-text\">count</code> na lista de dependÃªncias em nosso efeito:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> id <span class=\"token operator\">=</span> <span class=\"token function\">setInterval</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">      <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span>count <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">clearInterval</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span></code></pre></div>\n<p>Para fazer isso, precisamos nos perguntar: para que estamos utilizando <code class=\"language-text\">count</code>? Parece que sÃ³ usamos para a chamada de <code class=\"language-text\">setCount</code>. E para esse caso, realmente nÃ£o precisamos de <code class=\"language-text\">count</code>. Quando queremos atualizar o estado com base no estado anterior, podemos usar <a href=\"https://reactjs.org/docs/hooks-reference.html#functional-updates\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">a forma funcional</a> do <code class=\"language-text\">setState</code>:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> id <span class=\"token operator\">=</span> <span class=\"token function\">setInterval</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">      <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">c</span> <span class=\"token operator\">=></span> c <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">clearInterval</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Eu gosto de pensar nesses casos como â€œfalsas dependÃªnciasâ€. Sim, <code class=\"language-text\">count</code> foi uma dependÃªncia necessÃ¡ria porque escrevemos <code class=\"language-text\">setCount(count + 1)</code> dentro do efeito. No entando, nÃ³s sÃ³ precisÃ¡vamos de <code class=\"language-text\">count</code> para transformÃ¡-lo em <code class=\"language-text\">count + 1</code> e â€œenviar de voltaâ€ para o React. Mas o React <em>jÃ¡ conhece</em> o atual valor de <code class=\"language-text\">count</code>. <strong>O que precisamos dizer ao React Ã© que ele incremente o estado - qualquer que seja seu valor atual.</strong></p>\n<p>Isso Ã© exatamente o que <code class=\"language-text\">setCount(c =&gt; c + 1)</code> faz. VocÃª pode pensar nisso como â€œenviar uma instruÃ§Ã£oâ€ para o React de como o estado deve mudar. Essa â€œforma funcionalâ€ tambÃ©m ajuda em outros casos, como quando vocÃª faz <a href=\"https://overreacted.io/react-as-a-ui-runtime/#batching\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">atualizaÃ§Ãµes em lotes</a>.</p>\n<p><strong>Perceba que nÃ³s realmente <em>fizemos o trabalho</em> para remover a dependÃªncia. NÃ³s nÃ£o trapaceÃ¡mos. Nosso efeito nÃ£o lÃª mais o valor <code class=\"language-text\">count</code> do escopo de renderizaÃ§Ã£o:</strong></p>\n<p><img src=\"/f128ad20c28317ed27a3cb68197fc906/interval-right.gif\" alt=\"Diagrama do interval que funciona\"></p>\n<p><em>(As dependÃªncias sÃ£o iguais, entÃ£o pulamos o efeito.)</em></p>\n<p>VocÃª pode <a href=\"https://codesandbox.io/s/q3181xz1pj\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">tentar aqui</a>.</p>\n<p>Embora esse efeito seja executado apenas uma vez, o retorno de chamada do intervalo que definimos pertencente Ã  primeira renderizaÃ§Ã£o, Ã© perfeitamente capaz de enviar a instruÃ§Ã£o de atualizaÃ§Ã£o<code class=\"language-text\">c =&gt; c + 1</code>  toda vez que o intervalo Ã© disparado. NÃ£o precisamos mais saber o estado atual de <code class=\"language-text\">count</code>. React jÃ¡ o conhece.</p>\n<h2 id=\"atualizaÃ§Ãµes-funcionais-e-google-docs\"><a href=\"#atualiza%C3%A7%C3%B5es-funcionais-e-google-docs\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AtualizaÃ§Ãµes Funcionais e Google Docs</h2>\n<p>Lembra que falamos sobre sincronizaÃ§Ã£o sendo o modelo mental para efeitos? Um aspecto interessante da sincronizaÃ§Ã£o Ã© que muitas vezes vocÃª deseja manter as â€œmensagensâ€ entre os sistemas separados de seu estado. Por exemplo, editar um documento no Google Docs nÃ£o envia a <em>pÃ¡gina inteira</em> para o servidor. Isso seria muito ineficiente. Ao invÃ©s disso, ele envia uma representaÃ§Ã£o do que o usuÃ¡rio tentou fazer.</p>\n<p>Embora nosso caso de uso seja diferente, uma filosofia semelhante se aplica aos efeitos. <strong>Precisamos enviar apenas as informaÃ§Ãµes mÃ­nimas necessÃ¡rias de dentro dos efeitos para um componente.</strong> O atualizador <code class=\"language-text\">setCount(c =&gt; c + 1)</code>, por exemplo, tem menos informaÃ§Ãµes do que <code class=\"language-text\">setCount(count + 1)</code> porque ele nÃ£o estÃ¡ â€œcontaminadoâ€ pela contagem atual. Ele apenas expressa a aÃ§Ã£o desejada (â€œincrementarâ€). Pensar em React <a href=\"https://reactjs.org/docs/thinking-in-react.html#step-3-identify-the-minimal-but-complete-representation-of-ui-state\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">envolve encontrar o estado mÃ­nimo</a>. Ã‰ o mesmo princÃ­pio, mas para atualizaÃ§Ãµes.</p>\n<p>Codificar a <em>intenÃ§Ã£o</em> (ao invÃ©s do resultado) Ã© semelhante a como o Google Docs <a href=\"https://medium.com/@srijancse/how-real-time-collaborative-editing-work-operational-transformation-ac4902d75682\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">resolve</a> a ediÃ§Ã£o colaborativa. Embora tenhamos ampliando a analogia, as atualizaÃ§Ãµes funcionais desempenham um papel semelhante no React. Eles garantem que atualizaÃ§Ãµes de vÃ¡rias fontes (manipuladores de eventos, assinaturas de efeitos, etc) possam ser aplicadas corretamente em um lote e de maneira previsÃ­vel.</p>\n<p><strong>No entanto, <code class=\"language-text\">setCount(c =&gt; c + 1)</code> nÃ£o Ã© Ã³timo.</strong> Parece um pouco estranho e Ã© muito limitado no que pode ele fazer. Por exemplo, se tivÃ©ssemos duas variÃ¡veis â€‹â€‹de estado cujos valores dependessem uns dos outros, ou se precisarmos calcular o prÃ³ximo estado com base em uma <em>prop</em>, isso nÃ£o nos ajudaria. Felizmente, <code class=\"language-text\">setCount(c =&gt; c + 1)</code> tem um padrÃ£o poderoso. Seu nome Ã© <code class=\"language-text\">useReducer</code>.</p>\n<h2 id=\"desacoplando-atualizaÃ§Ãµes-de-aÃ§Ãµes\"><a href=\"#desacoplando-atualiza%C3%A7%C3%B5es-de-a%C3%A7%C3%B5es\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Desacoplando AtualizaÃ§Ãµes de AÃ§Ãµes</h2>\n<p>Vamos modificar o exemplo anterior para ter duas variÃ¡veis â€‹â€‹de estado: <code class=\"language-text\">count</code> e <code class=\"language-text\">step</code>. Nosso intervalo irÃ¡ incrementar o valor de <code class=\"language-text\">count</code> pelo valor de entrada do <code class=\"language-text\">step</code>:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Counter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>step<span class=\"token punctuation\">,</span> setStep<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> id <span class=\"token operator\">=</span> <span class=\"token function\">setInterval</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">      <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">c</span> <span class=\"token operator\">=></span> c <span class=\"token operator\">+</span> step<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">clearInterval</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>step<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span>count<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">value</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>step<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">onChange</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token parameter\">e</span> <span class=\"token operator\">=></span> <span class=\"token function\">setStep</span><span class=\"token punctuation\">(</span><span class=\"token function\">Number</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>(Aqui estÃ¡ uma <a href=\"https://codesandbox.io/s/zxn70rnkx\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">demonstraÃ§Ã£o</a> .)</p>\n<p>Note que <strong>nÃ£o estamos trapaceando</strong>. Desde que comecei a usar <code class=\"language-text\">step</code> dentro do efeito, eu adicionei ele nas dependÃªncias. E Ã© por isso que o cÃ³digo Ã© executado corretamente.</p>\n<p>O comportamento atual neste exemplo Ã© que realizando uma mudanÃ§a em <code class=\"language-text\">step</code>, reinicia o intervalo - porque ele Ã© uma das dependÃªncias. E em muitos casos, Ã© exatamente isso que vocÃª quer! NÃ£o hÃ¡ nada de errado em encerrar um efeito e defini-lo de novo, e nÃ£o devemos evitar isso a menos que tenhamos um bom motivo.</p>\n<p>No entanto, digamos que queremos que o relÃ³gio de intervalo nÃ£o seja redefinido nas alteraÃ§Ãµes para o <code class=\"language-text\">step</code>. Como removemos <code class=\"language-text\">step</code> da dependÃªncia do nosso efeito?</p>\n<p><strong>Ao definir uma variÃ¡vel de estado depende do valor atual de outra variÃ¡vel de estado, vocÃª pode tentar substituir ambos por <code class=\"language-text\">useReducer</code>.</strong></p>\n<p>Quando vocÃª se encontrar escrevendo <code class=\"language-text\">setSomething(something =&gt; ...)</code>, Ã© um bom momento para considerar o uso de um redutor. Um redutor permite <strong>desassociar as â€œaÃ§Ãµesâ€ que ocorreram em seu componente de como o estado Ã© atualizado.</strong></p>\n<p>Vamos trocar a dependÃªncia <code class=\"language-text\">step</code> por um <code class=\"language-text\">dispatch</code> em nosso efeito:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>state<span class=\"token punctuation\">,</span> dispatch<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useReducer</span><span class=\"token punctuation\">(</span>reducer<span class=\"token punctuation\">,</span> initialState<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> count<span class=\"token punctuation\">,</span> step <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> state<span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> id <span class=\"token operator\">=</span> <span class=\"token function\">setInterval</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> type<span class=\"token operator\">:</span> <span class=\"token string\">'tick'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Ao invÃ©s de `setCount(c => c + step)`</span></span>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">clearInterval</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>dispatch<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span></code></pre></div>\n<p>(Veja aqui <a href=\"https://codesandbox.io/s/xzr480k0np\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">uma demonstraÃ§Ã£o</a>.)</p>\n<p>VocÃª pode me perguntar: â€œComo isso Ã© melhor?â€ A resposta Ã© que o <strong>React garante que a funÃ§Ã£o <code class=\"language-text\">dispatch</code> seja constante durante toda a vida Ãºtil do componente. Portanto, o exemplo acima nunca precisa reescrever o intervalo.</strong></p>\n<p>NÃ³s resolvemos nosso problema!</p>\n<p><em>(VocÃª pode omitir os valores de <code class=\"language-text\">dispatch</code>, <code class=\"language-text\">setState</code> e <code class=\"language-text\">useRef</code> das â€œdepsâ€ porque React garante que eles sejam estÃ¡ticos. Mas tambÃ©m nÃ£o faz mal especificÃ¡-los.)</em></p>\n<p>Ao invÃ©s de ler o estado <em>dentro</em> de um efeito, ele envia uma <em>aÃ§Ã£o</em> que descreve as informaÃ§Ãµes <em>sobre o que aconteceu</em>. Isso permite que nosso efeito fique desacoplado do estado <code class=\"language-text\">step</code>. Nosso efeito nÃ£o se importa em <em>como</em> atualizamos o estado, apenas nos informa <em>sobre o que aconteceu</em>. O redutor centraliza a lÃ³gica de atualizaÃ§Ã£o:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> initialState <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  count<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n  step<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">reducer</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">state<span class=\"token punctuation\">,</span> action</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> count<span class=\"token punctuation\">,</span> step <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> state<span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>action<span class=\"token punctuation\">.</span>type <span class=\"token operator\">===</span> <span class=\"token string\">'tick'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> count<span class=\"token operator\">:</span> count <span class=\"token operator\">+</span> step<span class=\"token punctuation\">,</span> step <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></span>  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>action<span class=\"token punctuation\">.</span>type <span class=\"token operator\">===</span> <span class=\"token string\">'step'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> count<span class=\"token punctuation\">,</span> step<span class=\"token operator\">:</span> action<span class=\"token punctuation\">.</span>step <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>(Aqui estÃ¡ <a href=\"https://codesandbox.io/s/xzr480k0np\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">uma demonstraÃ§Ã£o</a>, se vocÃª nÃ£o viu o link mais cedo).</p>\n<h2 id=\"por-que-usereducer-Ã©-o-modo-trapaÃ§a-dos-hooks\"><a href=\"#por-que-usereducer-%C3%A9-o-modo-trapa%C3%A7a-dos-hooks\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Por que useReducer Ã© o â€œModo TrapaÃ§aâ€ dos Hooks</h2>\n<p>NÃ³s vimos como remover dependÃªncias quando um efeito precisa definir o estado com base no estado anterior ou em outra variÃ¡vel de estado. <strong>Mas e se precisarmos de ferramentas para calcular o prÃ³ximo estado?</strong> Por exemplo, talvez nossa API seja <code class=\"language-text\">&lt;Counter step={1} /&gt;</code>. Certamente nÃ£o podemos evitar especificar <code class=\"language-text\">props.step</code> como uma dependÃªncia, certo?</p>\n<p>Na verdade, nÃ³s podemos! Podemos colocar o redutor em si dentro do nosso componente para ler <em>props</em>:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">function</span> <span class=\"token function\">Counter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> step <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span>  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> dispatch<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useReducer</span><span class=\"token punctuation\">(</span>reducer<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">function</span> <span class=\"token function\">reducer</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">state<span class=\"token punctuation\">,</span> action</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>action<span class=\"token punctuation\">.</span>type <span class=\"token operator\">===</span> <span class=\"token string\">'tick'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">      <span class=\"token keyword\">return</span> state <span class=\"token operator\">+</span> step<span class=\"token punctuation\">;</span></span>    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> id <span class=\"token operator\">=</span> <span class=\"token function\">setInterval</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> type<span class=\"token operator\">:</span> <span class=\"token string\">'tick'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">clearInterval</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>dispatch<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span>count<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Esse padrÃ£o desativa algumas otimizaÃ§Ãµes, entÃ£o tente nÃ£o usÃ¡-lo em todos os lugares, mas vocÃª pode acessar totalmente suas <em>props</em> em um redutor se precisar. (Aqui estÃ¡ <a href=\"https://codesandbox.io/s/7ypm405o8q\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">uma demonstraÃ§Ã£o</a>.)</p>\n<p><strong>Mesmo nesse caso, a identidade do <code class=\"language-text\">dispatch</code> ainda Ã© garantida como estÃ¡vel entre as renderizaÃ§Ãµes.</strong> EntÃ£o vocÃª pode omiti-lo das deps de efeito, se quiser. Isso nÃ£o farÃ¡ com que o efeito seja executado novamente.</p>\n<p>VocÃª pode estar se perguntando: como isso funciona? Como o redutor â€œsabeâ€ as <em>props</em> chamadas de dentro de um efeito que pertence a outra renderizaÃ§Ã£o? A resposta Ã© que, quando vocÃª usa <code class=\"language-text\">dispatch</code>, React lembra a aÃ§Ã£o - mas ele irÃ¡ chamar seu redutor durante a prÃ³xima renderizaÃ§Ã£o. Nesse ponto, as <em>props</em> novas estarÃ£o no escopo e vocÃª nÃ£o estarÃ¡ dentro de um efeito.</p>\n<p><strong>Ã‰ por isso que eu gosto de pensar em <code class=\"language-text\">useReducer</code> como o â€œModo TrapaÃ§aâ€ dos Hooks. Isso me permite desacoplar a lÃ³gica de atualizaÃ§Ã£o da descriÃ§Ã£o do que aconteceu. Isso, por sua vez, me ajuda a remover dependÃªncias desnecessÃ¡rias de meus efeitos e a evitar que sejam executados novamente com mais frequÃªncia do que o necessÃ¡rio.</strong></p>\n<h2 id=\"movendo-funÃ§Ãµes-para-dentro-dos-efeitos\"><a href=\"#movendo-fun%C3%A7%C3%B5es-para-dentro-dos-efeitos\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Movendo FunÃ§Ãµes Para Dentro Dos Efeitos</h2>\n<p>Um erro comum Ã© pensar que as funÃ§Ãµes nÃ£o devem ser dependÃªncias. Por exemplo, isso parece funcionar:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">SearchResults</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>data<span class=\"token punctuation\">,</span> setData<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> hits<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">fetchData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">axios</span><span class=\"token punctuation\">(</span>\n      <span class=\"token string\">'https://hn.algolia.com/api/v1/search?query=react'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">setData</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">fetchData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Isso tÃ¡ certo, nÃ©?</span></span>\n  <span class=\"token comment\">// ...</span></code></pre></div>\n<p><em>(<a href=\"https://codesandbox.io/s/8j4ykjyv0\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Este exemplo</a> Ã© adaptado de um Ã³timo artigo do Robin Wieruch - <a href=\"https://www.robinwieruch.de/react-hooks-fetch-data/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">confira</a>!)</em></p>\n<p>E para ser claro, esse cÃ³digo <em>funciona</em>. <strong>Mas o problema de simplesmente omitir funÃ§Ãµes locais Ã© que fica difÃ­cil saber se estamos lidando com todos os casos Ã  medida que o componente cresce!</strong></p>\n<p>Imagine que nosso cÃ³digo foi dividido e cada funÃ§Ã£o era cinco vezes maior:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">SearchResults</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Imagine que essa funÃ§Ã£o Ã© longa</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">getFetchUrl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token string\">'https://hn.algolia.com/api/v1/search?query=react'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// Imagine que essa funÃ§Ã£o tambÃ©m Ã© longa</span>\n  <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">fetchData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">axios</span><span class=\"token punctuation\">(</span><span class=\"token function\">getFetchUrl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">setData</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">fetchData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Agora vamos dizer que futuramente usamos algum estado ou <em>props</em> em uma dessas funÃ§Ãµes:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">SearchResults</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>query<span class=\"token punctuation\">,</span> setQuery<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">'react'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Imagine que essa funÃ§Ã£o tambÃ©m Ã© longa</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">getFetchUrl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">return</span> <span class=\"token string\">'https://hn.algolia.com/api/v1/search?query='</span> <span class=\"token operator\">+</span> query<span class=\"token punctuation\">;</span></span>  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// Imagine que essa funÃ§Ã£o tambÃ©m Ã© longa</span>\n  <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">fetchData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">axios</span><span class=\"token punctuation\">(</span><span class=\"token function\">getFetchUrl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">setData</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">fetchData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Se nos esquecermos de atualizar as deps de qualquer um desses efeitos que chamam essas funÃ§Ãµes (possivelmente, atravÃ©s de outras funÃ§Ãµes!), Nossos efeitos nÃ£o conseguirÃ£o sincronizar as mudanÃ§as de nossas <em>props</em> e <em>state</em>. Isso nÃ£o soa ideal!</p>\n<p>Por sorte, existe uma soluÃ§Ã£o fÃ¡cil para esse problema. <strong>Se vocÃª usar apenas algumas funÃ§Ãµes <em>dentro</em> de um efeito, mova elas diretamente para <em>dentro</em> desse efeito:</strong></p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">SearchResults</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token comment\">// Movemos a funÃ§Ã£o para dentro do efeito!</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">function</span> <span class=\"token function\">getFetchUrl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token keyword\">return</span> <span class=\"token string\">'https://hn.algolia.com/api/v1/search?query=react'</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">}</span></span><span class=\"gatsby-highlight-code-line\"></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">fetchData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">axios</span><span class=\"token punctuation\">(</span><span class=\"token function\">getFetchUrl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token function\">setData</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">}</span></span>\n    <span class=\"token function\">fetchData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// âœ… As dependÃªncias estÃ£o corretas</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>(<a href=\"https://codesandbox.io/s/04kp3jwwql\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Aqui estÃ¡ uma demonstraÃ§Ã£o</a>.)</p>\n<p>EntÃ£o, qual Ã© o benefÃ­cio? NÃ£o precisamos mais pensar nas â€œdependÃªncias transitivasâ€. Nosso array de dependÃªncias nÃ£o estÃ¡ mais ocupado: <strong>realmente <em>nÃ£o</em> estamos usando nada do escopo externo do componente em nosso efeito.</strong></p>\n<p>Se mudarmos <code class=\"language-text\">getFetchUrl</code> para usar o estado <code class=\"language-text\">query</code>, teremos uma probabilidade maior de perceber que estamos editando isso <em>dentro</em> de um efeito - e, portanto, precisamos adicionar <code class=\"language-text\">query</code> Ã s dependÃªncias do efeito:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">SearchResults</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>query<span class=\"token punctuation\">,</span> setQuery<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">'react'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">function</span> <span class=\"token function\">getFetchUrl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">      <span class=\"token keyword\">return</span> <span class=\"token string\">'https://hn.algolia.com/api/v1/search?query='</span> <span class=\"token operator\">+</span> query<span class=\"token punctuation\">;</span></span>    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">fetchData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">axios</span><span class=\"token punctuation\">(</span><span class=\"token function\">getFetchUrl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">setData</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">fetchData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>query<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// âœ… As dependÃªncias estÃ£o corretas</span></span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>(Aqui estÃ¡ <a href=\"https://codesandbox.io/s/pwm32zx7z7\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">uma demonstraÃ§Ã£o</a>.)</p>\n<p>Adicionando essa dependÃªncia, nÃ³s nÃ£o estamos apenas â€œapagizando o Reactâ€. Isso <em>faz sentido</em> para rebuscar os dados quando a consulta muda. <strong>O design de <code class=\"language-text\">useEffect</code> forÃ§a vocÃª a notar que a mudanÃ§a em nosso fluxo de dados e escolher como nossos efeitos devem sincronizar eles - ao invÃ©s de ignorÃ¡-los atÃ© que nosso usuÃ¡rio final encontre um bug.</strong></p>\n<p>GraÃ§as a regra <code class=\"language-text\">exhaustive-deps</code> plugin <code class=\"language-text\">eslint-plugin-react-hooks</code>, <a href=\"https://github.com/facebook/react/issues/14920\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ele pode analisar os efeitos enquanto vocÃª digita no seu editor</a> e recebe sugestÃµes sobre quais dependÃªncias estÃ£o faltando. Em outras palavras, uma mÃ¡quina pode informar quais alteraÃ§Ãµes no fluxo de dados nÃ£o estÃ£o sendo tratadas corretamente por um componente:</p>\n<p><img src=\"/04a90dcbacb01105d634964880ebed19/exhaustive-deps.gif\" alt=\"Gif da regra do linter\"></p>\n<p>Bem maneiro.</p>\n<h2 id=\"mas-eu-nÃ£o-posso-colocar-essa-funÃ§Ã£o-dentro-de-um-efeito\"><a href=\"#mas-eu-n%C3%A3o-posso-colocar-essa-fun%C3%A7%C3%A3o-dentro-de-um-efeito\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Mas Eu NÃ£o Posso Colocar Essa FunÃ§Ã£o Dentro De Um Efeito</h2>\n<p>Ã€s vezes vocÃª pode nÃ£o vai querer mover uma funÃ§Ã£o para dentro de um efeito. Por exemplo, vÃ¡rios efeitos no mesmo componente podem chamar a mesma funÃ§Ã£o e vocÃª nÃ£o quer copiar e colar sua lÃ³gica. Ou talvez seja uma <em>prop</em>.</p>\n<p>VocÃª deve evitar colocar uma funÃ§Ã£o como esta nas dependÃªncias do efeito? Eu acredito que nÃ£o. Novamente, os <strong>efeitos nÃ£o devem mentir sobre suas dependÃªncias.</strong> Geralmente existem soluÃ§Ãµes melhores. Um equÃ­voco comum Ã© que â€œuma funÃ§Ã£o nunca mudariaâ€. Mas, como aprendemos ao longo deste artigo, isso estÃ¡ longe de ser verdade. Na verdade, uma funÃ§Ã£o definida dentro de um componente muda em cada renderizaÃ§Ã£o!</p>\n<p><strong>Isso por si sÃ³ apresenta um problema.</strong> Vamos dizer que dois efeitos chama <code class=\"language-text\">getFetchUrl</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">SearchResults</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">getFetchUrl</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">query</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token string\">'https://hn.algolia.com/api/v1/search?query='</span> <span class=\"token operator\">+</span> query<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token function\">getFetchUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">'react'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// ... Busca dados e faz algo ...</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ğŸ”´ DependÃªncia em falta: getFetchUrl</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token function\">getFetchUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">'redux'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// ... Busca dados e faz algo ...</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ğŸ”´ DependÃªncia em falta: getFetchUrl</span>\n\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Nesse caso, talvez vocÃª nÃ£o queira mover <code class=\"language-text\">getFetchUrl</code> para dentro de nenhum dos efeitos, pois nÃ£o seria capaz de compartilhar a lÃ³gica.</p>\n<p>Por outro lado, se vocÃª for â€œhonestoâ€ sobre as dependÃªncias de efeitos, poderÃ¡ encontrar um problema. Como ambos os nossos efeitos dependem de <code class=\"language-text\">getFetchUrl</code> <strong>(o que Ã© diferente em cada renderizaÃ§Ã£o)</strong>, nossos arrays de dependÃªncia sÃ£o inÃºteis:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">SearchResults</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token comment\">// ğŸ”´ Re-executa todos os efeitos em cada renderizaÃ§Ã£o</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">function</span> <span class=\"token function\">getFetchUrl</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">query</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">return</span> <span class=\"token string\">'https://hn.algolia.com/api/v1/search?query='</span> <span class=\"token operator\">+</span> query<span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span></span>\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token function\">getFetchUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">'react'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// ... Busca dados e faz algo ...</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>getFetchUrl<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ğŸš§ As dependÃªncias estÃ£o corretas, mas elas mudam frequentemente</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token function\">getFetchUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">'redux'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// ... Busca dados e faz algo ...</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>getFetchUrl<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ğŸš§ As dependÃªncias estÃ£o corretas, mas elas mudam frequentemente</span>\n\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Uma soluÃ§Ã£o tentadora para isso Ã© simplesmente evitar <code class=\"language-text\">getFetchUrl</code> na lista de dependÃªncias. No entanto, nÃ£o acho que seja uma boa soluÃ§Ã£o. Isso torna difÃ­cil perceber quando <em>estamos</em> adicionando uma alteraÃ§Ã£o no fluxo de dados que <em>precisa</em> ser tratado por um efeito. Isso leva a erros como o â€œintervalo que nunca atualizaâ€ que vimos anteriormente.</p>\n<p>Ao invÃ©s disso, existem duas outras soluÃ§Ãµes que sÃ£o mais simples.</p>\n<p><strong>Primeiro de tudo, se uma funÃ§Ã£o nÃ£o usa nada do escopo do componente, vocÃª pode mover ela para fora do componente e usa-lÃ¡ livremente dentro de seus efeitos:</strong></p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"gatsby-highlight-code-line\"><span class=\"token comment\">// âœ… NÃ£o Ã© afetado pelo fluxo de dados</span></span><span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">function</span> <span class=\"token function\">getFetchUrl</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">query</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">return</span> <span class=\"token string\">'https://hn.algolia.com/api/v1/search?query='</span> <span class=\"token operator\">+</span> query<span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\"><span class=\"token punctuation\">}</span></span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">SearchResults</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token function\">getFetchUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">'react'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// ... Busca dados e faz algo ...</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// âœ… As dependÃªncias estÃ£o corretas</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token function\">getFetchUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">'redux'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// ... Busca dados e faz algo ...</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// âœ… As dependÃªncias estÃ£o corretas</span>\n\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>NÃ£o hÃ¡ necessidade de especificÃ¡-las nas listas de deps porque a funÃ§Ã£o nÃ£o estÃ¡ no escopo de renderizaÃ§Ã£o e nÃ£o pode ser afetada pelo fluxo de dados. Ela tambÃ©m nÃ£o pode depender acidentalmente de <em>props</em> ou <em>state</em>.</p>\n<p>Como alternativa, vocÃª pode encapsular a funÃ§Ã£o no <a href=\"https://reactjs.org/docs/hooks-reference.html#usecallback\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Hook <code class=\"language-text\">useCallback</code></a>:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">SearchResults</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token comment\">// âœ… Preserva a identidade quando as *props* sÃ£o as mesmas</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> getFetchUrl <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">query</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">return</span> <span class=\"token string\">'https://hn.algolia.com/api/v1/search?query='</span> <span class=\"token operator\">+</span> query<span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// âœ… As dependÃªncias do Callback estÃ£o corretas</span></span>\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token function\">getFetchUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">'react'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// ... Busca dados e faz algo ...</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>getFetchUrl<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// âœ… As dependÃªncias do Efeito estÃ£o corretas</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token function\">getFetchUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">'redux'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// ... Busca dados e faz algo ...</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>getFetchUrl<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// âœ… As dependÃªncias do Efeito estÃ£o corretas</span>\n\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">useCallback</code> Ã© como adicionar outra camada de verificaÃ§Ãµes de dependÃªncia. Ele estÃ¡ resolvendo o problema do outro lado - <strong>ao invÃ©s de evitar uma dependÃªncia de funÃ§Ã£o, nÃ³s fazemos a funÃ§Ã£o em si sÃ³ mudar quando necessÃ¡rio.</strong></p>\n<p>Vamos ver porque esta abordagem Ã© Ãºtil. Anteriormente, nosso exemplo mostrava dois resultados de pesquisa (um para o termo â€˜reactâ€™ e outro para â€˜reduxâ€™). Mas digamos que queremos adicionar uma entrada para que vocÃª possa procurar por uma <code class=\"language-text\">query</code> arbitrÃ¡ria. EntÃ£o, ao invÃ©s de passarmos <code class=\"language-text\">query</code> como um argumento, <code class=\"language-text\">getFetchUrl</code> irÃ¡ usar a variÃ¡vel do estado local.</p>\n<p>NÃ³s veremos imediatamente que estÃ¡ faltando <code class=\"language-text\">query</code> na lista de dependÃªncia:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">SearchResults</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>query<span class=\"token punctuation\">,</span> setQuery<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">'react'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> getFetchUrl <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// NÃ£o temos `query` como argumento</span>\n    <span class=\"token keyword\">return</span> <span class=\"token string\">'https://hn.algolia.com/api/v1/search?query='</span> <span class=\"token operator\">+</span> query<span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ğŸ”´ EstÃ¡ faltando uma dependÃªncia: `query`</span></span>  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Se eu corrigir as dependÃªncias em <code class=\"language-text\">useCallback</code> e incluir <code class=\"language-text\">query</code>, qualquer efeito com <code class=\"language-text\">getFetchUrl</code> listado em suas â€œdepsâ€ serÃ¡ executado novamente sempre que a <code class=\"language-text\">query</code> for alterada:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">SearchResults</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>query<span class=\"token punctuation\">,</span> setQuery<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">'react'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token comment\">// âœ… Preserva a identidade atÃ© a `query` mudar</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> getFetchUrl <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">return</span> <span class=\"token string\">'https://hn.algolia.com/api/v1/search?query='</span> <span class=\"token operator\">+</span> query<span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>query<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// âœ… As dependÃªncias do Callback estÃ£o corretas</span></span>\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token function\">getFetchUrl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// ... Busca dados e faz algo ...</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>getFetchUrl<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// âœ… As dependÃªncias do Efeito estÃ£o corretas</span>\n\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>GraÃ§as a <code class=\"language-text\">useCallback</code>, se <code class=\"language-text\">query</code> for a mesma, <code class=\"language-text\">getFetchUrl</code> tambÃ©m permanece a mesma, e nosso efeito nÃ£o Ã© executado novamente. Mas se houver alteraÃ§Ãµes na <code class=\"language-text\">query</code> entÃ£o <code class=\"language-text\">getFetchUrl</code> tambÃ©m irÃ¡ mudar e nÃ³s buscaremos os dados novamente. Ã‰ muito parecido com quando vocÃª altera alguma cÃ©lula em uma planilha do Excel, e as outras cÃ©lulas que a usam recalculam automaticamente.</p>\n<p>Isso Ã© apenas uma conseqÃ¼Ãªncia de adotar o fluxo de dados e a mentalidade de sincronizaÃ§Ã£o. <strong>A mesma soluÃ§Ã£o funciona para objetos de funÃ§Ã£o passados pelos elementos pais:</strong></p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Parent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>query<span class=\"token punctuation\">,</span> setQuery<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">'react'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token comment\">// âœ… Preserva a identidade atÃ© a `query` mudar</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> fetchData <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token string\">'https://hn.algolia.com/api/v1/search?query='</span> <span class=\"token operator\">+</span> query<span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token comment\">// ... Fetch data and return it ...</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>query<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// âœ… As dependÃªncias do Callback estÃ£o corretas</span></span>\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Child</span></span> <span class=\"token attr-name\">fetchData</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>fetchData<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">Child</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> fetchData <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> <span class=\"token punctuation\">[</span>data<span class=\"token punctuation\">,</span> setData<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">fetchData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>setData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>fetchData<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// âœ… As dependÃªncias do Efeito estÃ£o corretas</span>\n\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Como <code class=\"language-text\">fetchData</code> sÃ³ muda quando o estado <code class=\"language-text\">query</code> do <code class=\"language-text\">Parent</code> muda, <code class=\"language-text\">Child</code> nÃ£o irÃ¡ buscar dados atÃ© que seja realmente necessÃ¡rio (houver alguma alteraÃ§Ã£o).</p>\n<h2 id=\"as-funÃ§Ãµes-fazem-parte-do-fluxo-de-dados\"><a href=\"#as-fun%C3%A7%C3%B5es-fazem-parte-do-fluxo-de-dados\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>As FunÃ§Ãµes Fazem Parte do Fluxo de Dados?</h2>\n<p>Curiosamente, esse padrÃ£o quando quebrado com o paradigma de classes, realmente mostra a diferenÃ§a entre efeitos e ciclos de vida. Considere esse exemplo:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Parent</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Component</span> <span class=\"token punctuation\">{</span>\n  state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    query<span class=\"token operator\">:</span> <span class=\"token string\">'react'</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token function-variable function\">fetchData</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token string\">'https://hn.algolia.com/api/v1/search?query='</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token comment\">// ... Busca dados e faz algo ...</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></span>  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Child</span></span> <span class=\"token attr-name\">fetchData</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>fetchData<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Child</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Component</span> <span class=\"token punctuation\">{</span>\n  state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    data<span class=\"token operator\">:</span> <span class=\"token keyword\">null</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token function\">componentDidMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span><span class=\"token function\">fetchData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span></span>  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>VocÃª pode estar pensando: â€œVamos Dan, todos nÃ³s sabemos que <code class=\"language-text\">useEffect</code> Ã© como <code class=\"language-text\">componentDidMount</code> e <code class=\"language-text\">componentDidUpdate</code> combinados, vocÃª nÃ£o pode continuar batendo naquele tambor!â€ <strong>No entanto, isso nÃ£o funciona nem com <code class=\"language-text\">componentDidUpdate</code>:</strong></p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Child</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Component</span> <span class=\"token punctuation\">{</span>\n  state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    data<span class=\"token operator\">:</span> <span class=\"token keyword\">null</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">componentDidMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span><span class=\"token function\">fetchData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token function\">componentDidUpdate</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">prevProps</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token comment\">// ğŸ”´ Essa condiÃ§Ã£o nunca serÃ¡ verdadeira</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>fetchData <span class=\"token operator\">!==</span> prevProps<span class=\"token punctuation\">.</span>fetchData<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span><span class=\"token function\">fetchData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">}</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span></span>  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Claro, <code class=\"language-text\">fetchData</code> Ã© um mÃ©todo de classe! (Ou melhor, uma propriedade de classe - mas isso nÃ£o muda nada.) NÃ£o serÃ¡ diferente por causa de uma mudanÃ§a de estado. EntÃ£o, <code class=\"language-text\">this.props.fetchData</code> vai ser igual a <code class=\"language-text\">prevProps.fetchData</code> e nÃ³s nunca vamos buscar dados novamente. Vamos apenas remover essa condiÃ§Ã£o entÃ£o?</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">  <span class=\"token function\">componentDidUpdate</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">prevProps</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span><span class=\"token function\">fetchData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p>Oh, espere, isso busca dados em <em>cada</em> nova renderizaÃ§Ã£o. (Se adicionarmos uma animaÃ§Ã£o acima nessa Ã¡rvore de componentes, Ã© uma maneira divertida de descobrir isso.) E se vincularmos com uma <code class=\"language-text\">query</code> especÃ­fica?</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Child</span></span> <span class=\"token attr-name\">fetchData</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">fetchData</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p>Mas entÃ£o <code class=\"language-text\">this.props.fetchData !== prevProps.fetchData</code> Ã© <em>sempre</em> verdadeiro, mesmo que <code class=\"language-text\">query</code> nÃ£o mude! EntÃ£o, vamos <em>sempre</em> executar a busca de dados.</p>\n<p>A Ãºnica soluÃ§Ã£o real para esse enigma com as classes Ã© morder a lÃ­ngua e passar a <code class=\"language-text\">query</code> em si para o componente <code class=\"language-text\">Child</code>. Na verdade, <code class=\"language-text\">Child</code>, acaba nÃ£o <em>usando</em> a <code class=\"language-text\">query</code>, mas pode disparar uma busca quando muda:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Parent</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Component</span> <span class=\"token punctuation\">{</span>\n  state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    query<span class=\"token operator\">:</span> <span class=\"token string\">'react'</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function-variable function\">fetchData</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token string\">'https://hn.algolia.com/api/v1/search?query='</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// ... Busca dados e faz algo ...</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Child</span></span> <span class=\"token attr-name\">fetchData</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>fetchData<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">query</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">;</span></span>  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Child</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Component</span> <span class=\"token punctuation\">{</span>\n  state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    data<span class=\"token operator\">:</span> <span class=\"token keyword\">null</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">componentDidMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span><span class=\"token function\">fetchData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token function\">componentDidUpdate</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">prevProps</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>query <span class=\"token operator\">!==</span> prevProps<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span><span class=\"token function\">fetchData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">}</span></span>  <span class=\"token punctuation\">}</span>\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Ao longo dos anos trabalhando com classes com o React, eu me acostumei em passar <em>props</em> desnecessÃ¡rias e quebrar o encapsulamento de componentes pai, e eu sÃ³ percebi o porque tivemos que fazer isso a uma semana atrÃ¡s.</p>\n<p><strong>Com as classes, as funÃ§Ãµes em <em>props</em> por si sÃ³ nÃ£o fazem parte do fluxo de dados.</strong> Os mÃ©todos se misturam a variÃ¡vel mutÃ¡vel <code class=\"language-text\">this</code>, entÃ£o nÃ£o podemos confiar em sua identidade para identificar qualquer coisa. Portanto, mesmo quando queremos apenas uma funÃ§Ã£o, temos que passar um monte de outros dados para poder â€œdiferenciÃ¡-laâ€. NÃ£o podemos saber se o <code class=\"language-text\">this.props.fetchData</code> passado do pai depende de algum estado ou nÃ£o, e se esse estado acabou de mudar.</p>\n<p><strong>Com <code class=\"language-text\">useCallback</code>, funÃ§Ãµes podem participar totalmente no fluxo de dados.</strong> Podemos dizer que, se as entradas da funÃ§Ã£o forem alteradas, a funÃ§Ã£o em si mudou, mas se nÃ£o, ela permaneceu a mesma. GraÃ§as Ã  granularidade fornecida por <code class=\"language-text\">useCallback</code>, mudanÃ§as nas <em>props</em> em <code class=\"language-text\">props.fetchData</code> podem se propagar automaticamente.</p>\n<p>Da mesma forma, <a href=\"https://reactjs.org/docs/hooks-reference.html#usememo\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">useMemo</code></a> nos permite fazer o mesmo para objetos complexos:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">ColorPicker</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// NÃ£o quebra a comparaÃ§Ã£o raza no Child</span>\n  <span class=\"token comment\">// ao menos que `color` mude</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>color<span class=\"token punctuation\">,</span> setColor<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">'pink'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> style <span class=\"token operator\">=</span> <span class=\"token function\">useMemo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> color <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>color<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Child</span></span> <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>style<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>Eu quero enfatizar que colocar <code class=\"language-text\">useCallback</code> em todos os lugares nÃ£o Ã© ideal.</strong> Ã‰ uma Ã³tima saÃ­da de emergÃªncia e Ã© Ãºtil quando uma funÃ§Ã£o Ã© passada e chamada de dentro de um efeito em elementos filhos. Ou se vocÃª estÃ¡ tentando impedir a quebra de memoizaÃ§Ã£o de um componente filho. Mas Hooks fazem <a href=\"https://reactjs.org/docs/hooks-faq.html#how-to-avoid-passing-callbacks-down\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">um melhor serviÃ§o para evitar passar callbacks completamente</a></p>\n<p>Nos exemplos acima, eu gostaria que <code class=\"language-text\">fetchData</code> estivesse dentro do meu efeito (que por sua vez poderia ser extraÃ­do para um Hook personalizado) ou uma importaÃ§Ã£o de nÃ­vel superior. Eu quero manter os efeitos simples, e utilizar retornos de chamadas neles nÃ£o ajudam. (â€œE se alguma <code class=\"language-text\">props.onComplete</code> for alterada enquando uma busca de dados estiver em andamento?â€œ) VocÃª pode <a href=\"https://overreacted.io/a-complete-guide-to-useeffect/#swimming-against-the-tide\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">simular o comportamento da classe</a>, mas isso nÃ£o resolve essa <strong>condiÃ§Ã£o de corrida</strong> (<em>race conditions</em>).</p>\n<h2 id=\"falando-em-condiÃ§Ãµes-de-corrida\"><a href=\"#falando-em-condi%C3%A7%C3%B5es-de-corrida\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Falando em CondiÃ§Ãµes de Corrida</h2>\n<p>Um exemplo clÃ¡ssico de busca de dados com classes pode ser feito assim:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Article</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Component</span> <span class=\"token punctuation\">{</span>\n  state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    article<span class=\"token operator\">:</span> <span class=\"token keyword\">null</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">componentDidMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">fetchData</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">async</span> <span class=\"token function\">fetchData</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">id</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> article <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token constant\">API</span><span class=\"token punctuation\">.</span><span class=\"token function\">fetchArticle</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> article <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Como vocÃª provavelmente sabe, esse cÃ³digo Ã© <em>buggy</em>. TambÃ©m nÃ£o suporta atualizaÃ§Ãµes. EntÃ£o, o segundo exemplo clÃ¡ssico que vocÃª pode encontrar online Ã© algo assim:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Article</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Component</span> <span class=\"token punctuation\">{</span>\n  state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    article<span class=\"token operator\">:</span> <span class=\"token keyword\">null</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">componentDidMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">fetchData</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token function\">componentDidUpdate</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">prevProps</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>prevProps<span class=\"token punctuation\">.</span>id <span class=\"token operator\">!==</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">fetchData</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">}</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span></span>  <span class=\"token keyword\">async</span> <span class=\"token function\">fetchData</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">id</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> article <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token constant\">API</span><span class=\"token punctuation\">.</span><span class=\"token function\">fetchArticle</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> article <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Isso definitivamente Ã© melhor! Mas ainda Ã© <em>buggy</em>. A razÃ£o pela qual Ã© <em>buggy</em> Ã© que o pedido pode sair de ordem. Se eu estou buscando <code class=\"language-text\">{id: 10}</code>, e mudo para <code class=\"language-text\">{id: 20}</code>, mas a solicitaÃ§Ã£o <code class=\"language-text\">{id: 20}</code> chegou primeiro lugar, a solicitaÃ§Ã£o que comeÃ§ou mais cedo, e terminou depois, incorretamente substituiria meu estado.</p>\n<p>Isso Ã© chamado de <strong>condiÃ§Ã£o de corrida</strong>, e Ã© tÃ­pico no cÃ³digo que mistura <code class=\"language-text\">async</code>/<code class=\"language-text\">await</code> (que supÃµe que algo espera pelo resultado) com fluxo de dados de cima-baixo (<em>props</em> ou <em>state</em> podem mudar enquanto estamos no meio de uma funÃ§Ã£o assÃ­ncrona).</p>\n<p>Os efeitos nÃ£o resolvem este problema magicamente, embora avisem se vocÃª tentar passar uma funÃ§Ã£o <code class=\"language-text\">async</code> diretamente para o efeito. (Precisamos melhorar esse aviso para explicar melhor os problemas que vocÃª pode encontrar.)</p>\n<p>Se a abordagem assÃ­ncrona que vocÃª usa suportar cancelamento, isso Ã© Ã³timo! VocÃª pode cancelar a solicitaÃ§Ã£o assÃ­ncrona diretamente na sua funÃ§Ã£o de limpeza.</p>\n<p>Alternativamente, a abordagem temporÃ¡ria mais fÃ¡cil Ã© rastreÃ¡-la com um booleano:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Article</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> id <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>article<span class=\"token punctuation\">,</span> setArticle<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">let</span> didCancel <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></span>\n    <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">fetchData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> article <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token constant\">API</span><span class=\"token punctuation\">.</span><span class=\"token function\">fetchArticle</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>didCancel<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span>        <span class=\"token function\">setArticle</span><span class=\"token punctuation\">(</span>article<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">fetchData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">      didCancel <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></span>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>id<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><a href=\"https://www.robinwieruch.de/react-hooks-fetch-data/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Este artigo</a> detalha como vocÃª pode manipular erros e estados de carregamento, alÃ©m de extrair essa lÃ³gica em um Hook personalizado. Eu recomendo a leitura caso vocÃª queira saber mais sobre como buscar dados com Hooks.</p>\n<h2 id=\"elevando-o-nÃ­vel\"><a href=\"#elevando-o-n%C3%ADvel\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Elevando o NÃ­vel</h2>\n<p>Com a mentalidade de ciclo de vida das classes, os efeitos colaterais se comportam de maneira diferente do que Ã© renderizado. A renderizaÃ§Ã£o de uma interface do usuÃ¡rio Ã© guiada por <em>props</em> e <em>state</em>, e Ã© garantido que seja consistente com eles, mas os efeitos colaterais nÃ£o sÃ£o. Esta Ã© uma fonte comum de erros.</p>\n<p>Com a mentalidade de <code class=\"language-text\">useEffect</code>, as coisas sÃ£o sincronizadas por padrÃ£o. Os efeitos colaterais tornam-se parte do fluxo de dados do React. Para cada chamada <code class=\"language-text\">useEffect</code>, uma vez que vocÃª o faÃ§a corretamente, o seu componente cuida de casos extremos muito melhor.</p>\n<p>No entanto, o custo inicial de acertar Ã© maior. Isso pode ser chato. Escrever um cÃ³digo de sincronizaÃ§Ã£o que lide bem com os casos extremos Ã© inerentemente mais difÃ­cil do que disparar efeitos colaterais Ãºnicos que nÃ£o sÃ£o consistentes com a renderizaÃ§Ã£o.</p>\n<p>Isso poderia ser preocupante se <code class=\"language-text\">useEffect</code> fosse <em>a</em> ferramenta que vocÃª usa a maior parte do tempo. No entanto, Ã© um bloco de construÃ§Ã£o de baixo nÃ­vel. Estamos no inÃ­cio dos Hooks, entÃ£o todo mundo usa blocos de baixo nÃ­vel o tempo todo, especialmente em tutoriais. Mas, na prÃ¡tica, Ã© provÃ¡vel que a comunidade comece a migrar para abstraÃ§Ãµes em torno dos Hooks, pois boas APIs ganham impulso.</p>\n<p>Estou vendo aplicativos diferentes criarem seus prÃ³prios Hooks, como <code class=\"language-text\">useFetch</code>, que encapsula parte da lÃ³gica de autenticaÃ§Ã£o do aplicativo ou <code class=\"language-text\">useTheme</code>, que usa o contexto para injetar um tema. Uma vez que vocÃª tenha uma caixa de ferramentas dessas, vocÃª nÃ£o usarÃ¡ o <code class=\"language-text\">useEffect</code> <em>tÃ£o</em> frequentemente. Mas a resiliÃªncia que ele traz, cria benefÃ­cios para Hooks construÃ­do por cima dele.</p>\n<p>AtÃ© agora, <code class=\"language-text\">useEffect</code> Ã© mais usado para busca de dados. Mas a busca de dados nÃ£o Ã© exatamente um problema de sincronizaÃ§Ã£o. Isto Ã© especialmente Ã³bvio porque as nossas dependÃªncias sÃ£o frequentemente <code class=\"language-text\">[]</code>. EntÃ£o, o que estamos sincronizando?</p>\n<p>A longo prazo, <a href=\"https://reactjs.org/blog/2018/11/27/react-16-roadmap.html#react-16x-mid-2019-the-one-with-suspense-for-data-fetching\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Suspense para Busca de Dados</a> permitirÃ¡ que bibliotecas de terceiros tenham uma maneira, de primeira classe, de instruir o React a suspender a renderizaÃ§Ã£o atÃ© que algo assÃ­ncrono (qualquer coisa: cÃ³digo, dados, imagens) estejam prontos.</p>\n<p>Como o Suspense cobre gradualmente mais casos de busca de dados, eu antecipo que <code class=\"language-text\">useEffect</code> vai ficar no plano de fundo, como uma ferramenta avanÃ§ada para casos em que vocÃª realmente deseja sincronizar <em>props</em> e <em>state</em> para algum efeito colateral. Ao contrÃ¡rio da busca de dados, ele lida com este caso naturalmente, pois ele foi projetado para isso. Mas atÃ© lÃ¡, Hooks personalizados como <a href=\"https://www.robinwieruch.de/react-hooks-fetch-data/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">mostrado aqui</a>, sÃ£o uma boa maneira de reutilizar a lÃ³gica de busca de dados.</p>\n<h2 id=\"finalizando\"><a href=\"#finalizando\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Finalizando</h2>\n<p>Agora que vocÃª sabe tudo o que eu sei sobre o uso de efeitos, confira o <a href=\"#tldr\">TLDR</a> no inÃ­cio. Ele faz sentido? Perdi alguma coisa? (Eu ainda tenho mais papel aqui!)</p>\n<p>Eu adoraria ouvir de vocÃª no Twitter! Obrigado pela leitura.</p>","timeToRead":52,"frontmatter":{"title":"Um guia completo para useEffect","date":"March 09, 2019","spoiler":"Efeitos fazem parte do seu fluxo de dados.","cta":null},"fields":{"slug":"/pt-br/a-complete-guide-to-useeffect/","langKey":"pt-br"}}},"pageContext":{"slug":"/pt-br/a-complete-guide-to-useeffect/","translations":["ko","ja","pt-br","zh-hant","zh-hans"],"translatedLinks":[]}}}